   1               	# 1 "main.S"
   1               	
   0               	
   0               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	;---------------------------------------------------------------------
  29               	; atmega8 avr
  30               	;
  31               	; UPDATE: 10/2022 to include stuff for atmega328 
  32               	;---------------------------------------------------------------------- 
  33               	;
  34               	; version information
  35               	;
  36               	.equ version, 12 ; 0.00.10
  37               	
  38               	#include "macros.S"
   1               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	;----------------------------------------------------------------------
  29               	;
  30               	;   MUST use gnu cpp 
  31               	;   use with .S (upper S) or
  32               	;   use with -x assembler-with-cpp
  33               	;
  34               	;     can't use alias 
  35               	;----------------------------------------------------------------------
  36               	;
  37               	; all defines, equs, macros are defined in this file
  38               	;
  39               	
  40               	#define atmega328
  41               	
  42               	;----------------------------------------------------------------------
  43               	;
  44               	;    about registers 
  45               	;
  46               	; r1:r0 reserved and used in internal atmega8
  47               	;   instructions, as spm, mul, des, etc
  48               	;   do not use inside interrupts
  49               	
  50               	#define _reserved_r0_ r0
  51               	#define _reserved_r1_ r1
  52               	
  53               	;----------------------------------------------------------------------
  54               	;
  55               	;  reserved for use inside timer0 interrupt
  56               	;
  57               	; sreg keep in interrupts
  58               	#define _sreg_ r2
  59               	
  60               	; offset for adjust timer0 interrupt counter
  61               	#define _offs_ r3
  62               	
  63               	; ticks counter for timer0 at 1 ms, (count 65 sec)
  64               	#define ticks_low r4
  65               	#define ticks_high r5
  66               	
  67               	;-----------------------------------------------------------------------
  68               	;
  69               	; forth model (like pdp-11)
  70               	;
  71               	; must be 16bits (16 to 31) registers
  72               	;
  73               	; Z generic pointer for access sram and flash memory, lpm, spm, index, etc
  74               	#define zpm_low r30
  75               	#define zpm_high r31
  76               	
  77               	; Y parameter stack pointer for access sram
  78               	#define psp_low r28
  79               	#define psp_high r29
  80               	
  81               	; X return stack pointer for access sram
  82               	#define rsp_low r26
  83               	#define rsp_high r27
  84               	
  85               	; top, Top parameter stack
  86               	#define tos_low r24
  87               	#define tos_high r25
  88               	
  89               	; nos, Next temporary
  90               	#define nos_low r22
  91               	#define nos_high r23
  92               	
  93               	; wrk, Work temporary 
  94               	#define wrk_low r20
  95               	#define wrk_high r21
  96               	
  97               	; extras
  98               	#define _zero_ r6
  99               	#define _work_ r7
 100               	
 101               	; registers r8 to r19 free
 102               	
 103               	;----------------------------------------------------------------------
 104               	;
 105               	;  trick adapted from amforth-6.9
 106               	;
 107               	.macro STRINGS string
 108               	;    .word DOSCON
 109               	    .byte 8f - 7f
 110               	7:  .ascii "\\string"
 111               	8:  .balign 2
 112               	.endm
 113               	
 114               	;----------------------------------------------------------------------
 115               	;
 116               	; header of leaf word in dictionary
 117               	;    flags must be 0x80, 0x40, 0x20, 0x10
 118               	;    size  must be 1 to 15
 119               	;
 120               	;----------------------------------------------------------------------
 121               	;
 122               	; set start reverse linked list
 123               	;
 124               	.set _link_, 0x0
 125               	.set _list_, 0x0
 126               	.set _last_, 0x0
 127               	
 128               	.macro HEADER name, label, flags=0x0
 129               	is_\label:
 130               	10:
 131               	    .p2align 1, 0x00
 132               	7:    
 133               	    .word _link_
 134               	    .set _link_, 7b
 135               	    .byte (9f - 8f) + \flags
 136               	8:    
 137               	    .ascii "\name"
 138               	9:    
 139               	    .p2align 1, 0x20
 140               	\label:
 141               	11:
 142               	    .set _last_, _list_
 143               	    .set _list_, _last_ + (11b - 10b + 1)
 144               	.endm
 145               	
 146               	;----------------------------------------------------------------------
 147               	; little endian !!! AVR
 148               	;
 149               	;    A    Z (r31:r30) is used as generic address pointer, deed by avr ISA
 150               	;
 151               	;    RSP  Y (r29:r28) used as return stack pointer    
 152               	;    PSP  X (r27:r26) used as data/parameter stack pointer
 153               	;    TOS  T (r25:r24) used as top in stack
 154               	;    NOS  N (r22:r23) used as second in stack
 155               	;    WRK  W (r20:r21) used as work            
 156               	;
 157               	;   all stacks grows downwards.
 158               	;
 159               	;----------------------------------------------------------------------
 160               	;    push into return stack, 
 161               	.macro rspush low, high 
 162               	    st -X, \low
 163               	    st -X, \high
 164               	.endm
 165               	
 166               	;----------------------------------------------------------------------
 167               	;    pull from return stack, 
 168               	.macro rspull low, high
 169               	    ld \high, X+
 170               	    ld \low, X+
 171               	.endm
 172               	
 173               	;----------------------------------------------------------------------
 174               	;    push into data stack, 
 175               	.macro pspush low, high
 176               	    st -Y, \low
 177               	    st -Y, \high
 178               	.endm
 179               	
 180               	;----------------------------------------------------------------------
 181               	;    pull from data stack, 
 182               	.macro pspull low, high
 183               	    ld \high, Y+
 184               	    ld \low, Y+
 185               	.endm
 186               	
 187               	;----------------------------------------------------------------------
 188               	;    load a word from program memory (flash)
 189               	;    ( only works with TWO lpm !!! )
 190               	;    Z address in bytes!
 191               	.macro pmload low, high
 192               	    lsl zpm_low
 193               	    rol zpm_high
 194               	    lpm \low, Z+
 195               	    lpm \high, Z+
 196               	    ror zpm_high
 197               	    ror zpm_low
 198               	.endm
 199               	
 200               	;----------------------------------------------------------------------
 201               	;    load from static memory (sram), increments pointer
 202               	;
 203               	.macro srload byte
 204               	    ld \byte, Z+
 205               	.endm
 206               	
 207               	;----------------------------------------------------------------------
 208               	;    save to static memory (sram), increments pointer
 209               	;
 210               	.macro srsave byte
 211               	    st Z+, \byte 
 212               	.endm
 213               	
 214               	;----------------------------------------------------------------------
 215               	;
 216               	; for Atmega8:
 217               	;
 218               	
 219               	;----------------------------------------------------------------------
 220               	; all primitives must start with NOOP and end with POON
 221               	;    a  nop (0x0000) is used as a null reference, and marks all primitives
 222               	;    as they are really a branch and link mark
 223               	
 224               	.macro NOOP
 225               	    nop
 226               	.endm
 227               	
 228               	.macro POON
 229               	;	for atmega8 could use rjmp
 230               	    jmp _link
 231               	.endm
 232               	
 233               	;**********************************************************************
 234               	;  constant values
 235               	;
 236               	;    %s/#define *\([^ ]*\) */ \1 = /
 237               	;    %s/ *\([^ ]*\) *= */#define \1 /
 238               	
 239               	;----------------------------------------------------------------------
 240               	;    sizes
 241               	;
 242               	; "Column 72 means Continue", 72 always \0
 243               	; Readability is good standart is 80
 244               	;
 245               	TIB_SIZE = 72
 246               	
 247               	; PAD minimum size
 248               	;
 249               	PAD_SIZE = TIB_SIZE
 250               	
 251               	; HDS minimum size, 16bits (16*2+2) +2 
 252               	;
 253               	HDS_SIZE = 36
 254               	
 255               	; stacks 18 words deep. WISE as M00re said.
 256               	;
 257               	STACK_SIZE = 36
 258               	
 259               	; default cell size
 260               	;
 261               	CELL_SIZE = 2
 262               	
 263               	; maximum word size
 264               	;
 265               	WORD_SIZE = 15
 266               	
 267               	; default base
 268               	;
 269               	BASE_DEFAULT = 16
 270               	
 271               	;----------------------------------------------------------------------
 272               	;   words can be 1 to 15 chars lenght, 
 273               	;
 274               	;   almost over for normal english ~10 letters words 
 275               	;   http://norvig.com/mayzner.html
 276               	;
 277               	;   flags 
 278               	;
 279               	;   tradicional:
 280               	;
 281               	;       IMMEDIATE, COMPILE, SMUDGE, LEAP
 282               	;
 283               	;   IMMEDIATE is mandatory execute words.
 284               	;
 285               	;   COMPILE is for compile only words.
 286               	;
 287               	;   HIDDEN or SMUDGE is not used, free to reassign any words but not change already compliled
 288               	;
 289               	;   LEAP is to mark as pure assembler routines, no calls inside.
 290               	;
 291               	;   RESERVED as 0x80, marks the byte as size+flag byte and allow
 292               	;   backtrace to name from execute address, names are ASCII < 0x80
 293               	;
 294               	;   if need 32 chars ANSI names, forget HIDDEN
 295               	;
 296               	F_RESERVED = 0x80
 297               	F_IMMEDIATE = 0x40
 298               	F_COMPILE = 0x20
 299               	F_HIDDEN = 0x10
 300               	
 301               	F_TOMASK = 0xF0
 302               	F_UNMASK = 0x0F
 303               	
 304               	; not flags but usefull to remember
 305               	F_LEAP = 0x00	; for primitives, pure assembler no calls for forth words
 306               	F_CORE = 0x00	; for core words
 307               	
 308               	;---------------------------------------------------------------------
 309               	;
 310               	; minimal error codes from forth 2012
 311               	;
 312               	NO_ERROR = 0
 313               	INVALID_MEMORY = -9
 314               	OUT_OF_RANGE = -11
 315               	INVALID_WORD = -13
 316               	TO_READ_ONLY = -20
 317               	NOT_A_NUMBER = -24
 318               	
 319               	;---------------------------------------------------------------------
 320               	; ASCII constants
 321               	;
 322               	; Flow Control
 323               	; assumes that all line edit is done at remote!
 324               	; no backspace, no delete, no moving cursor, just a static line.
 325               	; works as a screen or block, just receives a line till a CR or CR LF
 326               	; uses BS, for edit last char
 327               	;
 328               	;XON_   =   0x11    ; ascii DC1 ^Q
 329               	;XOFF_  =   0x13    ; ascii DC3 ^S
 330               	;NAK_   =   0x15    ; ascii NAK ^U
 331               	
 332               	CR_    =   0x0d    ; ascci carriage return ^M
 333               	LF_    =   0x0a    ; ascii line feed ^J
 334               	BS_    =   0x08    ; ascii backspace ^H
 335               	BL_    =   0x20    ; ascii space 
 336               	
 337               	;----------------------------------------------------------------------
 338               	; AVR SREG constants
 339               	;
 340               	
 341               	BIT_CARRY = 0
 342               	
 343               	BIT_ZERO = 1
 344               	
 345               	BIT_NEG = 2
 346               	
 347               	;----------------------------------------------------------------------
 348               	
 349               	#ifdef atmega8
 350               	
 351               	; atmega8 have flash memory of 128 pages of 32 words
 352               	
 353               	SPM_SIZE = 64
 354               	
 355               	SRAM_START = 0x060  ; SRAM from AVR manual
 356               	
 357               	SRAM_END = 0x45F    ; SRAM from AVR manual 
 358               	
 359               	FLASH_RWW = 0x0000
 360               	
 361               	FLASH_NRWW = 0x1E00    ; using optiboot in 512 bytes !!!!
 362               	
 363               	FLASH_END = 0x1FFF 
 364               	
 365               	E2P_END = 0x1FF
 366               	
 367               	#endif
 368               	
 369               	#ifdef atmega328
 370               	
 371               	; atmega328 have flash memory of 256 pages of 64 words
 372               	
 373               	SPM_SIZE = 128
 374               	
 375               	SRAM_START = 0x0100  ; SRAM from AVR manual
 376               	
 377               	SRAM_END = 0x08FF  ; SRAM from AVR manual
 378               	
 379               	FLASH_RWW = 0x0000
 380               	
 381               	FLASH_NRWW = 0x3E00    ; using optiboot in 512 bytes !!!!
 382               	
 383               	FLASH_END = 0x3FFF 
 384               	
 385               	E2P_END = 0x3FF
 386               	
 387               	#endif
 388               	
 389               	/* for eeprom use */
 390               	
 391               	E2P_PAGESIZE = 4
 392               	
 393               	E2P_START = 0x000
 394               	
 395               	/* avr signature bytes */
 396               	
 397               	SIGNATURE_000	= 0x1e
 398               	SIGNATURE_001	= 0x95
 399               	
 400               	; for atmega328
 401               	SIGNATURE_002	= 0x0f
 402               	; for atmega328P
 403               	SIGNATURE_003	= 0x0f
 404               	; for atmega328PB
 405               	SIGNATURE_004	= 0x16
 406               	
 407               	/* task states, QNX */
 408               	
 409               	HALT = 0x0
 410               	IDLE = 0x1
 411               	BUSY = 0x2
 412               	WAIT = 0x3
 413               	
 414               	GIVE = 0x4
 415               	TAKE = 0x8
 416               	
 417               	;----------------------------------------------------------------------
 418               	/* temporary where start forth */
 419               	
 420               	;----------------------------------------------------------------------
 421               	...
  39               	;----------------------------------------------------------------------
  40               	;
  41               	; for sake stacks grows down, heaps grows up
  42               	;
  43               	;----------------------------------------------------------------------
  44               	.section .eeprom
  45               	.org 0x000
  46               	
  47 0000 0000      	e_void:	.word 0 ; always zero
  48 0002 0000      	e_live:	.word 0 ; seed for random
  49 0004 0000      	e_turn:	.word 0 ; routine after boot
  50 0006 0000      	e_rest:	.word 0 ; routine before reset
  51 0008 0000      	e_last:	.word 0 ; link to last word in dictionary
  52 000a 0000      	e_dp:	.word 0 ; next free flash address for dictionary
  53 000c 0000      	e_up:	.word 0 ; next free sram address for variables, backwards
  54 000e 0000      	e_ep:	.word 0 ; next free eprom address for values, 
  55               	
  56               	EP0 = .
  57               	
  58               	;----------------------------------------------------------------------
  59               	.section data
  60 0000 0000 0000 	.org SRAM_START
  60      0000 0000 
  60      0000 0000 
  60      0000 0000 
  60      0000 0000 
  61               	
  62               	;----------------------------------------------------------------------
  63               	; Terminal input buffer
  64 0100 0000 0000 	TIB0:	.space TIB_SIZE, 0x0
  64      0000 0000 
  64      0000 0000 
  64      0000 0000 
  64      0000 0000 
  65               	
  66               	;----------------------------------------------------------------------
  67               	; Stacks
  68 0148 0000 0000 	SPZ:    .space STACK_SIZE, 0x0
  68      0000 0000 
  68      0000 0000 
  68      0000 0000 
  68      0000 0000 
  69               	SP0 = .
  70 016c 0000 0000 	PSZ:    .space STACK_SIZE, 0x0
  70      0000 0000 
  70      0000 0000 
  70      0000 0000 
  70      0000 0000 
  71               	PS0 = .
  72 0190 0000 0000 	RSZ:    .space STACK_SIZE, 0x0
  72      0000 0000 
  72      0000 0000 
  72      0000 0000 
  72      0000 0000 
  73               	RS0 = .
  74               	
  75               	;----------------------------------------------------------------------
  76               	; non volatile, must be saved in eeprom
  77 01b4 0000      	VOID:	.word 0		; always 0x0000
  78 01b6 0000      	LIVE:   .word 0     ; count boots
  79               	
  80 01b8 0000      	TURN:	.word 0		; routine to run after boot
  81 01ba 0000      	REST:	.word 0		; routine to run before reset
  82               	
  83 01bc 0000      	LAST:	.word 0		; reference to latest word in dictionary
  84 01be 0000      	VDP:	.word 0		; next free cell in flash dictionary
  85               	
  86 01c0 0000      	VUP:    .word 0     ; next free cell in static ram, backwards
  87 01c2 0000      	VEP: 	.word 0		; next free cell in eeprom
  88               	
  89               	;----------------------------------------------------------------------
  90               	; those are volatile, dont care
  91 01c4 0000      	VHP:    .word 0     ; next free cell in static ram, forward
  92 01c6 0000      	SEED:   .word 0     ; random seed
  93               	
  94 01c8 0000      	STAT:	.word 0		; state of interpreter, 0 interprete, 1 compile
  95 01ca 0000      	RADX:	.word 0		; numeric radix for convertion
  96               	
  97 01cc 0000      	TOIN:   .word 0     ; offset in TIB
  98 01ce 0000      	SPAN:   .word 0     ; offset in user buffer
  99               	
 100 01d0 0000      	SCRS:   .word 0     ; screen number
 101 01d2 0000      	BLKS:   .word 0     ; block number
 102               	
 103 01d4 0000      	HAND:   .word 0     ; handler for catch and throw
 104 01d6 0000      	CSPP:   .word 0     ; keep last ps
 105               	
 106 01d8 0000      	CURR:   .word 0     ; reference to current vocabulary
 107 01da 0000      	CTXT:   .word 0     ; reference to context vocabulary
 108               	
 109 01dc 0000      	HLD:    .word 0     ; picture number buffer
 110 01de 0000      	HLDS:   .word 0     ; picture number cursor
 111               	
 112 01e0 0000      	WARN:   .word 0     ; warning number
 113 01e2 0000      	ERRN:   .word 0     ; error number
 114               	
 115 01e4 0000      	TMP0:   .word 0     ; temporary
 116 01e6 0000      	TMP1:   .word 0     ; temporary
 117 01e8 0000      	TMP2:   .word 0     ; temporary
 118 01ea 0000      	TMP3:   .word 0     ; temporary
 119               	
 120               	;----------------------------------------------------------------------
 121               	UH0 = .
 122               	
 123               	US0 = SRAM_END
 124               	
 125               	;.equ is_free_sram,  US0 - UH0
 126               	
 127               	;----------------------------------------------------------------------
 128               	;
 129               	; code segment, flash
 130               	;
 131               	; all start text segment is in bios.S
 132               	;----------------------------------------------------------------------
 133               	.p2align 1, 0x00
 134               	#include "bios.S"
   1               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	;----------------------------------------------------------------------
  29               	; review for atmega328
  30               	;   10/2022 @agsb
  31               	
  32               	
  33               	;---------------------------------------------------------------------
  34               	; from avr manual, do not change 
  35               	; reserved I/O Memory address
  36               	;
  37               	__SREG__ = 0x3f
  38               	__SP_H__ = 0x3e
  39               	__SP_L__ = 0x3d
  40               	
  41               	/* USART */
  42               	UBRRL = 0x09
  43               	UCSRC = 0x20
  44               	UCSRB = 0x0a
  45               	UCSRA = 0x0b
  46               	
  47               	/* Watch dog */
  48               	WDTCR = 0x21
  49               	
  50               	/* timer0 */
  51               	TCNT0 = 0x32
  52               	TCCR0 = 0x33
  53               	TIMSK = 0x39
  54               	
  55               	/* SPMCR */
  56               	SPMCR = 0x37
  57               	
  58               	/* SPM BITS */
  59               	SPMIE = 7
  60               	RWWSB = 6
  61               	/* bit 5 reserved */
  62               	RWWSRE = 4
  63               	BLBSET = 3
  64               	PGWRT = 2
  65               	PGERS = 1
  66               	SPMEN = 0
  67               	
  68               	;----------------------------------------------------------------------
  69               	;792486AA–AVR–02/2013 ATmega8(L)Note:1.   See “About Code Examples” on page 8
  70               	;
  71               	; from atmeg8 datasheet
  72               	;
  73               	EEARH =  0x1F
  74               	EEARL =  0x1E
  75               	EEDR  =  0x1D
  76               	EECR  =  0x1C
  77               	EEWE  =  1
  78               	EEMWE =  2
  79               	EERE  =  0
  80               	
  81               	;----------------------------------------------------------------------
  82               	; sleep register
  83               	MCUCR = 0x35 
  84               	
  85               	;----------------------------------------------------------------------
  86               	;
  87               	; classic interrup vector table
  88               	;
  89               	;----------------------------------------------------------------------
  90               	
  91               	
  92               	;----------------------------------------------------------------------
  93               	;
  94               	; code segment, flash
  95               	;
  96               	.section .text
  97               	.org 0x000
  98               	.global boot
  99               	
 100               	boot:
 101               	
 102 0000 00C0      	    rjmp RESET ; Reset Handler
 103 0002 1895      	    reti ; rjmp EXT_INT0 ; IRQ0 Handler
 104 0004 1895      	    reti ; rjmp EXT_INT1 ; IRQ1 Handler
 105 0006 1895      	    reti ; rjmp TIM2_COMP ; Timer2 Compare Handler
 106 0008 1895      	    reti ; rjmp TIM2_OVF ; Timer2 Overflow Handler
 107 000a 1895      	    reti ; rjmp TIM1_CAPT ; Timer1 Capture Handler
 108 000c 1895      	    reti ; rjmp TIM1_COMPA ; Timer1 CompareA Handler
 109 000e 1895      	    reti ; rjmp TIM1_COMPB ; Timer1 CompareB Handler
 110 0010 1895      	    reti ; rjmp TIM1_OVF ; Timer1 Overflow Handler
 111 0012 00C0      	    rjmp TIM0_OVF ; Timer0 Overflow Handler
 112 0014 1895      	    reti ; rjmp SPI_STC ; SPI Transfer Complete Handler
 113 0016 1895      	    reti ; rjmp USART_RXC ; USART RX Complete Handler
 114 0018 1895      	    reti ; rjmp USART_UDRE ; ((0x0C) + 0x20) Empty Handler
 115 001a 1895      	    reti ; rjmp USART_TXC ; USART TX Complete Handler
 116 001c 1895      	    reti ; rjmp ADC ; ADC Conversion Complete Handler
 117 001e 1895      	    reti ; rjmp EE_RDY ; EEPROM Ready Handler
 118 0020 1895      	    reti ; rjmp ANA_COMP ; Analog Comparator Handler
 119 0022 1895      	    reti ; rjmp TWSI ; Two-wire Serial Interface Handler
 120 0024 1895      	    reti ; rjmp SPM_RDY ; Store Program Memory Ready Handler;
 121               	
 122               	; todo: use USART_RXC to allow ^C, ^S, ^Q, ^D controls
 123               	
 124               	;----------------------------------------------------------------------
 125               	; 
 126               	RESET:
 127               	;   yes, is a nop. 
 128 0026 0000      	    nop
 129               	; clear interrupts
 130 0028 F894      	    cli
 131               	; init _zero_ as zero
 132 002a 6624      	    clr _zero_
 133 002c 6FBE      	    out __SREG__, _zero_ ; clear sreg
 134               	; init real sp at end of sram
 135 002e 8FEF      	    ldi r24, lo8(SRAM_END)
 136 0030 98E0      	    ldi r25, hi8(SRAM_END)
 137               	; reserve
 138 0032 8DBF      	    out __SP_L__, r24
 139 0034 9EBF      	    out __SP_H__, r25
 140               	
 141               	;----------------------------------------------------------------------
 142               	/*
 143               	
 144               	OSCAL calibration,
 145               	from atmel 2555 note:
 146               	for atmega8 theorical for 25oC at 5V, value is 168.
 147               	for optiboot, value is 143 as sample better for 38400 bauds, maybe less for 40oC
 148               	CFLAGS += '-DMAX_TIME_COUNT=F_CPU>>4' '-DOSC_CAL=142' '-DNUM_LED_FLASHES=2' -DBAUD_RATE=38400
 149               	*/
 150               	
 151               	;----------------------------------------------------------------------
 152               	; init timer0, with internal clock 8MHz, 
 153               	;   from gcc public code, io ports as constants
 154               	;
 155               	; preset of timer0, with internal clock 8MHz ; cycle 64 ; offset 131
 156               	; timer cycle * offset / clock = 8k/8M = 1ms
 157               	;
 158               	; so it counts 125 clocks inside the interrup routines
 159               	;
 160               	; offset counter 256 - 125 = 131
 161               	; but was 8 clocks in routine timer0, 
 162               	; then 131 + 12 = 143
 163               	OFFSETCNT = 143
 164               	;
 165               	TIMER0_SET:
 166               	; enable pre-escaler
 167 0036 03B7      	    in r16, TCCR0
 168 0038 0360      	    ori r16, (1 << 1) | (1 << 0)
 169 003a 03BF      	    out TCCR0, r16
 170               	; offset counter
 171 003c 0FE8      	    ldi r16, OFFSETCNT
 172               	; preserve offset
 173 003e 302E      	    mov r3, r16
 174 0040 02BF      	    out TCNT0, r16
 175               	; enable counter
 176 0042 09B7      	    in r16, TIMSK
 177 0044 0160      	    ori r16, (1 << 0) 
 178 0046 09BF      	    out TIMSK, r16
 179               	;   clear click counter
 180 0048 4424      	    clr r4
 181 004a 5524      	    clr r5
 182               	
 183               	;----------------------------------------------------------------------
 184               	; init watch dog, from avr-gcc public code, io ports as constants
 185               	; write logical one to WDCE and WDE, set WDP2, WDP1, WDP0 to ~ 2.0 s
 186               	;
 187               	WATCHDOG_SET:
 188 004c 01B5      	    in r16, WDTCR
 189 004e 0861      	    ori r16, (1 << 4) | (1 << 3)
 190 0050 0760      	    ori r16, (1 << 2) | (1 << 1) | (1 << 0)
 191 0052 01BD      	    out WDTCR, r16
 192               	
 193               	;----------------------------------------------------------------------
 194               	; init usart, from avr-gcc public code
 195               	;
 196               	;   defaults to 9600, 8N1, no control
 197               	;
 198               	USART_SET:
 199 0054 0027      	    clr r16
 200 0056 00BD      	    out UCSRC, r16
 201 0058 04E3      	    ldi r16, lo8(52)
 202 005a 09B9      	    out UBRRL, r16
 203 005c 0AB1      	    in r16, UCSRB
 204 005e 0861      	    ori r16, lo8(24)
 205 0060 0AB9      	    out UCSRB, r16
 206 0062 0EE8      	    ldi r16, lo8(-114)
 207 0064 00BD      	    out UCSRC, r16
 208 0066 00B5      	    in r16, UCSRC
 209 0068 0064      	    ori r16,lo8(64)
 210 006a 00BD      	    out UCSRC, r16
 211               	
 212               	;----------------------------------------------------------------------
 213               	; enable interrupts
 214               	GOOD:
 215 006c 7894      	    sei
 216               	;    rjmp COLD 
 217 006e C8CF      	    rjmp HALT
 218               	
 219               	;----------------------------------------------------------------------
 220               	;
 221               	;   do not use r0 and r1 are scratch registers used in spm, mul, des, etc
 222               	;
 223               	;   generic:
 224               	;   r2 , save_SREG
 225               	;   r3 , offset prescale timer0
 226               	;   r4 , counter each 1ms low byte
 227               	;   r5 , counter each 1ms high byte
 228               	;   r6 , _zero_
 229               	
 230               	;   timer0 prescale 
 231               	;   for 8 MHz, prescale 64, offset 131, results about 1 ms
 232               	;   64 * 125 = 8000 ; 
 233               	;   256 - 125 = 131 ; offset for miliseconds
 234               	;   plus 12 cycles inside routine
 235               	;
 236               	;   ticks counts till 65 seconds
 237               	;
 238               	;   60000 is EA60
 239               	;
 240               	; interrupt routine
 241               	TIM0_OVF:
 242               	; disable interrups
 243 0070 F894      	    cli
 244               	; save flags
 245 0072 2FB6      	    in r2, __SREG__
 246               	; increase counter and also clear 
 247 0074 4394      	    inc r4
 248 0076 01F0      	    brbs BIT_ZERO, TIM0_ADJ
 249 0078 5394      	    inc r5
 250               	TIM0_ADJ:
 251 007a 32BE      	    out TCNT0, r3
 252               	;  reset watch dog
 253 007c A895      	    wdr
 254               	; clear _zero_  
 255 007e 6624      	    clr r6
 256               	; load flags and return
 257 0080 2FBE      	    out __SREG__, r2
 258               	; enable interrups
 259 0082 7894      	    sei
 260 0084 1895      	    reti
 261               	
 262               	;----------------------------------------------------------------------
 263               	;
 264               	;   do not use r0 and r1 are scratch registers used in spm, mul, des, etc
 265               	;
 266               	HALT:
 267 0086 0000      	    nop
 268 0088 7894      	    sei
 269 008a 00E8      	    ldi r16, 0x80 ; Enable sleep mode
 270 008c 05BF      	    out MCUCR, r16
 271 008e 8895      	    sleep           ; Put MCU in sleep mode
 272 0090 00C0      	    rjmp RESET
 273               	
 135               	
 136               	;----------------------------------------------------------------------
 137               	.p2align 1, 0x00
 138               	#include "messages.S"
   1               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	 disclaimer : 
  29 0092 4449 5343 	 .ascii "DISCLAIMER\nthis software is provided \"AS IS\".\n"
  29      4C41 494D 
  29      4552 0A74 
  29      6869 7320 
  29      736F 6674 
  30 00c0 436F 7079 	 .ascii "Copyright © 2020, Alvaro Gomes Sobral Barcellos,\n"
  30      7269 6768 
  30      7420 C2A9 
  30      2032 3032 
  30      302C 2041 
  31 00f2 4C69 6365 	 .ascii "Licence Creative Commons,f8f98284-589e-4290-867c-0ac3824721ac,\n"
  31      6E63 6520 
  31      4372 6561 
  31      7469 7665 
  31      2043 6F6D 
  32 0131 4174 7472 	 .ascii "Attribution-NonCommercial 4.0 International (CC BY-NC 4.0)\n"
  32      6962 7574 
  32      696F 6E2D 
  32      4E6F 6E43 
  32      6F6D 6D65 
  33               	 
  34 016c 04        	 .byte 4
  35               	 prompt : ; 4
  36 016d 204F 6B00 	 .asciz " Ok"
  37               	 
  38 0171 04        	 .byte 4
  39               	 question : ; 4
  40 0172 203F 3F00 	 .asciz " ??"
  41               	 
  42 0176 0C        	 .byte 12
  43               	 undefined : ; 12
  44 0177 2075 6E64 	 .asciz " undefined?"
  44      6566 696E 
  44      6564 3F00 
  45               	 
  46 0183 0C        	 .byte 12
  47               	 exception : ; 12
  48 0184 2065 7863 	 .asciz " exception!"
  48      6570 7469 
  48      6F6E 2100 
  49               	 
  50 0190 0A        	 .byte 10
  51               	 abort : ; 10
  52 0191 2061 626F 	 .asciz " aborted."
  52      7274 6564 
  52      2E00 
  53               	 
  54               	 roullete: ; 37, Pascal
  55               	 ; french: 0-32-15-19-4-21-2-25-17-34-6-27-13-36-11-30-8-23-10-5-24-16-33-1-20-14-31-9-22-18-29-7-2
  56               	 ; double: 0-28-9-26-30-11-7-20-32-17-5-22-34-15-3-24-36-13-1-00-27-10-25-29-12-8-19-31-18-6-21-33-
  57               	 ; triple: 0-000-00-32-15-19-4-21-2-25-17-34-6-27-13-36-11-30-8-23-10-5-24-16-33-1-20-14-31-9-22-18
  58 019b 0000      	 .word  0
  59 019d 2000 0F00 	 .word 32, 15, 19,  4, 21,  2, 25, 17, 34 
  59      1300 0400 
  59      1500 0200 
  59      1900 1100 
  59      2200 
  60 01af 0600 1B00 	 .word  6, 27, 13, 36, 11, 30,  8, 23, 10
  60      0D00 2400 
  60      0B00 1E00 
  60      0800 1700 
  60      0A00 
  61 01c1 0500 1800 	 .word  5, 24, 16, 33,  1, 20, 14, 31,  9
  61      1000 2100 
  61      0100 1400 
  61      0E00 1F00 
  61      0900 
  62 01d3 1600 1200 	 .word 22, 18, 29,  7, 28, 12, 35,  3, 26
  62      1D00 0700 
  62      1C00 0C00 
  62      2300 0300 
  62      1A00 
  63               	
 139               	
 140               	;----------------------------------------------------------------------
 141 01e5 00        	.p2align 1, 0x00
 142               	#include "forth-leafs.S"
   1               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	;---------------------------------------------------------------------
  29               	;
  30               	;    A small Forth for ATmega8 
  31               	;
  32               	;---------------------------------------------------------------------
  33               	; dictionary structure 
  34               	;
  35               	; cell size is a word of 16 bits 
  36               	;
  37               	; .word  link    link to previous 
  38               	; .byte  size    sizeof name OR flags 
  39               	; .ascii "name"  name, plus a pad byte with BL (0x32) if size is even 
  40               	; .word  param,  many references 
  41               	;
  42               	;----------------------------------------------------------------------
  43               	 
  44               	;
  45               	; classics 
  46               	;
  48               	.LIST 
  49               	 
  50               	;----------------------------------------------------------------------
  51               	; start of dictionary 
  52               	;
  53               	 
  54               	;----------------------------------------------------------------------
  55               	;
  56               	; this is the forth inner engine, 
  57               	;
  58               	; a compound word, aka twig, must end with a reference to ENDS 
  59               	;
  60               	; a primitive work, aka leaf, must start with NOOP and ends with POON 
  61               	;
  62               	; the size byte must be masked by: or 0xF0 
  63               	;
  64               	; memory pointer r30:r31 as Z 
  65               	; parameter stack pointer r28:r29 as Y 
  66               	; return stack pointer r26:r27 as X 
  67               	; top of stack r24:r25 
  68               	; nos, temporary next of stack r22:r23 
  69               	; wrk, temporary working r20:r21 
  70               	;
  71               	; _zero_, always zero, keeped by timer0
  72               	; _work_, scratch
  73               	;
  74               	; Can only use LPM to access flash memory ? YES! 
  75               	;
  76               	; forth: all constants in flash
  77               	;
  78               	; user: no constants and variables in sdram 
  79               	;
  80               	; why ? flash memory suports only 10.000 cycles 
  81               	;
  82               	;----------------------------------------------------------------------
  83               	; starts just above sram ends 
  84               	;
  85               	; use the address to determine if is flash or is sram, above is flash :)
  86               	;
  87               	.section .text 
  88               	__forth__: 
  89               	;----------------------------------------------------------------------
  90               	; inner interpreter, 
  91               	; it is also a primitive word 
  92               	;
  93               	; on AVR use Z for access flash
  94               	;
  95               	;   temporary use zpm, wrk, _word_
  96               	;
  97 01e6 0000 0445 	HEADER "ENDS", "ENDS", F_LEAP | F_CORE
  97      4E44 5320 
  98               	; does nothing and mark as primitive 
  99 01ee 0000      	    NOOP 
 100               	 
 101               	; pull ips from rsp 
 102               	_unnest:  
 103 01f0 FD91 ED91 	    rspull zpm_low, zpm_high 
 104               	    ; rjump _next
 105               	 
 106               	; load w with contents of cell at ips 
 107               	_next: 
 108 01f4 EE0F FF1F 	    pmload wrk_low, wrk_high ; also increments zpm 
 108      4591 5591 
 108      F795 E795 
 109               	 
 110               	; if zero (NULL) is a primitive word 
 111               	_void:
 112 0200 742E      	    mov _work_, wrk_low 
 113 0202 752A      	    or _work_, wrk_high 
 114 0204 01F0      	    brbs BIT_ZERO, _jump
 115               	
 116               	; else is a reference ( 2 extra cycles )
 117               	_nest: 
 118 0206 EE93 FE93 	    rspush zpm_low, zpm_high ; push next reference 
 119 020a FA01      	    movw zpm_low, wrk_low ; point to this reference 
 120 020c 00C0      	    rjmp _next 
 121               	 
 122               	; then jump, for exec it 
 123               	_jump: 
 124 020e 0994      	    ijmp 
 125               	 
 126               	; then link, for continue 
 127               	_link: 
 128 0210 00C0      	    rjmp _unnest 
 129               	 
 130               	;********************************************************************** 
 131               	;
 132               	;   bios i/O 
 133               	;
 134               	;----------------------------------------------------------------------
 135               	;
 136               	; ok ( -- w) 
 137               	; beware, it blocks while test if can receive a char 
 138               	;
 139 0212 0000 034B 	HEADER "KEY", "KEY", F_LEAP | F_CORE
 139      4559 
 140 0218 0000      	    NOOP 
 141               	1: 
 142 021a 5F9B      	    sbis 0x0b, 7 
 143 021c 00C0      	    rjmp 1b 
 144               	2: 
 145 021e 8A93 9A93 	    pspush tos_low, tos_high
 146 0222 8CB1      	    in tos_low, 0x0c 
 147 0224 9927      	    clr tos_high 
 148 0226 0C94 0000 	    POON 
 149               	 
 150               	;----------------------------------------------------------------------
 151               	;
 152               	; ok ( -- FALSE | TRUE ) 
 153               	; test if can receive a char, or return FALSE 
 154               	;
 155 022a 0000 044B 	HEADER "KEY?", "QKEY", F_LEAP | F_CORE
 155      4559 3F20 
 156 0232 0000      	    NOOP 
 157               	3: 
 158 0234 5F9B      	    sbis 0x0b, 7 
 159 0236 00C0      	    rjmp _iffalse 
 160 0238 00C0      	    rjmp _iftrue 
 161               	 
 162               	;----------------------------------------------------------------------
 163               	;
 164               	; ok ( w -- ) 
 165               	; beware, it blocks while test if can send a char 
 166               	;
 167 023a 0000 0445 	HEADER "EMIT", "EMIT", F_LEAP | F_CORE
 167      4D49 5420 
 168 0242 0000      	    NOOP 
 169               	1: 
 170 0244 5D9B      	    sbis 0x0b, 5 
 171 0246 00C0      	    rjmp 1b 
 172               	2: 
 173 0248 8CB9      	    out 0x0c, tos_low 
 174 024a 9991 8991 	    pspull tos_low, tos_high
 175 024e 0C94 0000 	    POON 
 176               	 
 177               	;----------------------------------------------------------------------
 178               	;
 179               	; ok ( -- FALSE | TRUE ) 
 180               	; test if can send a char, or return FALSE 
 181               	;
 182 0252 0000 0545 	HEADER "EMIT?", "QEMIT", F_LEAP | F_CORE
 182      4D49 543F 
 183 025a 0000      	    NOOP 
 184               	3: 
 185 025c 5D9B      	    sbis 0x0b, 5 
 186 025e 00C0      	    rjmp _iffalse 
 187 0260 00C0      	    rjmp _iftrue 
 188               	 
 189               	;----------------------------------------------------------------------
 190               	;
 191               	; ok ( c e -- ) 
 192               	;   write a byte to eprom 
 193               	;
 194 0262 0000 0345 	HEADER "EC!", "ECTO", F_LEAP 
 194      4321 
 195 0268 0000      	    NOOP 
 196 026a 7991 6991 	    pspull nos_low, nos_high
 197               	
 198               	_ee_write:
 199               	; Wait for completion of previous write
 200 026e E199      	    sbic EECR, EEWE
 201 0270 00C0      	    rjmp _ee_write
 202               	
 203               	; Set up address  in address register
 204 0272 9FBB      	    out EEARH, tos_high
 205 0274 8EBB      	    out EEARL, tos_low
 206               	
 207               	; Write data to Data Register
 208 0276 6DBB      	    out EEDR, nos_low
 209               	
 210               	; prepare    
 211 0278 F894      	    cli
 212 027a 2FB6      	    in r2, __SREG__
 213               	
 214               	; Write logical one to EEMPE
 215 027c E29A      	    sbi EECR, EEMWE
 216               	; Start eeprom write by setting EEWE
 217 027e E19A      	    sbi EECR, EEWE
 218               	
 219               	; restore
 220 0280 2FBE      	    out __SREG__, r2
 221 0282 7894      	    sei
 222 0284 0C94 0000 	    POON
 223               	
 224               	;----------------------------------------------------------------------
 225               	;
 226               	; ok ( e -- u ) 
 227               	;   read eeprom
 228               	;
 229 0288 0000 0345 	HEADER "EC@", "ECAT", F_LEAP
 229      4340 
 230 028e 0000      	    NOOP 
 231 0290 7991 6991 	    pspull nos_low, nos_high
 232               	
 233               	_ee_read:
 234               	; Wait for completion of previous write
 235 0294 E199      	    sbic EECR, EEWE
 236 0296 00C0      	    rjmp _ee_read
 237               	
 238               	; Set up address in address register
 239 0298 9FBB      	    out EEARH, tos_high
 240 029a 8EBB      	    out EEARL, tos_low
 241               	
 242               	; Start eeprom read by writing EERE
 243 029c E09A      	    sbi EECR, EERE
 244               	; Read data from Data Register
 245 029e 8DB3      	    in tos_low, EEDR
 246 02a0 9927      	    clr tos_high
 247 02a2 0C94 0000 	    POON
 248               	
 249               	;----------------------------------------------------------------------
 250               	;
 251               	; ok ( w -- u ) 
 252               	; also io@
 253               	; only sram
 254               	;
 255 02a6 0000 0350 	HEADER "PC@", "PCAT", F_LEAP 
 255      4340 
 256 02ac 0000      	    NOOP 
 257               	_peek:
 258 02ae FC01      	    movw zpm_low, tos_low  
 259 02b0 8081      	    ld tos_low, Z
 260 02b2 9927      	    clr tos_high
 261 02b4 0C94 0000 	    POON
 262               	
 263               	;----------------------------------------------------------------------
 264               	;
 265               	; ok ( u w -- ) 
 266               	; also io!
 267               	; only sram
 268               	;
 269 02b8 0000 0350 	HEADER "PC!", "PCTO", F_LEAP
 269      4321 
 270 02be 0000      	    NOOP
 271               	_poke:
 272 02c0 FC01      	    movw zpm_low, tos_low  
 273 02c2 8083      	    st Z, tos_low
 274 02c4 9991 8991 	    pspull tos_low, tos_high
 275 02c8 0C94 0000 	    POON
 276               	    
 277               	;----------------------------------------------------------------------
 278               	;
 279               	; ok ( -- w) 
 280               	; push timer counter 
 281               	;
 282 02cc 0000 064D 	HEADER "MILLIS", "MILLIS", F_LEAP
 282      494C 4C49 
 282      5320 
 283 02d6 0000      	    NOOP 
 284 02d8 8A93 9A93 	    pspush tos_low, tos_high 
 285 02dc 842D      	    mov tos_low, ticks_low 
 286 02de 952D      	    mov tos_high, ticks_high 
 287 02e0 0C94 0000 	    POON 
 288               	 
 289               	/*
 290               	;----------------------------------------------------------------------
 291               	;
 292               	; ok ( -- w) 
 293               	; strat watchdog 
 294               	;
 295               	HEADER "WDCLR", "WDCLR", F_LEAP 
 296               	    NOOP 
 297               	    wdr
 298               	    POON
 299               	
 300               	HEADER "WDON", "WDON", F_LEAP
 301               	    NOOP 
 302               	    in r16, WDTCR
 303               	    ori r16, (WDE)|(WDP2)|(WDP1)|WDP0)
 304               	    out WDTCR, r16
 305               	    POON
 306               	
 307               	HEADER "WDOFF", "WDOFF", F_LEAP
 308               	    NOOP 
 309               		wdr
 310               	    in r16, WDTCR
 311               	    ori r16, (WDTOE)|(WDE)
 312               	    out WDTCR, r16
 313               	    clr r16
 314               	    out WDTCR, r16
 315               	    POON
 316               	*/
 317               	
 318               	;********************************************************************** 
 319               	;
 320               	;   primitive words 
 321               	;
 322               	;----------------------------------------------------------------------
 323               	 
 324               	;----------------------------------------------------------------------
 325               	;
 326               	; ok ( -- -1 ) 
 327               	;
 328 02e4 0000 0454 	HEADER "TRUE", "FTRUE", F_LEAP | F_CORE
 328      5255 4520 
 329 02ec 0000      	    NOOP 
 330 02ee 8A93 9A93 	    pspush tos_low, tos_high 
 331               	_iftrue: 
 332 02f2 8FEF      	    ser tos_low 
 333 02f4 9FEF      	    ser tos_high 
 334 02f6 0C94 0000 	    POON 
 335               	 
 336               	;----------------------------------------------------------------------
 337               	;
 338               	; ok ( -- 0 ) 
 339               	;
 340 02fa 0000 0546 	HEADER "FALSE", "FFALSE", F_LEAP | F_CORE
 340      414C 5345 
 341 0302 0000      	    NOOP 
 342 0304 8A93 9A93 	    pspush tos_low, tos_high 
 343               	_iffalse: 
 344 0308 8827      	    clr tos_low 
 345 030a 9927      	    clr tos_high 
 346 030c 0C94 0000 	    POON 
 347               	 
 348               	;----------------------------------------------------------------------
 349               	;
 350               	; ok 0= 
 351               	;
 352 0310 0000 0230 	HEADER "0=", "ZEQU", F_LEAP | F_CORE
 352      3D20 
 353 0316 0000      	    NOOP 
 354 0318 892B      	    or tos_low, tos_high
 355 031a 01F0      	    brbs BIT_ZERO, _iftrue
 356 031c 01F4      	    brbc BIT_ZERO, _iffalse
 357 031e 0C94 0000 	    POON
 358               	 
 359               	;----------------------------------------------------------------------
 360               	;
 361               	; ok 0< 
 362               	;   using 2's complement, negative always have 0x8000
 363 0322 0000 0230 	HEADER "0<", "ZLTH", F_LEAP | F_CORE
 363      3C20 
 364 0328 0000      	    NOOP 
 365               	    ; 0x80
 366 032a 9078      	    andi tos_high, 0x80
 367 032c 01F4      	    brbc BIT_ZERO, _iftrue
 368 032e 01F0      	    brbs BIT_ZERO, _iffalse
 369 0330 0C94 0000 	    POON
 370               	
 371               	;----------------------------------------------------------------------
 372               	;
 373               	; ok ( u1 u2 -- f ) 
 374               	;   unsigned lessthan 
 375               	;   if u1 < u2, true, else, false
 376               	;
 377 0334 0000 0255 	HEADER "U<", "UMLESS", F_LEAP | F_CORE
 377      3C20 
 378 033a 0000      	    NOOP 
 379 033c 7991 6991 	    pspull nos_low, nos_high 
 380 0340 8894      	    clc 
 381 0342 6817      	    cp  nos_low, tos_low 
 382 0344 7907      	    cpc nos_high, tos_high 
 383               	1:    
 384 0346 04F0      	    brlt 2f 
 385 0348 00C0      	    rjmp _iffalse
 386               	2:
 387 034a 00C0      	    rjmp _iftrue
 388 034c 0C94 0000 	    POON
 389               	
 390               	;----------------------------------------------------------------------
 391               	;
 392               	; ok ( w1 w2 -- w3 c ) 
 393               	;   unsigned plus 
 394               	;
 395 0350 0000 0355 	HEADER "UM+", "UMPLUS", F_LEAP | F_CORE
 395      4D2B 
 396 0356 0000      	    NOOP 
 397 0358 7991 6991 	    pspull nos_low, nos_high 
 398 035c 8894      	    clc 
 399 035e 860F      	    add tos_low, nos_low 
 400 0360 971F      	    adc tos_high, nos_high 
 401 0362 8A93 9A93 	    pspush tos_low, tos_high
 402               	    ; preserve carry
 403               	1:
 404 0366 9927      	    clr tos_high
 405 0368 8827      	    clr tos_low
 406               	2:    
 407 036a 00F4      	    brcc 3f
 408 036c 8395      	    inc tos_low
 409               	3:
 410 036e 0C94 0000 	    POON 
 411               	 
 412               	;----------------------------------------------------------------------
 413               	;
 414               	; ok ! to (w a -- ) 
 415               	; only in sram 
 416               	;
 417 0372 0000 0121 	HEADER "!", "TO", F_LEAP | F_CORE
 418 0376 0000      	    NOOP 
 419 0378 FC01      	    movw  zpm_low, tos_low
 420 037a 9991 8991 	    pspull tos_low, tos_high 
 421 037e 8193      	    srsave tos_low 
 422 0380 9193      	    srsave tos_high
 423 0382 9991 8991 	    pspull tos_low, tos_high 
 424 0386 0C94 0000 	    POON 
 425               	 
 426               	;----------------------------------------------------------------------
 427               	;
 428               	; ok @ at ( a -- w ) 
 429               	; only in sram 
 430               	;
 431 038a 0000 0140 	HEADER "@", "AT", F_LEAP | F_CORE
 432 038e 0000      	    NOOP 
 433 0390 FC01      	    movw zpm_low, tos_low 
 434 0392 8191      	    srload tos_low 
 435 0394 9191      	    srload tos_high 
 436 0396 0C94 0000 	    POON
 437               	 
 438               	;----------------------------------------------------------------------
 439               	;
 440               	; ok @@ at ( a -- a' ) 
 441               	; only in flash, fetches a reference to sram 
 442               	;	that could be used by @ and ! 
 443               	;
 444 039a 0000 0240 	HEADER "@@", "ATAT", F_LEAP 
 444      4020 
 445 03a0 0000      	    NOOP 
 446 03a2 FC01      	    movw zpm_low, tos_low
 447 03a4 EE0F FF1F 	    pmload tos_low, tos_high
 447      8591 9591 
 447      F795 E795 
 448 03b0 0C94 0000 		POON
 449               	    
 450               	;----------------------------------------------------------------------
 451               	; 
 452               	; Note on return stack operations:
 453               	;
 454               	;   the values in ( >R R@ R> ) are placed onto/from second cell of return stack.
 455               	;
 456               	;   this keeps the adjacent reference for inner interpreter, "where it comes" 
 457               	;
 458               	;   that's a side effect of MITC, there is no IP keeped.
 459               	;
 460               	;   that's transparent for user.
 461               	
 462               	;----------------------------------------------------------------------
 463               	;
 464               	; ok ( w -- ) ( -- w) 
 465               	;   vide note above
 466               	;
 467 03b4 0000 223E 	HEADER ">R", "TOR", F_COMPILE | F_LEAP | F_CORE
 467      5220 
 468 03ba 0000      	    NOOP 
 469 03bc 7D91 6D91 	    rspull nos_low, nos_high
 470 03c0 8E93 9E93 	    rspush tos_low, tos_high 
 471 03c4 6E93 7E93 	    rspush nos_low, nos_high
 472 03c8 9991 8991 	    pspull tos_low, tos_high 
 473 03cc 0C94 0000 	    POON 
 474               	 
 475               	;----------------------------------------------------------------------
 476               	;
 477               	; ok ( -- w ) ( w -- ) 
 478               	;   vide note above
 479               	;
 480 03d0 0000 2252 	HEADER "R>", "RTO", F_COMPILE | F_LEAP | F_CORE
 480      3E20 
 481 03d6 0000      	    NOOP 
 482 03d8 8A93 9A93 	    pspush tos_low, tos_high 
 483 03dc 7D91 6D91 	    rspull nos_low, nos_high
 484 03e0 9D91 8D91 	    rspull tos_low, tos_high 
 485 03e4 6E93 7E93 	    rspush nos_low, nos_high
 486 03e8 0C94 0000 	    POON 
 487               	 
 488               	;----------------------------------------------------------------------
 489               	;
 490               	; ok ( -- w ) ( w -- w ) 
 491               	;   vide note above
 492               	;
 493 03ec 0000 2252 	HEADER "R@", "RAT", F_COMPILE | F_LEAP | F_CORE
 493      4020 
 494 03f2 0000      	    NOOP 
 495 03f4 8A93 9A93 	    pspush tos_low, tos_high 
 496 03f8 7D91 6D91 	    rspull nos_low, nos_high
 497 03fc 9D91 8D91 	    rspull tos_low, tos_high 
 498 0400 8E93 9E93 	    rspush tos_low, tos_high 
 499 0404 6E93 7E93 	    rspush nos_low, nos_high
 500 0408 0C94 0000 	    POON 
 501               	 
 502               	;----------------------------------------------------------------------
 503               	;
 504               	; ok ( rsp -- w )  
 505               	;
 506 040c 0000 0352 	HEADER "RS!", "RSTO", F_LEAP | F_CORE
 506      5321 
 507 0412 0000      	    NOOP 
 508 0414 DC01      	    movw rsp_low, tos_low 
 509 0416 9991 8991 	    pspull tos_low, tos_high 
 510 041a 0C94 0000 	    POON 
 511               	 
 512               	;----------------------------------------------------------------------
 513               	;
 514               	; ok ( psp -- w ) 
 515               	;
 516 041e 0000 0350 	HEADER "PS!", "PSTO", F_LEAP | F_CORE
 516      5321 
 517 0424 0000      	    NOOP 
 518 0426 EC01      	    movw psp_low, tos_low 
 519 0428 9991 8991 	    pspull tos_low, tos_high 
 520 042c 0C94 0000 	    POON 
 521               	 
 522               	;----------------------------------------------------------------------
 523               	;
 524               	; ok ( -- rsp) 
 525               	; put the address to top of return stack at tos
 526               	;
 527 0430 0000 0352 	HEADER "RS@", "RSAT", F_LEAP | F_CORE
 527      5340 
 528 0436 0000      	    NOOP 
 529 0438 8A93 9A93 	    pspush tos_low, tos_high 
 530 043c CD01      	    movw tos_low, rsp_low 
 531 043e 0C94 0000 	    POON 
 532               	 
 533               	;----------------------------------------------------------------------
 534               	;
 535               	; ok ( -- psp ) 
 536               	; put the address to top of parameter stack at tos
 537               	;
 538 0442 0000 0350 	HEADER "PS@", "PSAT", F_LEAP | F_CORE
 538      5340 
 539 0448 0000      	    NOOP 
 540 044a 8A93 9A93 	    pspush tos_low, tos_high 
 541 044e CE01      	    movw tos_low, psp_low 
 542 0450 0C94 0000 	    POON 
 543               	
 544               	;----------------------------------------------------------------------
 545               	;
 546               	; ok ( w -- ) 
 547               	;     
 548               	;
 549 0454 0000 0444 	HEADER "DROP", "DROP", F_LEAP | F_CORE
 549      524F 5020 
 550 045c 0000      	    NOOP
 551               	PULL: 
 552 045e 9991 8991 	    pspull tos_low, tos_high 
 553 0462 0C94 0000 	    POON 
 554               	 
 555               	;----------------------------------------------------------------------
 556               	;
 557               	; ok ( w -- w w) 
 558               	;
 559 0466 0000 0344 	HEADER "DUP", "DUP", F_LEAP | F_CORE
 559      5550 
 560 046c 0000      	    NOOP 
 561               	PUSH:
 562 046e 8A93 9A93 	    pspush tos_low, tos_high 
 563 0472 0C94 0000 	    POON 
 564               	 
 565               	;----------------------------------------------------------------------
 566               	;
 567               	; ok ( w2 w1 -- w1 w2 ) 
 568               	;
 569 0476 0000 0453 	HEADER "SWAP", "SWAP", F_LEAP | F_CORE
 569      5741 5020 
 570 047e 0000      	    NOOP 
 571 0480 7991 6991 	    pspull nos_low, nos_high 
 572 0484 8A93 9A93 	    pspush tos_low, tos_high 
 573 0488 CB01      	    movw tos_low, nos_low
 574 048a 0C94 0000 	    POON 
 575               	 
 576               	;----------------------------------------------------------------------
 577               	;
 578               	; ok ( w2 w1 -- w2 w1 w2 ) 
 579               	;
 580 048e 0000 044F 	HEADER "OVER", "OVER", F_LEAP | F_CORE
 580      5645 5220 
 581 0496 0000      	    NOOP 
 582 0498 7991 6991 	    pspull nos_low, nos_high 
 583 049c 6A93 7A93 	    pspush nos_low, nos_high 
 584 04a0 8A93 9A93 	    pspush tos_low, tos_high 
 585 04a4 CB01      	    movw tos_low, nos_low
 586 04a6 0C94 0000 	    POON 
 587               	 
 588               	;----------------------------------------------------------------------
 589               	;
 590               	; ok ( 0 | w -- 0 | w w ) 
 591               	; dup if tos not zero 
 592               	;
 593 04aa 0000 043F 	HEADER "?DUP", "ZDUP", F_LEAP | F_CORE
 593      4455 5020 
 594 04b2 0000      	    NOOP 
 595 04b4 892B      	    or tos_low, tos_high
 596 04b6 01F0      	    brbs BIT_ZERO, 1f 
 597 04b8 8A93 9A93 	    pspush tos_low, tos_high 
 598               	1: 
 599 04bc 0C94 0000 	    POON 
 600               	
 601               	;----------------------------------------------------------------------
 602               	;
 603               	; ok ( w1 w2 -- 0 | -1 ) 
 604               	;
 605 04c0 0000 013C 	HEADER "<", "LTHAN", F_LEAP | F_CORE
 606 04c4 0000      	    NOOP 
 607 04c6 7991 6991 	    pspull nos_low, nos_high 
 608 04ca 8617      	    cp tos_low, nos_low 
 609 04cc 9707      	    cpc tos_high, nos_high 
 610 04ce 04F0      	    brlt 1f 
 611 04d0 00C0      	    rjmp _iffalse
 612               	1:
 613 04d2 00C0      	    rjmp _iftrue
 614 04d4 0C94 0000 	    POON
 615               	 
 616               	;----------------------------------------------------------------------
 617               	;
 618               	; ok ( w1 w2 -- w2 + w1 ) 
 619               	;   signed plus
 620               	;
 621 04d8 0000 012B 	HEADER "+", "PLUS", F_LEAP | F_CORE
 622 04dc 0000      	    NOOP 
 623 04de 7991 6991 	    pspull nos_low, nos_high 
 624 04e2 8894      	    clc 
 625 04e4 860F      	    add tos_low, nos_low 
 626 04e6 971F      	    adc tos_high, nos_high 
 627 04e8 0C94 0000 	    POON 
 628               	 
 629               	;----------------------------------------------------------------------
 630               	;
 631               	; ok ( w1 w2 -- w1 - w2 ) 
 632               	;   signed minus, 0 5 -- -5
 633               	;
 634 04ec 0000 012D 	HEADER "-", "MINUS", F_LEAP | F_CORE
 635 04f0 0000      	    NOOP 
 636 04f2 7991 6991 	    pspull nos_low, nos_high 
 637 04f6 8894      	    clc 
 638 04f8 681B      	    sub nos_low, tos_low 
 639 04fa 790B      	    sbc nos_high, tos_high 
 640 04fc CB01      	    movw tos_low, nos_low
 641 04fe 0C94 0000 	    POON 
 642               	 
 643               	;----------------------------------------------------------------------
 644               	;
 645               	; ok ( w1 w2 -- w2 NAND w1 ) 
 646               	;
 647 0502 0000 044E 	HEADER "NAND", "NAND", F_LEAP | F_CORE
 647      414E 4420 
 648 050a 0000      	    NOOP 
 649 050c 7991 6991 	    pspull nos_low, nos_high 
 650 0510 8623      	    and tos_low, nos_low 
 651 0512 9723      	    and tos_high, nos_high 
 652 0514 6095      	    com nos_low 
 653 0516 7095      	    com nos_high 
 654 0518 0C94 0000 	    POON 
 655               	
 656               	;----------------------------------------------------------------------
 657               	;
 658               	; ok ( w1 w2 -- w2 AND w1 ) 
 659               	;
 660 051c 0000 0341 	HEADER "AND", "AND", F_LEAP | F_CORE
 660      4E44 
 661 0522 0000      	    NOOP 
 662 0524 7991 6991 	    pspull nos_low, nos_high 
 663 0528 8623      	    and  tos_low, nos_low 
 664 052a 9723      	    and  tos_high, nos_high 
 665 052c 0C94 0000 	    POON 
 666               	 
 667               	;----------------------------------------------------------------------
 668               	;
 669               	; ok ( w1 w2 -- w2 OR w1 ) 
 670               	;
 671 0530 0000 024F 	HEADER "OR", "OR", F_LEAP | F_CORE
 671      5220 
 672 0536 0000      	    NOOP 
 673 0538 7991 6991 	    pspull nos_low, nos_high 
 674 053c 862B      	    or   tos_low, nos_low 
 675 053e 972B      	    or   tos_high, nos_high 
 676 0540 0C94 0000 	    POON 
 677               	 
 678               	;----------------------------------------------------------------------
 679               	;
 680               	; ok ( w1 w2 -- w2 XOR w1 ) 
 681               	;
 682 0544 0000 0358 	HEADER "XOR", "XOR", F_LEAP | F_CORE
 682      4F52 
 683 054a 0000      	    NOOP 
 684 054c 7991 6991 	    pspull nos_low, nos_high 
 685 0550 8627      	    eor  tos_low, nos_low 
 686 0552 9727      	    eor  tos_high, nos_high 
 687 0554 0C94 0000 	    POON 
 688               	 
 689               	;----------------------------------------------------------------------
 690               	;
 691               	; ok INV 
 692               	;
 693 0558 0000 0649 	HEADER "INVERT", "INVERT", F_LEAP | F_CORE
 693      4E56 4552 
 693      5420 
 694 0562 0000      	    NOOP 
 695               	_inv: 
 696 0564 8095      	    com tos_low 
 697 0566 9095      	    com tos_high 
 698 0568 0C94 0000 	    POON 
 699               	 
 700               	;----------------------------------------------------------------------
 701               	;
 702               	; ok NEG 
 703               	;
 704 056c 0000 064E 	HEADER "NEGATE", "NEGATE", F_LEAP | F_CORE
 704      4547 4154 
 704      4520 
 705 0576 0000      	    NOOP 
 706               	_neg: 
 707 0578 8195      	    neg tos_low 
 708 057a 9195      	    neg tos_high 
 709 057c 0C94 0000 	    POON 
 710               	 
 711               	;----------------------------------------------------------------------
 712               	;
 713               	; ok ( w -- w * 2 ) same as shift left << 1, unsigned 
 714               	;
 715 0580 0000 0232 	HEADER "2*", "SHL", F_LEAP | F_CORE
 715      2A20 
 716 0586 0000      	    NOOP 
 717               	_shl: 
 718 0588 8894      	    clc 
 719 058a 880F      	    lsl   tos_low 
 720 058c 991F      	    rol   tos_high 
 721 058e 0C94 0000 	    POON 
 722               	 
 723               	;----------------------------------------------------------------------
 724               	;
 725               	; ok ( w -- w / 2 ) same as shift right >> 1, unsigned 
 726               	;
 727 0592 0000 0232 	HEADER "2/", "SHR", F_LEAP | F_CORE
 727      2F20 
 728 0598 0000      	    NOOP 
 729               	_shr: 
 730 059a 8894      	    clc 
 731 059c 8695      	    lsr tos_low 
 732 059e 9795      	    ror tos_high 
 733 05a0 0C94 0000 	    POON 
 734               	 
 735               	;----------------------------------------------------------------------
 736               	;
 737               	; ok ( nAnB -- nBnA ) swap bytes in a word 
 738               	;
 739 05a4 0000 023E 	HEADER "><", "ENDIAN", F_LEAP
 739      3C20 
 740 05aa 0000      	    NOOP 
 741 05ac 482F      	    mov wrk_low, tos_low
 742 05ae 892F      	    mov tos_low, tos_high
 743 05b0 942F      	    mov tos_high, wrk_low
 744 05b2 0C94 0000 	    POON 
 745               	 
 746               	;----------------------------------------------------------------------
 747               	;
 748               	; ok ( -- ) ( branch next reference ) 
 749               	;   no more offsets then no more branch
 750 05b6 0000 0642 	HEADER "BRANCH", "BRANCH", F_LEAP | F_CORE
 750      5241 4E43 
 750      4820 
 751 05c0 0000      	    NOOP 
 752               	_branch: 
 753 05c2 FD91 ED91 	    rspull zpm_low, zpm_high 
 754 05c6 EE0F FF1F 	    pmload nos_low, nos_high 
 754      6591 7591 
 754      F795 E795 
 755 05d2 6E93 7E93 	    rspush nos_low, nos_high 
 756 05d6 0C94 0000 	    POON 
 757               	 
 758               	;----------------------------------------------------------------------
 759               	;
 760               	; ok ( u -- ) 
 761               	; if tos is not zero, skip next 
 762               	; 
 763 05da 0000 0730 	HEADER "0BRANCH", "ZBRANCH", F_LEAP | F_CORE
 763      4252 414E 
 763      4348 
 764 05e4 0000      	    NOOP 
 765 05e6 BC01      	    movw nos_low, tos_low
 766 05e8 9991 8991 	    pspull tos_low, tos_high
 767 05ec 672B      	    or nos_low, nos_high
 768 05ee 01F0      	    breq _branch 
 769               	    ; skips
 770 05f0 FD91 ED91 	    rspull zpm_low, zpm_high 
 771 05f4 3296      	    adiw zpm_low, 2 
 772 05f6 EE93 FE93 	    rspush zpm_low, zpm_high 
 773 05fa 0C94 0000 	    POON
 774               	 
 775               	;----------------------------------------------------------------------
 776               	;
 777               	;  ok LIT ( -- w ), 
 778               	;  push a value from flash to data stack 
 779               	;  note auto increment in pmload
 780               	;
 781 05fe 0000 034C 	HEADER "LIT", "LIT", F_LEAP | F_CORE
 781      4954 
 782 0604 0000      	    NOOP 
 783 0606 8A93 9A93 	    pspush tos_low, tos_high
 784 060a FD91 ED91 	    rspull zpm_low, zpm_high
 785 060e EE0F FF1F 	    pmload tos_low, tos_high 
 785      8591 9591 
 785      F795 E795 
 786 061a EE93 FE93 	    rspush zpm_low, zpm_high
 787 061e 0C94 0000 	    POON 
 788               	 
 789               	;----------------------------------------------------------------------
 790               	;
 791               	; ok ( w -- w ) 
 792               	;  data space pointer align to CELL, atmega is always 
 793               	 
 794               	;
 795 0622 0000 0741 	HEADER "ALIGNED", "ALIGNED", F_LEAP | F_CORE
 795      4C49 474E 
 795      4544 
 796 062c 0000      	    NOOP 
 797 062e 0196      	    adiw tos_low, 1 
 798 0630 8F7F      	    cbr tos_low, 0 
 799 0632 0C94 0000 	    POON 
 800               	 
 801               	;----------------------------------------------------------------------
 802               	;
 803               	; ok ( -- CELL ) 
 804               	; CELL is 2 ; size of a cell 
 805               	;
 806 0636 0000 0443 	HEADER "CELL", "CELL", F_LEAP | F_CORE
 806      454C 4C20 
 807 063e 0000      	    NOOP 
 808 0640 8A93 9A93 	    pspush tos_low, tos_high
 809 0644 82E0      	    ldi tos_low, CELL_SIZE 
 810 0646 9927      	    clr tos_high 
 811 0648 0C94 0000 	    POON 
 812               	 
 813               	;----------------------------------------------------------------------
 814               	;
 815               	; ok C! ( c a -- ) 
 816               	; only works in sram
 817               	;
 818 064c 0000 0243 	HEADER "C!", "CTO", F_LEAP | F_CORE
 818      2120 
 819 0652 0000      	    NOOP 
 820 0654 FC01      	    movw zpm_low, tos_low
 821 0656 9991 8991 	    pspull tos_low, tos_high
 822 065a 8083      	    st Z, tos_low
 823 065c 9991 8991 	    pspull tos_low, tos_high 
 824 0660 0C94 0000 	    POON 
 825               	 
 826               	;----------------------------------------------------------------------
 827               	;
 828               	; ok C@ ( a -- c ) 
 829               	; only works in sram
 830               	;
 831 0664 0000 0243 	HEADER "C@", "CAT", F_LEAP | F_CORE
 831      4020 
 832 066a 0000      	    NOOP 
 833 066c FC01      	    movw zpm_low, tos_low
 834 066e 8081      	    ld tos_low, Z
 835 0670 9927      	    clr tos_high
 836 0672 0C94 0000 	    POON 
 837               	;----------------------------------------------------------------------
 838               	;
 839               	; ok ( -- 0 ) 
 840               	;
 841 0676 0000 0130 	HEADER "0", "ZERO", F_LEAP | F_CORE
 842 067a 0000      	    NOOP 
 843 067c 8A93 9A93 	    pspush tos_low, tos_high 
 844 0680 8827      	    clr tos_low 
 845 0682 9927      	    clr tos_high 
 846 0684 0C94 0000 	    POON 
 847               	 
 848               	;----------------------------------------------------------------------
 849               	;
 850               	; ok ( -- 1 ) 
 851               	;
 852 0688 0000 0131 	HEADER "1", "ONE", F_LEAP | F_CORE
 853 068c 0000      	    NOOP 
 854 068e 8A93 9A93 	    pspush tos_low, tos_high 
 855 0692 9927      	    clr tos_high 
 856 0694 81E0      	    ldi tos_low, 1
 857 0696 0C94 0000 	    POON 
 858               	
 859               	;----------------------------------------------------------------------
 860               	;
 861               	; ok ( -- 0 ) 
 862               	;
 863 069a 0000 0132 	HEADER "2", "TWO", F_LEAP | F_CORE
 864 069e 0000      	    NOOP 
 865 06a0 8A93 9A93 	    pspush tos_low, tos_high 
 866 06a4 9927      	    clr tos_high 
 867 06a6 82E0      	    ldi tos_low, 2
 868 06a8 0C94 0000 	    POON 
 869               	 
 870               	;----------------------------------------------------------------------
 871               	 
 143               	
 144               	;----------------------------------------------------------------------
 145               	.p2align 1, 0x00
 146               	#include "forth-twigs.S"
   1               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	;---------------------------------------------------------------------
  29               	;
  30               	;    A small Forth for ATmega8 
  31               	;
  32               	;---------------------------------------------------------------------
  33               	; dictionary structure 
  34               	;
  35               	; cell size is a word of 16 bits 
  36               	;
  37               	; .word  link    link to previous 
  38               	; .byte  size    sizeof name OR flags 
  39               	; .ascii "name"  name, plus a pad byte with BL (0x32) if size is even 
  40               	; .word  param,  many references 
  41               	;
  42               	;----------------------------------------------------------------------
  43               	 
  44               	;
  45               	; classics 
  46               	;
  48               	.LIST 
  49               	 
  50               	;********************************************************************** 
  51               	; FORTH
  52               	;
  53               	;    the follow definitions of compound words 
  54               	;    are as already compiled into a list of references, 
  55               	;    that is a sequence of cells. 
  56               	;    No preorder because the assembler does translation 
  57               	;    of names to address (references) 
  58               	;
  59               	;    (some adapted from old fig-forth and eforth istings) 
  60               	;
  61               	;********************************************************************** 
  62               	
  63               	;----------------------------------------------------------------------
  64               	;
  65               	; ok ( w a -- ) 
  66               	;	w = b1b2 ~~ [a] = b1, [a+1] = b2
  67               	; just write a word
  68               	;
  69 06ac 0000 0245 	HEADER "E!", "ETO", F_LEAP
  69      2120 
  70 06b2 0000 0000 	    .word OVER, OVER, ECTO, ONE, PLUS, TOR, ENDIAN, RTO, ECTO, ENDS   
  70      0000 0000 
  70      0000 0000 
  70      0000 0000 
  70      0000 0000 
  71               	
  72               	;----------------------------------------------------------------------
  73               	;
  74               	; ok ( a -- w ) 
  75               	;   [a] = b1, [a+1] = b2 ~~ w = b1b2
  76               	;   w1 0x00ff and, w2 0x00ff and, 
  77               	;   w1 = b100, w2 = b300, w2 endian, w2 = 00b3
  78               	;   w1 w2 or
  79               	;
  80 06c6 0000 0245 	HEADER "E@", "EAT", F_LEAP
  80      4020 
  81 06cc 0000 0000 	    .word DUP, ECAT, SWAP, ECAT
  81      0000 0000 
  82 06d4 0000 FF00 	    .word LIT, 0x00FF, AND
  82      0000 
  83 06da 0000 0000 	    .word ENDIAN, SWAP
  84 06de 0000 FF00 	    .word LIT, 0x00FF, AND
  84      0000 
  85 06e4 0000 0000 	    .word OR, ENDS
  86               	
  87               	;********************************************************************** 
  88               	;
  89               	;   stack words
  90               	;
  91               	;----------------------------------------------------------------------
  92               	;
  93               	; ok ( w2 w1 -- w1 ) 
  94               	;
  95 06e8 0000 034E 	HEADER "NIP", "NIP",
  95      4950 
  96 06ee 0000 0000 	    .word SWAP, DROP, ENDS 
  96      0000 
  97               	 
  98               	;----------------------------------------------------------------------
  99               	;
 100               	; ok ( w3 w2 w1 -- w2 w3 w1 ) 
 101               	;
 102 06f4 0000 0453 	HEADER "SWIP", "SWIP",
 102      5749 5020 
 103 06fc 0000 0000 	    .word TOR, SWAP, RTO, ENDS 
 103      0000 0000 
 104               	 
 105               	;----------------------------------------------------------------------
 106               	;
 107               	; ok ( w2 w1 -- w2 w1 w2 ) 
 108               	; moved to primitives
 109               	;HEADER "OVER", "OVER",
 110               	;    .word TOR, DUP, RTO, SWAP, ENDS 
 111               	 
 112               	;----------------------------------------------------------------------
 113               	;
 114               	; ok ( w3 w2 w1 -- w2 w1 w3 ) 
 115               	;
 116 0704 0000 0352 	HEADER "ROT", "ROTU",
 116      4F54 
 117 070a 0000 0000 	    .word SWIP, SWAP, ENDS 
 117      0000 
 118               	 
 119               	;----------------------------------------------------------------------
 120               	;
 121               	; ok ( w3 w2 w1 -- w1 w3 w2 ) 
 122               	;
 123 0710 0000 042D 	HEADER "-ROT", "ROTD",
 123      524F 5420 
 124 0718 0000 0000 	    .word SWAP, SWIP, ENDS 
 124      0000 
 125               	 
 126               	;----------------------------------------------------------------------
 127               	;
 128               	; ok ( w2 w1 --  w1 w2 w1 ) 
 129               	;
 130 071e 0000 0454 	HEADER "TUCK", "TUCK",
 130      5543 4B20 
 131 0726 0000 0000 	    .word SWAP, OVER, ENDS 
 131      0000 
 132               	 
 133               	;----------------------------------------------------------------------
 134               	;
 135               	; ok ( w3 w2 w1 --  w1 w2 w3 ) 
 136               	;
 137 072c 0000 0446 	HEADER "FLIP", "FLIP",
 137      4C49 5020 
 138 0734 0000 0000 	    .word SWAP, SWIP, SWAP, ENDS 
 138      0000 0000 
 139               	
 140               	;----------------------------------------------------------------------
 141               	;
 142               	; ok ( w1 w2 -- 0 | -1) 
 143               	;
 144 073c 0000 013D 	HEADER "=", "EQUAL",
 145 0740 0000 0000 	    .word MINUS, ZEQU, ENDS 
 145      0000 
 146               	 
 147               	;----------------------------------------------------------------------
 148               	;
 149               	; ok ( w1 w2 -- 0 | -1) 
 150               	;
 151 0746 0000 023C 	HEADER "<>", "NOTEQUAL",
 151      3E20 
 152 074c 0000 0000 	    .word EQUAL, INVERT, ENDS 
 152      0000 
 153               	 
 154               	;----------------------------------------------------------------------
 155               	;
 156               	; ok ( w1 w2 -- 0 | -1 ) 
 157               	; w1 > w2
 158 0752 0000 013E 	HEADER ">", "GTHAN",
 159 0756 0000 0000 	    .word SWAP, LTHAN, ENDS 
 159      0000 
 160               	 
 161               	;----------------------------------------------------------------------
 162               	;  ok 0>  must be signed 
 163               	;
 164 075c 0000 0230 	HEADER "0>", "ZEROGT",
 164      3E20 
 165 0762 0000 0000 	     .word ZERO, LTHAN, ENDS 
 165      0000 
 166               	 
 167               	;----------------------------------------------------------------------
 168               	;  ok 0< must be signed 
 169               	;
 170 0768 0000 0230 	HEADER "0<", "ZEROLT",
 170      3C20 
 171 076e 0000 0000 	    .word ZERO, SWAP, LTHAN, ENDS 
 171      0000 0000 
 172               	 
 173               	;----------------------------------------------------------------------
 174               	;
 175               	; ok ( w -- w * CELL  ) 
 176               	; CELL is 2, multiply by 2, easy way 
 177               	;
 178 0776 0000 0543 	HEADER "CELLS", "CELLS",
 178      454C 4C53 
 179 077e 0000 0000 	    .word SHL, ENDS 
 180               	 
 181               	;----------------------------------------------------------------------
 182               	;
 183               	; ok ( w -- w + CELL ) 
 184               	;
 185 0782 0000 0543 	HEADER "CELL+", "CELLPLUS",
 185      454C 4C2B 
 186 078a 0000 0000 	    .word CELL, PLUS, ENDS 
 186      0000 
 187               	 
 188               	;----------------------------------------------------------------------
 189               	;
 190               	; ok ( w -- w - CELL ) 
 191               	;
 192 0790 0000 0543 	HEADER "CELL-", "CELLMINUS",
 192      454C 4C2D 
 193 0798 0000 0000 	    .word CELL, MINUS, ENDS 
 193      0000 
 194               	 
 195               	;----------------------------------------------------------------------
 196               	;
 197               	; ok ( w -- w + 1 ) 
 198               	;
 199 079e 0000 0231 	HEADER "1+", "ONEPLUS",
 199      2B20 
 200 07a4 0000 0000 	     .word ONE, PLUS, ENDS 
 200      0000 
 201               	 
 202               	;----------------------------------------------------------------------
 203               	;
 204               	; ok ( w -- w - 1 ) 
 205               	;
 206 07aa 0000 0231 	HEADER "1-", "ONEMINUS",
 206      2D20 
 207 07b0 0000 0000 	     .word ONE, MINUS, ENDS 
 207      0000 
 208               	 
 209               	;----------------------------------------------------------------------
 210               	;
 211               	; ok ( w -- w + 2 ) 
 212               	;
 213 07b6 0000 0232 	HEADER "2+", "TWOPLUS",
 213      2B20 
 214 07bc 0000 0000 	     .word TWO, PLUS, ENDS 
 214      0000 
 215               	 
 216               	;----------------------------------------------------------------------
 217               	;
 218               	; ok ( w -- w - 2 ) 
 219               	;
 220 07c2 0000 0232 	HEADER "2-", "TWOMINUS",
 220      2D20 
 221 07c8 0000 0000 	     .word TWO, MINUS, ENDS 
 221      0000 
 222               	 
 223               	;----------------------------------------------------------------------
 224               	;
 225               	; ok ( u w -- ) 
 226               	;
 227 07ce 0000 022B 	HEADER "+!", "PLUSTO",
 227      2120 
 228 07d4 0000 0000 	    .word DUP, TOR, AT, PLUS, RTO, TO, ENDS 
 228      0000 0000 
 228      0000 0000 
 228      0000 
 229               	 
 230               	;----------------------------------------------------------------------
 231               	;
 232               	; ok ( w -- w + 1 ) 
 233               	;
 234 07e2 0000 0543 	HEADER "CHAR+", "CHARPLUS",
 234      4841 522B 
 235 07ea 0000 0000 	    .word ONEPLUS, ENDS 
 236               	 
 237               	;----------------------------------------------------------------------
 238               	;
 239               	; ok ( w -- w - 1 ) 
 240               	;
 241 07ee 0000 0543 	HEADER "CHAR-", "CHARMINUS",
 241      4841 522D 
 242 07f6 0000 0000 	    .word ONEMINUS, ENDS 
 243               	 
 244               	;----------------------------------------------------------------------
 245               	;
 246               	; ok ( w -- w ) 
 247               	;   char is 1, then does nothing
 248               	;
 249 07fa 0000 0543 	HEADER "CHARS", "CHARS",
 249      4841 5253 
 250 0802 0000      	    .word ENDS 
 251               	 
 252               	;********************************************************************** 
 253               	;
 254               	;    load variables 
 255               	;
 256               	;----------------------------------------------------------------------
 257               	;
 258               	; ok ( -- w) 
 259               	;
 260 0804 0000 0354 	HEADER "TIB", "TIB",
 260      4942 
 261 080a 0000 0000 	    .word LIT, TIB0, ENDS
 261      0000 
 262 0810 0C94 0000 	    POON 
 263               	 
 264               	;----------------------------------------------------------------------
 265               	;
 266               	; ok ( -- w) 
 267               	;
 268 0814 0000 0553 	HEADER "STATE", "STATE",
 268      5441 5445 
 269 081c 0000 0000 	    .word LIT, STAT, ENDS 
 269      0000 
 270               	 
 271               	;----------------------------------------------------------------------
 272               	;
 273               	; ok ( -- w) 
 274               	;
 275 0822 0000 0442 	HEADER "BASE", "BASE",
 275      4153 4520 
 276 082a 0000 0000 	    .word LIT, BASE, ENDS
 276      0000 
 277               	 
 278               	;----------------------------------------------------------------------
 279               	;
 280               	; ok ( -- w) 
 281               	;   keep PS for checks
 282 0830 0000 0343 	HEADER "CSP", "CSP",
 282      5350 
 283 0836 0000 0000 	    .word LIT, CSPP, ENDS
 283      0000 
 284               	 
 285               	;----------------------------------------------------------------------
 286               	;
 287               	; ok ( -- w) 
 288               	;
 289 083c 0000 0245 	HEADER "EP", "EPP",
 289      5020 
 290 0842 0000 0000 	    .word LIT, VEP, ENDS
 290      0000 
 291               	 
 292               	;----------------------------------------------------------------------
 293               	;
 294               	; ok ( -- w) 
 295               	;
 296 0848 0000 0244 	HEADER "DP", "DPP",
 296      5020 
 297 084e 0000 0000 	    .word LIT, VDP, ENDS
 297      0000 
 298               	 
 299               	;----------------------------------------------------------------------
 300               	;
 301               	; ok ( -- w) 
 302               	;
 303 0854 0000 0248 	HEADER "HP", "HPP",
 303      5020 
 304 085a 0000 0000 	    .word LIT, VHP, ENDS
 304      0000 
 305               	 
 306               	;----------------------------------------------------------------------
 307               	;
 308               	; ok ( -- w) 
 309               	; stack for variables from end of stacks
 310               	;
 311 0860 0000 0255 	HEADER "UP", "UPP",
 311      5020 
 312 0866 0000 0000 	    .word LIT, VUP, ENDS
 312      0000 
 313               	 
 314               	;----------------------------------------------------------------------
 315               	;
 316               	; ok ( -- w) 
 317               	; buffer for user, att not updates UP
 318               	;
 319 086c 0000 0442 	HEADER "BUFF", "BUFF",
 319      5546 4620 
 320 0874 0000 0000 	    .word UPP, SWAP, MINUS, ENDS
 320      0000 0000 
 321               	 
 322               	;----------------------------------------------------------------------
 323               	;
 324               	; ok ( -- w) 
 325               	; buffer for user, shares variables
 326               	;
 327 087c 0000 0350 	HEADER "PAD", "PAD",
 327      4144 
 328 0882 0000 4800 	    .word LIT, PAD_SIZE, BUFF, ENDS
 328      0000 0000 
 329               	 
 330               	;----------------------------------------------------------------------
 331               	;
 332               	; ok ( -- w) 
 333               	;
 334               	;HEADER "RS$", "RSIS",
 335               	;    .word LIT, RS0, ENDS
 336               	 
 337               	;----------------------------------------------------------------------
 338               	;
 339               	; ok ( -- w) 
 340               	;
 341               	;HEADER "PS$", "PSIS",
 342               	;    .word LIT, PS0, ENDS
 343               	 
 344               	
 345               	;----------------------------------------------------------------------
 346               	;
 347               	; ok ( -- w) 
 348               	;
 349 088a 0000 0544 	HEADER "DEPTH", "DEPTH",
 349      4550 5448 
 350 0892 0000 0000 	    .word PSAT, LIT, PS0, MINUS, ENDS
 350      0000 0000 
 350      0000 
 351               	 
 352               	;----------------------------------------------------------------------
 353               	;
 354               	; ok ( -- w) 
 355               	;
 356 089c 0000 0652 	HEADER "RDEPTH", "RDEPTH",
 356      4445 5054 
 356      4820 
 357 08a6 0000 0000 	    .word RSAT, LIT, RS0, MINUS, ENDS
 357      0000 0000 
 357      0000 
 358               	 
 359               	
 360               	;********************************************************************** 
 361               	; 
 362               	;   vocabulary words
 363               	;
 364               	;   just a hook, not using, in AVR only one vocabulary
 365               	;
 366               	;----------------------------------------------------------------------
 367 08b0 0000 0743 	HEADER "CURRENT", "CURRENT",
 367      5552 5245 
 367      4E54 
 368 08ba 0000 0000 	    .word LIT, CURR, ENDS
 368      0000 
 369               	
 370               	;----------------------------------------------------------------------
 371 08c0 0000 0743 	HEADER "CONTEXT", "CONTEXT",
 371      4F4E 5445 
 371      5854 
 372 08ca 0000 0000 	    .word LIT, CTXT, ENDS
 372      0000 
 373               	
 374               	;----------------------------------------------------------------------
 375 08d0 0000 0B44 	HEADER "DEFINITIONS", "DEFINITIONS",
 375      4546 494E 
 375      4954 494F 
 375      4E53 
 376 08de 0000 0000 	    .word CONTEXT, AT, CURRENT, TO, ENDS
 376      0000 0000 
 376      0000 
 377               	
 378               	;----------------------------------------------------------------------
 379 08e8 0000 064C 	HEADER "LATEST", "LATEST",
 379      4154 4553 
 379      5420 
 380 08f2 0000 0000 	    .word LIT, LAST, ENDS
 380      0000 
 381               	 
 382               	;********************************************************************** 
 383               	; 
 384               	;   basic words
 385               	;
 386               	;----------------------------------------------------------------------
 387               	;   strange changes ?
 388               	;   all compilation is done in sram, then need a trick
 389               	;
 390               	;   up is a pointer to next free cell in sram, from the end of TIB
 391               	;   dp is a pointer to next free cell in flash
 392               	;   hp is a pointer to next free cell in sram, syncronous with dp 
 393               	;
 394               	;   here return where dp is, used for absolute branch and zbranch,
 395               	;   uhere returns where hp is, used for place in sram,
 396               	;   comma writes in sram, and allot updates up and dp pointers
 397               	;   when done to write sram to flash
 398               	;
 399               	;----------------------------------------------------------------------
 400               	;
 401               	; ok HERE ( -- w ) 
 402               	;
 403 08f8 0000 0555 	HEADER "UHERE", "UHERE",
 403      4845 5245 
 404 0900 0000 0000 	    .word HPP, AT, ENDS 
 404      0000 
 405               	 
 406               	;----------------------------------------------------------------------
 407               	;
 408               	; ok HERE ( -- w ) 
 409               	;
 410 0906 0000 0448 	HEADER "HERE", "HERE", F_CORE
 410      4552 4520 
 411 090e 0000 0000 	    .word DPP, AT, ENDS 
 411      0000 
 412               	 
 413               	;----------------------------------------------------------------------
 414               	;
 415               	; ok ALLOT ( u -- ) 
 416               	; not standart: updates DP and UP
 417               	 
 418 0914 0000 0541 	HEADER "ALLOT", "ALLOT", F_CORE
 418      4C4C 4F54 
 419 091c 0000      	    .word DUP
 420 091e 0000 0000 	    .word HPP, AT, PLUS, HPP, TO 
 420      0000 0000 
 420      0000 
 421 0928 0000 0000 	    .word DPP, AT, PLUS, DPP, TO 
 421      0000 0000 
 421      0000 
 422 0932 0000      	    .word ENDS 
 423               	 
 424               	;----------------------------------------------------------------------
 425               	;
 426               	; is ALIGN 
 427               	; not standart: updates DP and UP
 428               	;
 429 0934 0000 0541 	HEADER "ALIGN", "ALIGN", F_CORE
 429      4C49 474E 
 430 093c 0000 0000 	    .word HPP, AT, ALIGNED, HPP, TO
 430      0000 0000 
 430      0000 
 431 0946 0000 0000 	    .word DPP, AT, ALIGNED, DPP, TO
 431      0000 0000 
 431      0000 
 432 0950 0000      	    .word ENDS 
 433               	 
 434               	;----------------------------------------------------------------------
 435               	;
 436               	; ok CCOMMA ( w -- ) 
 437               	;
 438 0952 0000 4243 	HEADER "C,", "CCOMMA", F_IMMEDIATE | F_CORE
 438      2C20 
 439 0958 0000 0000 	    .word UHERE, CTO, ONE, ALLOT, ENDS 
 439      0000 0000 
 439      0000 
 440               	 
 441               	;----------------------------------------------------------------------
 442               	;
 443               	; ok COMMMA ( w -- ) 
 444               	;
 445 0962 0000 412C 	HEADER ",", "COMMA", F_IMMEDIATE | F_CORE
 446 0966 0000 0000 	    .word UHERE, TO, CELL, ALLOT, ENDS 
 446      0000 0000 
 446      0000 
 447               	 
 448               	;----------------------------------------------------------------------
 449               	;
 450               	; ok TOMMA ( a2 a1 -- ) 
 451               	; not standart, no updates DP or UP, 
 452               	;   just do TO (a2 a1-a2+UP -- )
 453               	;
 454 0970 0000 423C 	HEADER "<,", "TOMMA", F_IMMEDIATE
 454      2C20 
 455 0976 0000 0000 	    .word OVER, MINUS, UHERE, PLUS, TO, ENDS 
 455      0000 0000 
 455      0000 0000 
 456               	 
 457               	;-------------------------------------'---------------------------------
 458               	;
 459               	; is DOVAR ( -- a ), place the address of next cell into stack, 
 460               	;   R> DUP 2+ >R
 461               	;
 462               	;	note: the address is at flash, then if is a reference to a value
 463               	;	it must be de-referenced to sram 
 464               	;	      
 465 0982 0000 0544 	HEADER "DOVAR", "DOVAR",
 465      4F56 4152 
 466 098a 0000 0000 	    .word RTO, DUP, TWOPLUS, TOR, ENDS 
 466      0000 0000 
 466      0000 
 467               	 
 468               	;-------------------------------------'---------------------------------
 469               	;
 470               	; is DOCON ( -- a ), place the contents of next cell into stack, 
 471               	;   R> DUP 2+ >R @
 472               	;
 473               	;	note: the address is at flash, then if is a reference
 474               	;   to a value, it must be de-referenced (ATAT) to sram 
 475               	;
 476 0994 0000 0544 	HEADER "DOCON", "DOCON",
 476      4F43 4F4E 
 477 099c 0000 0000 	    .word DOVAR, ATAT, AT, ENDS 
 477      0000 0000 
 478               	
 479               	;----------------------------------------------------------------------
 480               	;
 481               	; is LITERAL ( w -- ) 
 482               	;
 483 09a4 0000 074C 	HEADER "LITERAL", "LITERAL", F_CORE
 483      4954 4552 
 483      414C 
 484 09ae 0000 0000 	    .word LIT, LIT, COMMA, COMMA, ENDS 
 484      0000 0000 
 484      0000 
 485               	 
 486               	;----------------------------------------------------------------------
 487               	;
 488               	; is ['] ( w -- ) 
 489               	; zzzz
 490 09b8 0000 035B 	HEADER "[']", "KTICK", F_CORE
 490      275D 
 491 09be 0000 0000 	    .word LIT, LIT, COMMA, ENDS 
 491      0000 0000 
 492               	 
 493               	;----------------------------------------------------------------------
 494               	;
 495               	; ok this puts next cell into stack and compiles into HERE 
 496               	; used only in precompiled sources as forth-twigs
 497               	; 
 498 09c6 0000 4443 	HEADER "COMP", "COMP", F_IMMEDIATE
 498      4F4D 5020 
 499 09ce 0000 0000 	    .word RTO, DUP, CELLPLUS, TOR, ATAT, COMMA, ENDS 
 499      0000 0000 
 499      0000 0000 
 499      0000 
 500               	 
 501               	;----------------------------------------------------------------------
 502               	;
 503               	; ok compile a eow 
 504               	;
 505 09dc 0000 4445 	HEADER "EXIT", "EXIT", F_IMMEDIATE
 505      5849 5420 
 506 09e4 0000 0000 	    .word COMP, ENDS, ENDS
 506      0000 
 507               	
 508               	;----------------------------------------------------------------------
 509               	;
 510               	; ok execute xt from tos
 511               	;
 512 09ea 0000 4745 	HEADER "EXECUTE", "EXEC", F_IMMEDIATE
 512      5845 4355 
 512      5445 
 513 09f4 0000 0000 	    .word TOR, ENDS
 514               	
 515               	;----------------------------------------------------------------------
 516               	;
 517               	; ok make a word recursive 
 518               	; recursive return to last 
 519               	;
 520 09f8 0000 0454 	HEADER "TAIL", "TAIL", 
 520      4149 4C20 
 521 0a00 0000 0000 	    .word RAT, CELL, MINUS, TOR, ENDS
 521      0000 0000 
 521      0000 
 522               	
 523               	;----------------------------------------------------------------------
 524               	;
 525               	; Control words review. BRANCH and ZBRANCH are absolute references.
 526               	;
 527               	;----------------------------------------------------------------------
 528               	 
 529               	;----------------------------------------------------------------------
 530               	;
 531               	; ok MARKTO 
 532               	; places a address of cell
 533               	; places to address to self in a holder, 
 534               	; and left address of holder at stack
 535               	;
 536 0a0a 0000 664D 	HEADER "MARKTO", "MARKTO", F_IMMEDIATE | F_COMPILE,
 536      4152 4B54 
 536      4F20 
 537 0a14 0000 0000 	    .word HERE, DUP, COMMA, ENDS 
 537      0000 0000 
 538               	 
 539               	;----------------------------------------------------------------------
 540               	;
 541               	; ok TOMARK 
 542               	; places a address of cell 
 543               	; resolves a back reference to last holder 
 544               	; and places a address to self at holder 
 545 0a1c 0000 6654 	HEADER "TOMARK", "TOMARK", F_IMMEDIATE | F_COMPILE,
 545      4F4D 4152 
 545      4B20 
 546 0a26 0000 0000 	    .word HERE, SWAP, TOMMA, ENDS 
 546      0000 0000 
 547               	 
 548               	;----------------------------------------------------------------------
 549               	;
 550               	; ok BEGIN 
 551               	;
 552 0a2e 0000 6542 	HEADER "BEGIN", "BEGIN", F_IMMEDIATE | F_COMPILE,
 552      4547 494E 
 553 0a36 0000 0000 	    .word HERE, ENDS 
 554               	 
 555               	;----------------------------------------------------------------------
 556               	;
 557               	; ok AGAIN resolves a unconditional branch 
 558               	;
 559 0a3a 0000 6541 	HEADER "AGAIN", "AGAIN", F_IMMEDIATE | F_COMPILE,
 559      4741 494E 
 560 0a42 0000 0000 	    .word COMP, BRANCH, COMMA, ENDS 
 560      0000 0000 
 561               	 
 562               	;----------------------------------------------------------------------
 563               	;
 564               	; ok UNTIL resolves a conditional branch, as C do { ... } while (0) 
 565               	;
 566 0a4a 0000 6555 	HEADER "UNTIL", "UNTIL", F_IMMEDIATE | F_COMPILE,
 566      4E54 494C 
 567 0a52 0000 0000 	    .word COMP, ZBRANCH, COMMA, ENDS 
 567      0000 0000 
 568               	 
 569               	;----------------------------------------------------------------------
 570               	;
 571               	; ok UNLESS 
 572               	;
 573 0a5a 0000 6655 	HEADER "UNLESS", "UNLESS", F_IMMEDIATE | F_COMPILE, 
 573      4E4C 4553 
 573      5320 
 574 0a64 0000 0000 	    .word ZEQU, UNTIL, ENDS 
 574      0000 
 575               	 
 576               	;----------------------------------------------------------------------
 577               	;
 578               	; ok IF (executed if tos is not zero)
 579               	;
 580 0a6a 0000 6249 	HEADER "IF", "IF", F_IMMEDIATE | F_COMPILE,
 580      4620 
 581 0a70 0000 0000 	    .word COMP, ZBRANCH, MARKTO, ENDS 
 581      0000 0000 
 582               	 
 583               	;----------------------------------------------------------------------
 584               	;
 585               	; ok GO (executed ever)
 586               	;
 587 0a78 0000 6247 	HEADER "GO", "GO", F_IMMEDIATE | F_COMPILE,
 587      4F20 
 588 0a7e 0000 0000 	    .word COMP, BRANCH, MARKTO, ENDS 
 588      0000 0000 
 589               	 
 590               	;----------------------------------------------------------------------
 591               	;
 592               	; ok THEN 
 593               	;
 594 0a86 0000 6454 	HEADER "THEN", "THEN", F_IMMEDIATE | F_COMPILE,
 594      4845 4E20 
 595 0a8e 0000 0000 	    .word ENDIF, ENDS 
 596               	 
 597               	;----------------------------------------------------------------------
 598               	;
 599               	; ok ENDIF resolves a forward branch 
 600               	;
 601 0a92 0000 6545 	HEADER "ENDIF", "ENDIF", F_IMMEDIATE | F_COMPILE,
 601      4E44 4946 
 602 0a9a 0000 0000 	    .word TOMARK, ENDS 
 603               	 
 604               	;----------------------------------------------------------------------
 605               	;
 606               	; ok ELSE (executed if tos is zero)
 607               	;
 608 0a9e 0000 6445 	HEADER "ELSE", "ELSE", F_IMMEDIATE | F_COMPILE,
 608      4C53 4520 
 609 0aa6 0000 0000 	    .word GO, SWAP, TOMARK, ENDS 
 609      0000 0000 
 610               	 
 611               	;----------------------------------------------------------------------
 612               	;
 613               	; ok WHILE 
 614               	;
 615 0aae 0000 6557 	HEADER "WHILE", "WHILE", F_IMMEDIATE | F_COMPILE,
 615      4849 4C45 
 616 0ab6 0000 0000 	    .word IF, SWAP, ENDS 
 616      0000 
 617               	 
 618               	;----------------------------------------------------------------------
 619               	;
 620               	; ok REPEAT 
 621               	;
 622 0abc 0000 6652 	HEADER "REPEAT", "REPEAT", F_IMMEDIATE | F_COMPILE,
 622      4550 4541 
 622      5420 
 623 0ac6 0000 0000 	    .word AGAIN, TOMARK, ENDS 
 623      0000 
 624               	 
 625               	 
 626               	;----------------------------------------------------------------------
 627               	; @eforth
 628               	; is AHEAD (a forward goto)
 629               	;
 630 0acc 0000 6541 	HEADER "AHEAD", "AHEAD", F_IMMEDIATE | F_COMPILE,
 630      4845 4144 
 631 0ad4 0000 0000 	    .word GO, ENDS 
 632               	 
 633               	;----------------------------------------------------------------------
 634               	; @eforth
 635               	; is AFT 
 636               	;
 637 0ad8 0000 6341 	HEADER "AFT", "AFT", F_IMMEDIATE | F_COMPILE,
 637      4654 
 638 0ade 0000 0000 	    .word DROP, GO, HERE, SWAP, ENDS 
 638      0000 0000 
 638      0000 
 639               	 
 640               	;----------------------------------------------------------------------
 641               	;
 642               	; is HOOK 
 643               	;
 644 0ae8 0000 6448 	HEADER "HOOK", "HOOK", F_IMMEDIATE | F_COMPILE,
 644      4F4F 4B20 
 645 0af0 0000 0000 	    .word BEGIN, TOR, ENDS 
 645      0000 
 646               	 
 647               	;----------------------------------------------------------------------
 648               	;
 649               	; is BACK 
 650               	;
 651 0af6 0000 6442 	HEADER "BACK", "BACK", F_IMMEDIATE | F_COMPILE,
 651      4143 4B20 
 652 0afe 0000 0000 	    .word RTO, AGAIN, ENDS 
 652      0000 
 653               	 
 654               	;----------------------------------------------------------------------
 655               	;
 656               	; is FOR ( u -- h ; -- u )
 657               	; count down, from +32767
 658 0b04 0000 4346 	HEADER "FOR", "FOR", F_IMMEDIATE
 658      4F52 
 659 0b0a 0000 0000 	    .word COMP, TOR, BEGIN, ENDS 
 659      0000 0000 
 660               	 
 661               	;----------------------------------------------------------------------
 662               	;
 663               	; is TXEN ( -- ; -- u ) 
 664               	;
 665 0b12 0000 0454 	HEADER "TXEN", "TXEN", 
 665      5845 4E20 
 666 0b1a 0000 0000 	    .word RTO, ONEMINUS
 667 0b1e 0000 0000 	    .word DUP, ZBRANCH, 1f  
 667      0000 
 668 0b24 0000      	    .word TOR 
 669 0b26 0000      	1:  .word ENDS
 670               	
 671               	;----------------------------------------------------------------------
 672               	;
 673               	; is NEXT ( h -- ) R:( -- h u ) 
 674               	;
 675 0b28 0000 444E 	HEADER "NEXT", "NEXT", F_IMMEDIATE
 675      4558 5420 
 676 0b30 0000 0000 	    .word COMP, TXEN, UNLESS, ENDS
 676      0000 0000 
 677               	
 678               	;----------------------------------------------------------------------
 679               	; rever zzzz
 680               	/*
 681               	\ CASE's implementation imported from Gforth.
 682               	\
 683               	\ Usage
 684               	\ ( n )
 685               	\ CASE
 686               	\    1 OF .... ENDOF
 687               	\    2 OF .... ENDOF
 688               	\    OTHERWISE
 689               	\ END-CASE
 690               	\
 691               	\ Remember not to consume the element in the OTHERWISE case.
 692               	*/
 693               	;----------------------------------------------------------------------
 694               	;
 695               	; is CASE ( a -- )
 696               	;
 697 0b38 0000 4443 	HEADER "CASE", "CASE", F_IMMEDIATE
 697      4153 4520 
 698 0b40 0000 0000 	    .word ZERO, ENDS
 699               	
 700               	;----------------------------------------------------------------------
 701               	;
 702               	; is OF ( -- )
 703               	;
 704 0b44 0000 424F 	HEADER "OF", "OF", F_IMMEDIATE
 704      4620 
 705 0b4a 0000 0000 	    .word ONEPLUS, COMP, OVER, COMP, EQUAL, COMP, IF, COMP, DROP, ENDS
 705      0000 0000 
 705      0000 0000 
 705      0000 0000 
 705      0000 0000 
 706               	
 707               	;----------------------------------------------------------------------
 708               	;
 709               	; is ENDOF ( -- )
 710               	;
 711 0b5e 0000 4545 	HEADER "ENDOF", "ENDOF", F_IMMEDIATE
 711      4E44 4F46 
 712 0b66 0000 0000 	    .word COMP, ELSE, ENDS
 712      0000 
 713               	
 714               	;----------------------------------------------------------------------
 715               	;
 716               	; is DEFAULT ( -- )
 717               	;
 718 0b6c 0000 4744 	HEADER "DEFAULT", "DEFAULT", F_IMMEDIATE
 718      4546 4155 
 718      4C54 
 719 0b76 0000 0000 	    .word COMP, FTRUE, COMP, IF, COMP, DROP, ENDS
 719      0000 0000 
 719      0000 0000 
 719      0000 
 720               	
 721               	;----------------------------------------------------------------------
 722               	;
 723               	; is ENDCASE ( n -- ) 
 724               	;
 725 0b84 0000 4745 	HEADER "ENDCASE", "ENDCASE", F_IMMEDIATE
 725      4E44 4341 
 725      5345 
 726 0b8e 0000 0000 	    .word COMP, DROP 
 727 0b92 0000 0000 	    .word FOR, COMP, THEN, NEXT, ENDS
 727      0000 0000 
 727      0000 
 728               	
 729               	;----------------------------------------------------------------------
 730               	;
 731               	; is DOIT ( n m -- ; -- m n ) 
 732               	; counts from n to m
 733 0b9c 0000 0444 	HEADER "DOIT", "DOIT", 
 733      4F49 5420 
 734 0ba4 0000 0000 	    .word TOR, TOR, ENDS
 734      0000 
 735               	
 736               	;----------------------------------------------------------------------
 737               	;
 738               	; is LOOPN ( k -- f ; m n -- m n+k false | true) 
 739               	;
 740 0baa 0000 062B 	HEADER "+LOOPI", "LOOPN", 
 740      4C4F 4F50 
 740      4920 
 741 0bb4 0000 0000 	    .word DUP, RTO, PLUS, RTO, ROTU ; ( n+k m k )
 741      0000 0000 
 741      0000 
 742 0bbe 0000 0000 	    .word TOR, OVER, OVER, MINUS, RTO ; (n+k m m-n+k k)
 742      0000 0000 
 742      0000 
 743 0bc8 0000 0000 	    .word ZEROLT, ZBRANCH, 4f
 743      0000 
 744 0bce 0000 0000 	    .word LTHAN, ZBRANCH, 8f
 744      0000 
 745 0bd4 0000 0000 	    .word BRANCH, 6f
 746               	4:  
 747 0bd8 0000 0000 	    .word GTHAN, ZBRANCH, 8f
 747      0000 
 748               	6:  
 749 0bde 0000 0000 	    .word TOR, TOR, FFALSE, ENDS ; ( n m v -- f ; -- m n+1 )
 749      0000 0000 
 750               	8:  
 751 0be6 0000 0000 	    .word FTRUE, ENDS
 752               	
 753               	;----------------------------------------------------------------------
 754               	;
 755               	; is LOOPI ( k -- f ; m n -- m n+k false | true) 
 756               	;
 757 0bea 0000 054C 	HEADER "LOOPI", "LOOPI", 
 757      4F4F 5049 
 758 0bf2 0000 0000 	    .word ONE, LOOPN, ENDS
 758      0000 
 759               	
 760               	;----------------------------------------------------------------------
 761               	;
 762               	; is DO ( n m -- ; --  m n ) 
 763               	; counts from n to m
 764               	;
 765 0bf8 0000 4244 	HEADER "DO", "DO", F_IMMEDIATE
 765      4F20 
 766 0bfe 0000 0000 	    .word COMP, DOIT, BEGIN, ENDS
 766      0000 0000 
 767               	
 768               	;----------------------------------------------------------------------
 769               	;
 770               	; is I (  -- n ; m n -- m n ) 
 771               	;
 772 0c06 0000 0149 	HEADER "I", "I", 
 773 0c0a 0000 0000 	    .word RTO, DUP, TOR, ENDS
 773      0000 0000 
 774               	
 775               	;----------------------------------------------------------------------
 776               	;
 777               	; is j (  -- n ; m n -- m n ) 
 778               	;
 779 0c12 0000 014A 	HEADER "J", "J", 
 780 0c16 0000 0000 	    .word RTO, RTO, RTO, DUP, TOR, TOR, TOR, ENDS
 780      0000 0000 
 780      0000 0000 
 780      0000 0000 
 781               	
 782               	;----------------------------------------------------------------------
 783               	;
 784               	; is LEAVE ( n m -- ; -- n m ) 
 785               	;   old way, runs last one
 786               	;
 787 0c26 0000 454C 	HEADER "LEAVE", "LEAVE", F_IMMEDIATE
 787      4541 5645 
 788 0c2e 0000 0000 	    .word UNLOOP, COMP, BRANCH, HERE, DUP, COMMA, EXIT, ENDS
 788      0000 0000 
 788      0000 0000 
 788      0000 0000 
 789               	
 790               	;----------------------------------------------------------------------
 791               	;
 792               	; is LOOP ( -- ; -- m n+1 ) 
 793               	;
 794 0c3e 0000 444C 	HEADER "LOOP", "LOOP", F_IMMEDIATE
 794      4F4F 5020 
 795 0c46 0000 0000 	    .word COMP, LOOPI, UNTIL, ENDS
 795      0000 0000 
 796               	
 797               	;----------------------------------------------------------------------
 798               	;
 799               	; is LOOP ( k -- ; -- m n+k ) 
 800               	;
 801 0c4e 0000 452B 	HEADER "+LOOP", "PLOOP", F_IMMEDIATE
 801      4C4F 4F50 
 802 0c56 0000 0000 	    .word COMP, LOOPN, UNTIL, ENDS
 802      0000 0000 
 803               	
 804               	;----------------------------------------------------------------------
 805               	;
 806               	; is UNLOOP ( -- ; -- m n+1 ) 
 807               	;
 808 0c5e 0000 4655 	HEADER "UNLOOP", "UNLOOP", F_IMMEDIATE
 808      4E4C 4F4F 
 808      5020 
 809 0c68 0000 0000 	    .word RTO, RTO, DROP, DROP, ENDS
 809      0000 0000 
 809      0000 
 810               	
 811               	;**********************************************************************
 812               	;----------------------------------------------------------------------
 813               	;
 814               	; is  ( a u -- )
 815               	;
 816 0c72 0000 0243 	HEADER "CR", "CR",
 816      5220 
 817 0c78 0000 0D00 	    .word LIT, 0x0D, EMIT, ENDS
 817      0000 0000 
 818               	
 819               	;----------------------------------------------------------------------
 820               	;
 821               	; is  ( a u -- )
 822               	;
 823 0c80 0000 024C 	HEADER "LF", "LF",
 823      4620 
 824 0c86 0000 0A00 	    .word LIT, 0x0A, EMIT, ENDS
 824      0000 0000 
 825               	
 826               	;----------------------------------------------------------------------
 827               	;
 828               	; is  ( a u -- )
 829               	;
 830 0c8e 0000 0242 	HEADER "BL", "BL",
 830      4C20 
 831 0c94 0000 2000 	    .word LIT, 0x20, EMIT, ENDS
 831      0000 0000 
 832               	
 833               	;----------------------------------------------------------------------
 834               	;
 835               	; is  ( a u -- )
 836               	;
 837 0c9c 0000 0450 	HEADER "PACE", "PACE",
 837      4143 4520 
 838 0ca4 0000 0B00 	    .word LIT, 0x0B, EMIT, ENDS
 838      0000 0000 
 839               	
 840               	;----------------------------------------------------------------------
 841               	;
 842               	; is  ( a u -- )
 843               	;
 844 0cac 0000 0442 	HEADER "BELL", "BELL",
 844      454C 4C20 
 845 0cb4 0000 0700 	    .word LIT, 0x07, EMIT, ENDS
 845      0000 0000 
 846               	
 847               	;---------------------------------------------------------------------- 
 848               	; 
 849               	; is SPACE ( -- )
 850               	; 
 851 0cbc 0000 0553 	HEADER "SPACE", "SPACE" 
 851      5041 4345 
 852 0cc4 0000 2000 	    .word LIT, 0x20, EMIT, ENDS 
 852      0000 0000 
 853               	 
 854               	;---------------------------------------------------------------------- 
 855               	; 
 856               	; is SPACES ( n -- )
 857               	;   emits until 0
 858 0ccc 0000 0653 	HEADER "SPACES", "SPACES" 
 858      5041 4345 
 858      5320 
 859 0cd6 0000 0000 	1:  .word ZDUP, ZBRANCH, 2f
 859      0000 
 860 0cdc 0000 0000 	    .word SPACE, ONEMINUS, BRANCH, 1b
 860      0000 0000 
 861 0ce4 0000      	2:  .word ENDS 
 862               	 
 863               	;---------------------------------------------------------------------- 
 864               	; 
 865               	; is COUNT ( a -- a+1 c ) 
 866               	; from link to code 
 867 0ce6 0000 0543 	HEADER "COUNT", "COUNT", 
 867      4F55 4E54 
 868 0cee 0000 0000 	    .word DUP, AT, TOR, ONEPLUS, RTO, ENDS 
 868      0000 0000 
 868      0000 0000 
 869               	 
 870               	;----------------------------------------------------------------------
 871               	;
 872               	; is  ( a u -- )
 873               	;
 874 0cfa 0000 0454 	HEADER "TYPE", "TYPE",
 874      5950 4520 
 875 0d02 0000 0000 	1:  .word DUP, ZBRANCH, 2f
 875      0000 
 876 0d08 0000 0000 	    .word ONEMINUS, TOR, DUP, AT, EMIT, ONEPLUS, RTO
 876      0000 0000 
 876      0000 0000 
 876      0000 
 877 0d16 0000 0000 	    .word BRANCH, 1b
 878 0d1a 0000 0000 	2:  .word DROP, DROP, ENDS 
 878      0000 
 879               	  
 880               	;----------------------------------------------------------------------
 881               	;
 882               	; is  ( u1 u2 -- u3 )
 883               	;
 884 0d20 0000 0355 	HEADER "UM-", "UMMINUS",
 884      4D2D 
 885 0d26 0000 0000 	    .word NEGATE, UMPLUS, ENDS
 885      0000 
 886               	
 887               	;----------------------------------------------------------------------
 888               	;   User Stack from end sram
 889               	;
 890               	;----------------------------------------------------------------------
 891               	;
 892               	; is  ( -- )
 893               	;   no checks
 894               	;
 895 0d2c 0000 0255 	HEADER "U-", "ULESS",
 895      2D20 
 896 0d32 0000 0000 	    .word UPP, AT, CELL, MINUS, DUP, UPP, TO, ENDS
 896      0000 0000 
 896      0000 0000 
 896      0000 0000 
 897               	
 898               	;----------------------------------------------------------------------
 899               	;
 900               	; is  ( -- )
 901               	;   no checks
 902               	;
 903 0d42 0000 0255 	HEADER "U+", "UMORE",
 903      2B20 
 904 0d48 0000 0000 	    .word UPP, AT, CELL, PLUS, DUP, UPP, TO, ENDS
 904      0000 0000 
 904      0000 0000 
 904      0000 0000 
 905               	
 906               	;----------------------------------------------------------------------
 907               	;
 908               	; is  ( u -- )
 909               	;
 910 0d58 0000 0255 	HEADER "U@", "UAT",
 910      4020 
 911               	1:
 912 0d5e 0000 0000 	    .word UPP, AT, ENDS
 912      0000 
 913               	
 914               	;----------------------------------------------------------------------
 915               	;
 916               	; is  ( u -- )
 917               	;
 918 0d64 0000 0255 	HEADER "U!", "UTO",
 918      2120 
 919               	1:
 920 0d6a 0000 0000 	    .word UPP, TO, ENDS
 920      0000 
 921               	
 922               	;----------------------------------------------------------------------
 923               	;
 924               	; is  ( u -- )
 925               	;
 926 0d70 0000 023E 	HEADER ">U", "USV",
 926      5520 
 927               	1:
 928 0d76 0000 0000 	    .word UPP, AT, TO, ENDS
 928      0000 0000 
 929               	
 930               	;----------------------------------------------------------------------
 931               	;
 932               	; is  ( -- u )
 933               	;
 934 0d7e 0000 0255 	HEADER "U>", "ULD",
 934      3E20 
 935               	1:
 936 0d84 0000 0000 	    .word UPP, AT, AT, ENDS
 936      0000 0000 
 937               	
 938               	;----------------------------------------------------------------------
 939               	;
 940 0d8c 0000 0543 	HEADER "COLD0", "COLDZERO", F_LEAP
 940      4F4C 4430 
 941               	    
 942 0d94 0000 0000 	    .word LIT, 0x0000, LIT, VOID, TO 
 942      0000 0000 
 942      0000 
 943 0d9e 0000 0000 	    .word LIT, 0x0000, LIT, LIVE, TO 
 943      0000 0000 
 943      0000 
 944 0da8 0000 0000 	    .word LIT, 0x0000, LIT, TURN, TO 
 944      0000 0000 
 944      0000 
 945 0db2 0000 0000 	    .word LIT, 0x0000, LIT, REST, TO 
 945      0000 0000 
 945      0000 
 946               	
 947 0dbc 0000 0000 	    .word LIT, ZZZZ, LIT, LAST, TO 
 947      0000 0000 
 947      0000 
 948 0dc6 0000 0000 	    .word LIT, free_flash, LIT, VDP, TO
 948      0000 0000 
 948      0000 
 949 0dd0 0000 0000 	    .word LIT, EP0, LIT, VEP, TO
 949      0000 0000 
 949      0000 
 950               	
 951 0dda 0000 0000 	    .word LIT, UH0, LIT, VHP, TO
 951      0000 0000 
 951      0000 
 952 0de4 0000 FF08 	    .word LIT, US0, LIT, VUP, TO
 952      0000 0000 
 952      0000 
 953 0dee 0000      	    .word ENDS
 954               	
 955               	;----------------------------------------------------------------------
 956               	;
 957 0df0 0000 0645 	HEADER "EELOAD", "EELOAD", F_LEAP
 957      454C 4F41 
 957      4420 
 958 0dfa 0000 0000 	    .word ZERO, DUP, EAT, LIT, VOID, TO 
 958      0000 0000 
 958      0000 0000 
 959 0e06 0000 0000 	    .word TWO, PLUS, DUP, EAT, LIT, LIVE, TO 
 959      0000 0000 
 959      0000 0000 
 959      0000 
 960 0e14 0000 0000 	    .word TWO, PLUS, DUP, EAT, LIT, TURN, TO 
 960      0000 0000 
 960      0000 0000 
 960      0000 
 961 0e22 0000 0000 	    .word TWO, PLUS, DUP, EAT, LIT, REST, TO 
 961      0000 0000 
 961      0000 0000 
 961      0000 
 962               	
 963 0e30 0000 0000 	    .word TWO, PLUS, DUP, EAT, LIT, LAST, TO 
 963      0000 0000 
 963      0000 0000 
 963      0000 
 964 0e3e 0000 0000 	    .word TWO, PLUS, DUP, EAT, LIT, VDP, TO 
 964      0000 0000 
 964      0000 0000 
 964      0000 
 965 0e4c 0000 0000 	    .word TWO, PLUS, DUP, EAT, LIT, VEP, TO 
 965      0000 0000 
 965      0000 0000 
 965      0000 
 966 0e5a 0000 0000 	    .word TWO, PLUS, DUP, EAT, LIT, VUP, TO 
 966      0000 0000 
 966      0000 0000 
 966      0000 
 967 0e68 0000      	    .word ENDS
 968               	
 969               	;----------------------------------------------------------------------
 970               	;
 971 0e6a 0000 0645 	HEADER "EESAVE", "EESAVE", F_LEAP
 971      4553 4156 
 971      4520 
 972 0e74 0000 0000 	    .word ZERO, DUP, LIT, VOID, AT, SWAP, ETO 
 972      0000 0000 
 972      0000 0000 
 972      0000 
 973 0e82 0000 0000 	    .word TWO, PLUS, DUP, LIT, LIVE, AT, SWAP, ETO 
 973      0000 0000 
 973      0000 0000 
 973      0000 0000 
 974 0e92 0000 0000 	    .word TWO, PLUS, DUP, LIT, TURN, AT, SWAP, ETO 
 974      0000 0000 
 974      0000 0000 
 974      0000 0000 
 975 0ea2 0000 0000 	    .word TWO, PLUS, DUP, LIT, REST, AT, SWAP, ETO 
 975      0000 0000 
 975      0000 0000 
 975      0000 0000 
 976               	
 977 0eb2 0000 0000 	    .word TWO, PLUS, DUP, LIT, LAST, AT, SWAP, ETO 
 977      0000 0000 
 977      0000 0000 
 977      0000 0000 
 978 0ec2 0000 0000 	    .word TWO, PLUS, DUP, LIT, VDP, AT, SWAP, ETO 
 978      0000 0000 
 978      0000 0000 
 978      0000 0000 
 979 0ed2 0000 0000 	    .word TWO, PLUS, DUP, LIT, VEP, AT, SWAP, ETO 
 979      0000 0000 
 979      0000 0000 
 979      0000 0000 
 980 0ee2 0000 0000 	    .word TWO, PLUS, DUP, LIT, VUP, AT, SWAP, ETO 
 980      0000 0000 
 980      0000 0000 
 980      0000 0000 
 981 0ef2 0000      	    .word ENDS
 982               	
 983               	;----------------------------------------------------------------------
 984               	;
 985 0ef4 0000 0443 	HEADER "COLD", "COLD", F_LEAP
 985      4F4C 4420 
 986 0efc 0000      	    .word EELOAD
 987 0efe 0000 0000 	    .word LIT, LIVE, ZEQU, ZBRANCH, _safe
 987      0000 0000 
 987      0000 
 988 0f08 0000 0000 	    .word COLDZERO, EESAVE  
 989               	_safe:    
 990 0f0c 0000 0000 	    .word LIT, RS0, RSTO
 990      0000 
 991 0f12 0000 0000 	    .word LIT, PS0, PSTO
 991      0000 
 992 0f18 0000 0000 	    .word LIT, 0x00, STATE, TO
 992      0000 0000 
 993 0f20 0000 1000 	    .word LIT, 0x10, BASE, TO
 993      0000 0000 
 994 0f28 0000 0000 	    .word LIT, WARM, RTO
 994      0000 
 995 0f2e 0000 0000 	    .word LIT, LIVE, DUP, AT, ONE, PLUS, SWAP, TO 
 995      0000 0000 
 995      0000 0000 
 995      0000 0000 
 996 0f3e 0000      	    .word ENDS 
 997               	 
 998               	;----------------------------------------------------------------------
 999               	;
 1000 0f40 0000 0457 	HEADER "WARM", "WARM", F_LEAP
 1000      4152 4D20 
 1001               	    ; verify error code 
 1002               	    ; resets etc 
 1003 0f48 0000 0000 	    .word TURN, AT, EXEC, QUIT, ENDS 
 1003      0000 0000 
 1003      0000 
 1004               	 
 1005               	;----------------------------------------------------------------------
 1006               	; does reset 
 1007               	;
 1008 0f52 0000 0342 	HEADER "BYE", "BYE", F_LEAP
 1008      5945 
 1009 0f58 0000      	    .word EESAVE
 1010 0f5a 0000 0000 	    .word REST, AT, EXEC, RESET, ENDS 
 1010      0000 0000 
 1010      0000 
 1011               	
 147               	
 148               	;----------------------------------------------------------------------
 149               	.p2align 1, 0x00
 150               	#include "doubles.S"
   1               	
   2               	
   3               	/*
   4               	 *  DISCLAIMER
   5               	 *
   6               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   7               	 *
   8               	 *  Permission is hereby granted, free of charge, to any person obtaining
   9               	 *  a copy of this software and associated documentation files (the
  10               	 *  "Software"), to deal in the Software without restriction, including
  11               	 *  without limitation the rights to use, copy, modify, merge, publish,
  12               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  13               	 *  permit persons to whom the Software is furnished to do so, subject to
  14               	 *  the following conditions:
  15               	 *
  16               	 *  The above copyright notice and this permission notice shall be
  17               	 *  included in all copies or substantial portions of the Software.
  18               	 *
  19               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  20               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  21               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  22               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  23               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  24               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  25               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  26               	 *
  27               	 */
  28               	
  29               	;----------------------------------------------------------------------
  30               	;
  31               	; ok ( w -- w + 4 ) 
  32               	;
  33 0f64 0000 0134 	HEADER "4", "FOUR",
  34 0f68 0000 0400 	     .word LIT, 4, ENDS 
  34      0000 
  35               	 
  36               	;----------------------------------------------------------------------
  37               	;
  38               	; ok ( w -- w + 4 ) 
  39               	;
  40 0f6e 0000 0234 	HEADER "4+", "FOURPLUS",
  40      2B20 
  41 0f74 0000 0400 	     .word LIT, 4, PLUS, ENDS 
  41      0000 0000 
  42               	 
  43               	;----------------------------------------------------------------------
  44               	;
  45               	; ok ( w -- w - 4 ) 
  46               	;
  47 0f7c 0000 0234 	HEADER "4-", "FOURMINUS",
  47      2D20 
  48 0f82 0000 0400 	     .word LIT, 4, MINUS, ENDS 
  48      0000 0000 
  49               	 
  50               	
  51               	;---------------------------------------------------------------------- 
  52               	; 
  53               	; ok 2! ( a1 a2 -- w1 w2 ) 
  54               	; 
  55 0f8a 0000 0232 	HEADER "2!", "TWOTO", 
  55      2120 
  56 0f90 0000 0000 	    .word SWAP, OVER, TO, CELLPLUS, TO, ENDS 
  56      0000 0000 
  56      0000 0000 
  57               	;---------------------------------------------------------------------- 
  58               	; 
  59               	; ok 2@ ( a1 a2 -- w1 w2 ) 
  60               	; 
  61 0f9c 0000 0232 	HEADER "2@", "TWOAT", 
  61      4020 
  62 0fa2 0000 0000 	    .word DUP, CELLPLUS, AT, SWAP, AT, ENDS 
  62      0000 0000 
  62      0000 0000 
  63               	 
  64               	;----------------------------------------------------------------------
  65               	;
  66               	; ok ( w1 w2 -- ) 
  67               	;
  68 0fae 0000 0332 	HEADER "2>R", "TWOTOR",
  68      3E52 
  69 0fb4 0000 0000 	     .word SWAP, RTO, RTO, ENDS 
  69      0000 0000 
  70               	 
  71               	;----------------------------------------------------------------------
  72               	;
  73               	; ok ( w1 w2 -- ) 
  74               	;
  75 0fbc 0000 0332 	HEADER "2R>", "TWORTO",
  75      523E 
  76 0fc2 0000 0000 	     .word RTO, RTO, SWAP, ENDS 
  76      0000 0000 
  77               	 
  78               	;----------------------------------------------------------------------
  79               	;
  80               	; ok ( w1 w2 -- ) 
  81               	;
  82 0fca 0000 0332 	HEADER "2R@", "TWORAT",
  82      5240 
  83 0fd0 0000 0000 	     .word RTO, RTO, OVER, OVER, TOR, TOR, SWAP, ENDS
  83      0000 0000 
  83      0000 0000 
  83      0000 0000 
  84               	 
  85               	;----------------------------------------------------------------------
  86               	;
  87               	; ok ( w1 w2 -- w1 w2 w1 w2 ) 
  88               	;
  89 0fe0 0000 0532 	HEADER "2DROP", "TWODROP",
  89      4452 4F50 
  90 0fe8 0000 0000 	     .word DROP, DROP, ENDS 
  90      0000 
  91               	 
  92               	;----------------------------------------------------------------------
  93               	;
  94               	; ok ( w1 w2 -- w1 w2 w1 w2 ) 
  95               	;
  96 0fee 0000 0432 	HEADER "2DUP", "TWODUP",
  96      4455 5020 
  97 0ff6 0000 0000 	     .word OVER, OVER, ENDS 
  97      0000 
  98               	 
  99               	;----------------------------------------------------------------------
 100               	;
 101               	; ok ( w1 w2 w3 w4 -- w3 w4 w1 w2 ) 
 102               	;
 103 0ffc 0000 0532 	HEADER "2SWAP", "TWOSWAP",
 103      5357 4150 
 104 1004 0000 0000 	     .word ROTU, TOR, ROTU, TOR, ENDS 
 104      0000 0000 
 104      0000 
 105               	     
 106               	;----------------------------------------------------------------------
 107               	;
 108               	; ok ( w1 w2 w3 w4 -- w3 w4 + w1 w2 ) 
 109               	;
 110 100e 0000 0244 	HEADER "D+", "DPLUS",
 110      2B20 
 111 1014 0000 0000 	     .word TOR, SWAP, TOR, UMPLUS, RTO, RTO, PLUS, PLUS, ENDS 
 111      0000 0000 
 111      0000 0000 
 111      0000 0000 
 111      0000 
 112               	     
 113               	;----------------------------------------------------------------------
 114               	;
 115               	; ok ( w1 w2 w3 w4 -- w3 w4 - w1 w2 ) 
 116               	;
 117 1026 0000 0244 	HEADER "D-", "DMINUS",
 117      2D20 
 118 102c 0000 0000 	     .word TOR, SWAP, TOR, UMMINUS, RTO, RTO, MINUS, MINUS, ENDS 
 118      0000 0000 
 118      0000 0000 
 118      0000 0000 
 118      0000 
 119               	     
 120               	;----------------------------------------------------------------------
 121               	;
 122               	; ok ( w1 w2 w3 w4 -- w3 w4 - w1 w2 ) 
 123               	;
 124 103e 0000 0744 	HEADER "DNEGATE", "DNEG",
 124      4E45 4741 
 124      5445 
 125 1048 0000 0000 	     .word INVERT, TOR, INVERT, ONE, UMPLUS, RTO, PLUS, ENDS 
 125      0000 0000 
 125      0000 0000 
 125      0000 0000 
 126               	     
 127               	;----------------------------------------------------------------------
 128               	;
 129               	; ok ( w1 w2 w3 w4 -- w3 w4 - w1 w2 ) 
 130               	;
 131 1058 0000 0444 	HEADER "DABS", "DABS",
 131      4142 5320 
 132 1060 0000 0000 	     .word DUP, ZEROLT, ZBRANCH, 2f
 132      0000 0000 
 133 1068 0000      	     .word DNEG
 134 106a 0000      	2:   .word ENDS 
 135               	     
 136               	;----------------------------------------------------------------------
 137               	...
 151               	
 152               	;----------------------------------------------------------------------
 153               	.p2align 1, 0x00
 154               	#include "math.S"
   1               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	;----------------------------------------------------------------------
  29               	;
  30               	; great DJB hash, adapted for 16bits
  31               	;
  32               	; hash = (hash << 5) + str[i]
  33               	; for ascii chars in sram, in bytes not cells
  34               	; ( a u -- h ) djb hash
  35               	;
  36               	.equ djbHASH, 5381
  37 106c 0000 0448 	HEADER "HASH", "HASH", F_LEAP
  37      4153 4820 
  38 1074 0000      	    NOOP
  39 1076 6624      	    clr _zero_
  40 1078 65E0      	    ldi nos_low, lo8(djbHASH)
  41 107a 75E1      	    ldi nos_high, hi8(djbHASH)
  42 107c F991 E991 	    pspull zpm_low, zpm_high
  43               	
  44               	    ; get a char
  45               	1:    
  46               	    
  47 1080 9817      	    cp tos_high, tos_low
  48 1082 01F0      	    brbs BIT_ZERO, 2f
  49               	
  50 1084 7190      	    ld _work_, Z+
  51 1086 670D      	    add nos_low, _work_
  52 1088 761D      	    adc nos_high, _zero_
  53               	
  54 108a 660F      	    lsl nos_low
  55 108c 771F      	    rol nos_high
  56 108e 660F      	    lsl nos_low
  57 1090 771F      	    rol nos_high
  58 1092 660F      	    lsl nos_low
  59 1094 771F      	    rol nos_high
  60 1096 660F      	    lsl nos_low
  61 1098 771F      	    rol nos_high
  62 109a 660F      	    lsl nos_low
  63 109c 771F      	    rol nos_high
  64               	
  65 109e 0197      	    sbiw tos_low, 1
  66 10a0 00C0      	    rjmp 1b
  67               	    
  68               	2:
  69 10a2 CB01      	    movw tos_low, nos_low
  70 10a4 0C94 0000 	    POON
  71               	
  72               	;----------------------------------------------------------------------
  73               	;
  74               	;   ok  ( -- w)
  75               	;
  76               	;     ©2000-2021 by Gerhard Schmidt,
  77               	;      http://www.avr-asm-tutorial.net/avr_en/apps/random_tn13/random_calc_tn13.html
  78               	;
  79               	;    seed ~ 0x02A8
  80               	;
  81               	;     also good seeds
  82               	;
  83               	;    B167 4A3C 9879 B61E 7B26 
  84               	;    A858 1F88 50D5 419D 5537
  85               	;    0224 0527 5EB6 1E6D BCDC
  86               	;    92FF C206 0ECD 9361 2823
  87               	;    BE0B B303 6462 0E4C 3D24
  88               	;
  89 10a8 0000 0652 	HEADER "RANDOM", "RANDOM", F_LEAP
  89      414E 444F 
  89      4D20 
  90 10b2 0000      	    NOOP
  91               	;    load seed
  92 10b4 4091 0000 	    lds wrk_low, SEED
  93 10b8 5091 0000 	    lds wrk_high, SEED
  94               	;    run magics
  95 10bc 4527      	    eor wrk_low, wrk_high
  96 10be 4295      	    swap wrk_low
  97 10c0 540F      	    add wrk_high, wrk_low
  98 10c2 CA01      	    movw tos_low, wrk_low
  99 10c4 00C0      	    rjmp _seed
 100               	
 101               	;----------------------------------------------------------------------
 102               	;
 103               	;   ok ( w -- ) 
 104               	;   sets seed for rand
 105               	;
 106 10c6 0000 0452 	HEADER "RAND", "RAND", F_LEAP
 106      414E 4420 
 107 10ce 0000      	    NOOP
 108 10d0 AC01      	    movw wrk_low, tos_low
 109 10d2 9991 8991 	    pspull tos_low, tos_high
 110               	_seed:
 111 10d6 4093 0000 	    sts SEED, wrk_low
 112 10da 5093 0000 	    sts SEED + 1, wrk_high
 113 10de 0C94 0000 	    POON
 114               	    
 115               	;----------------------------------------------------------------------
 116               	;
 117               	;   ok ( w -- u) 
 118               	;
 119 10e2 0000 0341 	HEADER "ABS", "ABS", F_LEAP 
 119      4253 
 120 10e8 0000 0000 	    .word DUP, ZEROLT, ZBRANCH, 2f
 120      0000 0000 
 121 10f0 0000      	    .word NEGATE
 122 10f2 0000      	2:  .word ENDS
 123               	
 124               	;----------------------------------------------------------------------
 125               	;
 126               	;   is ( w1 w2 -- w) 
 127               	;
 128 10f4 0000 034D 	HEADER "MAX", "MAX", F_LEAP
 128      4158 
 129 10fa 0000 0000 	    .word TWODUP, LTHAN, ZBRANCH, 2f
 129      0000 0000 
 130 1102 0000      		.word SWAP 
 131 1104 0000 0000 	2:	.word DROP, ENDS
 132               	
 133               	;----------------------------------------------------------------------
 134               	;
 135               	;   is ( w1 w2 -- w) 
 136               	;
 137 1108 0000 034D 	HEADER "MIN", "MIN", F_LEAP
 137      494E 
 138 110e 0000 0000 	    .word SWAP, MAX, ENDS
 138      0000 
 139               	
 140               	;----------------------------------------------------------------------
 141               	;
 142               	;   is ( w1 w2 w3 -- f ) 
 143               	;
 144 1114 0000 0657 	HEADER "WITHIN", "WITHIN", F_LEAP
 144      4954 4849 
 144      4E20 
 145 111e 0000 0000 	    .word OVER, MINUS, TOR, MINUS, RTO, UMLESS, ENDS
 145      0000 0000 
 145      0000 0000 
 145      0000 
 146               	
 147               	;----------------------------------------------------------------------
 148               	;
 149               	;	from Dr. Ting eForth
 150               	;
 151               	;----------------------------------------------------------------------
 152               	;
 153               	; ok ( commom pass for mul and div)
 154               	; 
 155 112c 0000 0655 	HEADER "UMPASS", "UMPASS",
 155      4D50 4153 
 155      5320 
 156 1136 0000      	    NOOP
 157 1138 0000 0000 	    .word DUP, UMPLUS, TOR, TOR, DUP, UMPLUS, RTO, PLUS, ENDS
 157      0000 0000 
 157      0000 0000 
 157      0000 0000 
 157      0000 
 158               	 
 159               	;----------------------------------------------------------------------
 160               	;	divides
 161               	;----------------------------------------------------------------------
 162               	;
 163               	; ok ( ud u -- ur uq)
 164               	; 
 165 114a 0000 0655 	HEADER "UM/MOD", "UMDIVMOD", 
 165      4D2F 4D4F 
 165      4420 
 166 1154 0000      	    NOOP
 167 1156 0000 0000 	    .word OVER, OVER, ULESS, ZBRANCH, 8f 
 167      0000 0000 
 167      0000 
 168 1160 0000      	 2: .word NEGATE
 169 1162 0000 0F00 		.word LIT, 15, FOR
 169      0000 
 170 1168 0000 0000 	    .word TOR, UMPASS, DUP
 170      0000 
 171 116e 0000 0000 	    .word RTO, RAT, SWAP, TOR, UMPLUS, RTO, OR, ZBRANCH, 4f
 171      0000 0000 
 171      0000 0000 
 171      0000 0000 
 171      0000 
 172 1180 0000 0000 	    .word TOR, DROP, ONEPLUS, RTO, BRANCH, 6f 
 172      0000 0000 
 172      0000 0000 
 173 118c 0000      	4:  .word DROP
 174 118e 0000      	6:  .word RTO 
 175 1190 0000      	    .word NEXT
 176 1192 0000 0000 	    .word DROP, SWAP, ENDS
 176      0000 
 177 1198 0000 0000 	8:  .word DROP, DROP, DROP, FTRUE, DUP, ENDS
 177      0000 0000 
 177      0000 0000 
 178               	
 179               	;----------------------------------------------------------------------
 180               	;
 181               	; ok *
 182 11a4 0000 054D 	HEADER "M/MOD", "MDIVMOD", F_LEAP
 182      2F4D 4F44 
 183 11ac 0000      	    NOOP
 184 11ae 0000 0000 	    .word DUP, ZEROLT, DUP, TOR, ZBRANCH, 2f 
 184      0000 0000 
 184      0000 0000 
 185 11ba 0000 0000 	    .word NEGATE, TOR, DNEG, RTO
 185      0000 0000 
 186 11c2 0000 0000 	2:  .word TOR, DUP, ZEROLT, ZBRANCH, 4f 
 186      0000 0000 
 186      0000 
 187 11cc 0000 0000 	    .word RAT, PLUS
 188 11d0 0000 0000 	4:  .word RTO, UMDIVMOD, RTO, ZBRANCH, 6f
 188      0000 0000 
 188      0000 
 189 11da 0000 0000 	    .word SWAP, NEGATE, SWAP
 189      0000 
 190 11e0 0000      	6:  .word ENDS
 191               	
 192               	;----------------------------------------------------------------------
 193               	;
 194               	; ok *
 195 11e2 0000 042F 	HEADER "/MOD", "DIVMOD", F_LEAP
 195      4D4F 4420 
 196 11ea 0000      	    NOOP
 197 11ec 0000 0000 	    .word OVER, ZEROLT, SWAP, MDIVMOD, ENDS
 197      0000 0000 
 197      0000 
 198               	
 199               	;----------------------------------------------------------------------
 200               	;
 201               	; ok *
 202 11f6 0000 034D 	HEADER "MOD", "MOD", F_LEAP
 202      4F44 
 203 11fc 0000      	    NOOP
 204 11fe 0000 0000 	    .word DIVMOD, DROP, ENDS
 204      0000 
 205               	
 206               	;----------------------------------------------------------------------
 207               	;
 208               	; ok *
 209 1204 0000 012F 	HEADER "/", "DIV", F_LEAP
 210 1208 0000      	    NOOP
 211 120a 0000 0000 	    .word DIVMOD, SWAP, DROP, ENDS
 211      0000 0000 
 212               	
 213               	;----------------------------------------------------------------------
 214               	;	multiplies
 215               	;----------------------------------------------------------------------
 216               	;
 217               	; ok *
 218 1212 0000 0355 	HEADER "UM*", "UMSTAR", F_LEAP
 218      4D2A 
 219 1218 0000      	    NOOP
 220 121a 0000 0000 	    .word ZERO, SWAP
 221 121e 0000 0F00 	    .word LIT, 15, FOR
 221      0000 
 222 1224 0000 0000 	    .word UMPASS, RTO, ZBRANCH, 4f
 222      0000 0000 
 223 122c 0000 0000 	    .word TOR, OVER, UMPLUS, RTO, PLUS
 223      0000 0000 
 223      0000 
 224 1236 0000      	4:  .word NEXT
 225 1238 0000 0000 	    .word ROTU, DROP, ENDS 
 225      0000 
 226               	
 227               	;----------------------------------------------------------------------
 228               	;
 229               	; ok *
 230 123e 0000 012A 	HEADER "*", "STAR", F_LEAP
 231 1242 0000      	    NOOP
 232 1244 0000 0000 	    .word UMSTAR, DROP, ENDS
 232      0000 
 233               	
 234               	;----------------------------------------------------------------------
 235               	;
 236               	; ok *
 237 124a 0000 024D 	HEADER "M*", "MSTAR", F_LEAP
 237      2A20 
 238 1250 0000      	    NOOP
 239 1252 0000 0000 	    .word OVER, OVER, XOR, ZEROLT, TOR, ABS, SWAP, ABS, UMSTAR
 239      0000 0000 
 239      0000 0000 
 239      0000 0000 
 239      0000 
 240 1264 0000 0000 	    .word RTO, ZBRANCH, 2f
 240      0000 
 241 126a 0000      	    .word DNEG
 242 126c 0000      	2:  .word ENDS
 243               	
 244               	;----------------------------------------------------------------------
 245               	;
 246               	; ok *
 247 126e 0000 052A 	HEADER "*/MOD", "STARDIVMOD", F_LEAP
 247      2F4D 4F44 
 248 1276 0000      	    NOOP
 249 1278 0000 0000 	    .word TOR, MSTAR, TOR, MDIVMOD, ENDS
 249      0000 0000 
 249      0000 
 250               	
 251               	;----------------------------------------------------------------------
 252               	;
 253               	; ok *
 254 1282 0000 022A 	HEADER "*/", "STARDIV", F_LEAP
 254      2F20 
 255 1288 0000      	    NOOP
 256 128a 0000 0000 	    .word STARDIVMOD, SWAP, DROP, ENDS
 256      0000 0000 
 257               	
 258               	;----------------------------------------------------------------------
 259               	; a 64 bit half number, 7FFF FFFF FFFF FFFF is 9.223.372.036.854.775.807
 260               	;----------------------------------------------------------------------
 261               	...
 155               	
 156               	;----------------------------------------------------------------------
 157               	.p2align 1, 0x00
 158               	#include "flush.S"
   1               	
   2               	/*
   3               	 *  DISCLAIMER
   4               	 *
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos,
   6               	 *
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining
   8               	 *  a copy of this software and associated documentation files (the
   9               	 *  "Software"), to deal in the Software without restriction, including
  10               	 *  without limitation the rights to use, copy, modify, merge, publish,
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to
  12               	 *  permit persons to whom the Software is furnished to do so, subject to
  13               	 *  the following conditions:
  14               	 *
  15               	 *  The above copyright notice and this permission notice shall be
  16               	 *  included in all copies or substantial portions of the Software.
  17               	 *
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  24               	 *  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
  25               	 *
  26               	 */
  27               	
  28               	/*
  29               	
  30               	routines for flush flash memory
  31               	
  32               	*/
  33               	
  34               	;---------------------------------------------------------------------
  35               	;
  36               	;    for easy using spm from optiboot 
  37               	;
  38               	;    spm instruction uses r31:r30 for address and r1:r0 for data
  39               	;
  40               	;    when erase or write, r0:r1 is ignored, 
  41               	;
  42               	;   ATmega8L datasheet, pg 209
  43               	;
  44               	;   command passed in r24
  45               	;
  46               	;   in optiboot.c version 8.3 :
  47               	;   
  48               	;	byte address !!!
  49               	; 
  50               	;    __boot_rww_enable_short();
  51               	;    7fd2:       87 bf           out     0x37, r24       ; 55
  52               	;    7fd4:       e8 95           spm
  53               	;    7fd6:       08 95           ret
  54               	;
  55               	;   do not expeculate, only one page to "flash flush"
  56               	;   minimal optiboot uses last 256 words at 7e00 ( 3F00 words) 
  57               	;   and the sequence: bf 87 95 e8 95 08
  58               	;
  59               	;   commands are: 
  60               	;    0x01 fill buffer, 
  61               	;    0x03 erase page, 
  62               	;    0x05 write page
  63               	;   set SPMCR and do a SPM whithin 4 cycles
  64               	;
  65               	;    about 3.5 to 4.5 ms to complete write !
  66               	;
  67               	;---------------------------------------------------------------------
  68               	
  69               	
  70               	; small trick, in macros.S
  71               	
  72               	; pagesize = (SPM_PAGE - 1)
  73               	
  74               	; pagemask = (~pagesize)
  75               	
  76               	;----------------------------------------------------------------------
  77               	;
  78               	;   load a flash memory page (fa sa -- )
  79               	;   copy one flash page from flash address fa to sram address sa
  80               	;
  81 1292 0000 0C28 	HEADER "(load_flash)", "LDFLASH"
  81      6C6F 6164 
  81      5F66 6C61 
  81      7368 2920 
  82 12a2 0000      	    NOOP
  83               	
  84               	    ; origin in ps
  85               	
  86 12a4 F991 E991 	    pspull zpm_low, zpm_high
  87               	
  88               	    ; preserve parameter tack
  89               	
  90 12a8 CE93 DE93 	    rspush psp_low, psp_high
  91               	
  92               	    ; move destin from tos
  93               	
  94 12ac EC01      	    movw psp_low, tos_low
  95               	
  96               	    ; adjust address for lpm
  97 12ae E695      	    lsr zpm_low
  98 12b0 FF1F      	    rol zpm_high
  99               	
 100               	    ; how many bytes
 101 12b2 4091 8000 	    lds wrk_low, SPM_SIZE
 102               	
 103               	1:
 104 12b6 5591      	    lpm wrk_high, Z+
 105 12b8 5D93      	    st X+, wrk_high
 106 12ba 4A95      	    dec wrk_low
 107 12bc 01F4      	    brne 1b
 108               	
 109               	; clean house
 110               	
 111 12be DD91 CD91 	    rspull psp_low, psp_high
 112               	
 113 12c2 9991 8991 	    pspull tos_low, tos_high
 114               	
 115 12c6 0C94 0000 	    POON
 116               	
 117               	;----------------------------------------------------------------------
 118               	;
 119               	;   save a flash memory page (sa fa -- )
 120               	;   copy one flash page from sram address sa to flash address fa
 121               	;   registers exposed are used for optiboot compiled with gcc
 122               	;
 123 12ca 0000 0C28 	HEADER "(save_flash)", "SVFLASH"
 123      7361 7665 
 123      5F66 6C61 
 123      7368 2920 
 124 12da 0000      	    NOOP
 125               	
 126               	    ; destin
 127               	
 128 12dc FC01      	    movw zpm_low, tos_low ; tos is HERE
 129               	
 130               	    ; origin
 131               	
 132 12de 7991 6991 	    pspull nos_low, nos_high ; nos is FIB0
 133               	
 134               	    ; save psp 
 135               	
 136 12e2 CE93 DE93 	    rspush psp_low, psp_high ; is X index
 137               	
 138               	    ; load for index
 139               	
 140 12e6 EB01      	    movw psp_low, nos_low
 141               	
 142               	    ; save address 
 143 12e8 EE93 FE93 	    rspush zpm_low, zpm_high
 144               	
 145               	;-----------------------------------------------------------------
 146               	
 147               	    ; erase page
 148               	    ; r0:r1 is ignored, ATmega8L datasheet, pg 209
 149 12ec 83E0      	    ldi r24, (1<<PGERS) | (1<<SPMEN)
 150 12ee 00D0      	    rcall _does_spm
 151               	
 152               	;-----------------------------------------------------------------
 153               	
 154               	    ; start buffer page address
 155               	    
 156 12f0 EE27      	    clr zpm_low
 157 12f2 FF27      	    clr zpm_high
 158               	
 159               	    ; how many bytes, less than 256!
 160 12f4 70E8      	    ldi r23, SPM_SIZE
 161               	
 162               	    ; copy page to buffer, word by word
 163               	2:
 164               	    ; fill page flash from sram
 165 12f6 0D90      	    ld r0, X+
 166 12f8 1D90      	    ld r1, X+
 167 12fa 81E0      	    ldi r24, (1<<SPMEN)
 168 12fc 00D0      	    rcall _does_spm
 169 12fe 3296      	    adiw zpm_low, 2
 170               	    ; count down
 171 1300 7A95      	    dec r23
 172 1302 7A95      	    dec r23
 173 1304 01F4      	    brne 2b
 174               	
 175               	;-----------------------------------------------------------------
 176               	
 177               	    ; load flash page address
 178               	
 179 1306 FD91 ED91 	    rspull zpm_low, zpm_high
 180               	
 181               	    ; write page
 182               	    ; r0:r1 is ignored, ATmega8L datasheet, pg 209
 183 130a 85E0      	    ldi r24, (1<<PGWRT) | (1<<SPMEN)
 184 130c 00D0      	    rcall _does_spm
 185               	
 186               	;-----------------------------------------------------------------
 187               	   ; enable
 188 130e 81E1      	    ldi r24, 0x11
 189 1310 00D0      	    rcall _does_spm
 190               	;-----------------------------------------------------------------
 191               	
 192               	    ; clean house
 193 1312 DD91 CD91 	    rspull psp_low, psp_high
 194 1316 9991 8991 	    pspull tos_low, tos_high
 195 131a 0C94 0000 	    POON
 196               	
 197               	;----------------------------------------------------------------------
 198               	;
 199               	; wrapper around optiboot code
 200               	;
 201               	 
 202               	; call spm in NWWM
 203               	_does_spm:
 204 131e F894      	    cli
 205 1320 2FB6      	    in r2, __SREG__
 206               	
 207               	#ifdef atmega8
 208               	; for a atmega8 with optiboot 512b
 209               	#define OPTI_DO_SPM_SHORT 0x1fca    ; in bytes
 210               	    rcall OPTI_DO_SPM_SHORT
 211               	#endif
 212               	
 213               	#ifdef atmega328
 214               	; for a atmega328 with optiboot 512b
 215               	#define OPTI_DO_SPM_SHORT 0x7fd2    ; in bytes
 216               	;#define OPTI_DO_SPM_SHORT 0x3FE9    ; in words
 217 1322 0E94 E93F 	    call OPTI_DO_SPM_SHORT
 218               	#endif
 219               	
 220 1326 2FBE      	    out __SREG__, r2
 221 1328 7894      	    sei
 222               	; wait for complete
 223 132a 07B6      	1:  in      r0, 0x37        ; 55
 224 132c 00FC      	    sbrc    r0, 0
 225 132e 00C0      	    rjmp    1b
 226 1330 0895      	    ret
 227               	 
 228               	;----------------------------------------------------------------------
 229               	/* from optiboot version 8.2 listing, extra comments added
 159               	
 160               	;----------------------------------------------------------------------
 161               	.p2align 1, 0x00
 162               	#include "pictures.S"
   1               	;**********************************************************************
   2               	;
   3               	;   picture number routines adapted
   4               	;   from eForth, 1003_InsideF83, Dr. Ting
   5               	;   
   6               	;----------------------------------------------------------------------
   7               	;
   8               	; those are intented to use together, with no word creation inside.
   9               	;
  10               	;   <# # #S DIGIT HOLD SIGN #>
  11               	;
  12               	;----------------------------------------------------------------------
  13               	;   is DIGIT ( c -- true | false )
  14               	;   eg. 0-9~A-F in base 16, true
  15               	;   ok for bases 2 to 36
  16               	;   no sign or period inside
  17               	;
  18 1332 0000 0544 	HEADER "DIGIT", "DIGIT",
  18      4947 4954 
  19 133a 0000 3000 	    .word LIT, '0', MINUS
  19      0000 
  20 1340 0000 0000 	    .word DUP, ZERO, LTHAN, ZBRANCH, 5f
  20      0000 0000 
  20      0000 
  21 134a 0000 0000 	    .word DUP, LIT, 9, LTHAN, ZBRANCH, 6f
  21      0900 0000 
  21      0000 0000 
  22 1356 0000 0000 	    .word DUP, LIT, 17, LTHAN, ZBRANCH, 5f
  22      1100 0000 
  22      0000 0000 
  23 1362 0000 0700 	    .word LIT, 7, MINUS
  23      0000 
  24 1368 0000 0000 	    .word DUP, BASE, MINUS, LTHAN, ZBRANCH, 6f 
  24      0000 0000 
  24      0000 0000 
  25 1374 0000 0000 	5:  .word DROP, FFALSE, ENDS
  25      0000 
  26 137a 0000 0000 	6:  .word DROP, FTRUE, ENDS
  26      0000 
  27               	
  28               	;----------------------------------------------------------------------
  29               	;   is <#
  30               	;
  31 1380 0000 023C 	HEADER "<#", "LTSNUM",
  31      2320 
  32 1386 0000 0000 	    .word PAD, LIT, HLD, TO, ENDS
  32      0000 0000 
  32      0000 
  33               	
  34               	;----------------------------------------------------------------------
  35               	;   is HOLD
  36               	;   : HOLD HLD @ CHAR- DUP HLD ! C! ; 
  37               	;
  38 1390 0000 0448 	HEADER "HOLD", "HOLD",
  38      4F4C 4420 
  39 1398 0000 0000 	    .word HLD, AT, CHARMINUS, DUP, HLD, TO, CTO, ENDS
  39      0000 0000 
  39      0000 0000 
  39      0000 0000 
  40               	
  41               	;----------------------------------------------------------------------
  42               	;   is #
  43               	;   : # 0 BASE @ UM/MOD >R BASE @ UM/MOD SWAP DIGIT HOLD R> ; 
  44               	;
  45 13a8 0000 0123 	HEADER "#", "SNUM",
  46 13ac 0000 0000 	    .word ZERO, BASE, AT, UMDIVMOD, TOR, BASE, AT, UMDIVMOD
  46      0000 0000 
  46      0000 0000 
  46      0000 0000 
  47 13bc 0000 0000 	    .word SWAP, DIGIT, HOLD, RTO, ENDS
  47      0000 0000 
  47      0000 
  48               	
  49               	;----------------------------------------------------------------------
  50               	;   is #S
  51               	;   : #S BEGIN # 2DUP OR 0= UNTIL ; 
  52               	;   do { ... } while
  53               	;
  54 13c6 0000 0223 	HEADER "#S", "SNUMS",
  54      5320 
  55 13cc 0000 0000 	    .word SNUM, TWODUP, OR, ZEQU, ZBRANCH, SNUMS, ENDS
  55      0000 0000 
  55      0000 0000 
  55      0000 
  56               	
  57               	;----------------------------------------------------------------------
  58               	;   is SIGN
  59               	;   : SIGN 0< IF [CHAR] - HOLD THEN ; 
  60               	;
  61 13da 0000 0453 	HEADER "SIGN", "SIGN",
  61      4947 4E20 
  62 13e2 0000 0000 	    .word ZEROLT, ZBRANCH, 2f
  62      0000 
  63 13e8 0000 0000 	    .word [CHAR], MINUS, HOLD
  63      0000 
  64 13ee 0000      	2:  .word ENDS
  65               	
  66               	;----------------------------------------------------------------------
  67               	;   is #>
  68               	;
  69 13f0 0000 0223 	HEADER "#>", "SNUMGT",
  69      3E20 
  70 13f6 0000 0000 	    .word TWODROP, HLD, AT, PAD, OVER, MINUS, ENDS
  70      0000 0000 
  70      0000 0000 
  70      0000 
  71               	
  72               	;----------------------------------------------------------------------
  73               	
  74               	
  75               	;----------------------------------------------------------------------
  76               	;
  77               	; is  ( u1 u2 -- u3 )
  78               	;
  79 1404 0000 0428 	HEADER "(U.)", "UDOTP",
  79      552E 2920 
  80 140c 0000 0000 	    .word ZERO, LTSNUM, SNUMS, SNUMGT, ENDS
  80      0000 0000 
  80      0000 
  81               	
  82               	;----------------------------------------------------------------------
  83               	;
  84               	; is  ( u1 u2 -- u3 )
  85               	;
  86 1416 0000 0255 	HEADER "U.", "UDOT",
  86      2E20 
  87 141c 0000 0000 	    .word UDOTP, TYPE, SPACE, ENDS
  87      0000 0000 
  88               	
  89               	;----------------------------------------------------------------------
  90               	;
  91               	; is  ( u1 u2 -- u3 )
  92               	;
  93 1424 0000 0355 	HEADER "U.R", "UDOTR",
  93      2E52 
  94 142a 0000 0000 	    .word TOR, UDOTP, RTO, OVER, MINUS, SPACES, ENDS
  94      0000 0000 
  94      0000 0000 
  94      0000 
  95               	
  96               	;----------------------------------------------------------------------
  97               	;
  98               	; is  ( u1 u2 -- u3 )
  99               	;
 100 1438 0000 0328 	HEADER "(.)", "DOTP",
 100      2E29 
 101 143e 0000 0000 	    .word DUP, ABS, 0, LTSNUM, SNUMS, ROTU, SIGN, SNUMGT, ENDS
 101      0000 0000 
 101      0000 0000 
 101      0000 0000 
 101      0000 
 102               	
 103               	;----------------------------------------------------------------------
 104               	;
 105               	; is  ( u1 u2 -- u3 )
 106               	;
 107 1450 0000 012E 	HEADER ".", "DOT",
 108 1454 0000 0000 	    .word DOTP, TYPE, SPACE, ENDS
 108      0000 0000 
 109               	
 110               	;----------------------------------------------------------------------
 111               	;
 112               	; is  ( u1 u2 -- u3 )
 113               	;
 114 145c 0000 013F 	HEADER "?", "QUESTION",
 115 1460 0000 0000 	    .word AT, DOT, ENDS
 115      0000 
 116               	
 117               	;----------------------------------------------------------------------
 118               	;
 119               	; is  ( u1 u2 -- u3 )
 120               	;
 121 1466 0000 022E 	HEADER ".R", "DOTR",
 121      5220 
 122 146c 0000 0000 	    .word TOR, DOTP, RTO, OVER, MINUS, SPACES, TYPE, ENDS
 122      0000 0000 
 122      0000 0000 
 122      0000 0000 
 123               	
 124               	;----------------------------------------------------------------------
 125               	;
 126               	; is  ( u1 u2 -- u3 )
 127               	;
 128 147c 0000 0528 	HEADER "(UD.)", "UDDOTP",
 128      5544 2E29 
 129 1484 0000 0000 	    .word LTSNUM, SNUMS, SNUMGT, ENDS
 129      0000 0000 
 130               	
 131               	;----------------------------------------------------------------------
 132               	;
 133               	; is  ( u1 u2 -- u3 )
 134               	;
 135 148c 0000 0355 	HEADER "UD.", "UDDOT",
 135      442E 
 136 1492 0000 0000 	    .word UDDOTP, TYPE, SPACE, ENDS
 136      0000 0000 
 137               	
 138               	;----------------------------------------------------------------------
 139               	;
 140               	; is  ( u1 u2 -- u3 )
 141               	;
 142 149a 0000 0455 	HEADER "UD.R", "UDDOTR",
 142      442E 5220 
 143 14a2 0000 0000 	    .word TOR, UDDOTP, RTO, OVER, MINUS, SPACES, TYPE, ENDS
 143      0000 0000 
 143      0000 0000 
 143      0000 0000 
 144               	
 145               	;----------------------------------------------------------------------
 146               	;
 147               	; is  ( u1 u2 -- u3 )
 148               	;
 149 14b2 0000 0428 	HEADER "(D.)", "DDOTP",
 149      442E 2920 
 150 14ba 0000 0000 	    .word TUCK, DABS, LTSNUM, SNUMS, ROTU, SIGN, SNUMGT, ENDS
 150      0000 0000 
 150      0000 0000 
 150      0000 0000 
 151               	
 152               	;----------------------------------------------------------------------
 153               	;
 154               	; is  ( u1 u2 -- u3 )
 155               	;
 156 14ca 0000 0244 	HEADER "D.", "DDOT",
 156      2E20 
 157 14d0 0000 0000 	    .word DDOTP, TYPE, SPACE, ENDS
 157      0000 0000 
 158               	
 159               	;----------------------------------------------------------------------
 160               	;
 161               	; is  ( u1 u2 -- u3 )
 162               	;
 163 14d8 0000 0344 	HEADER "D.R", "DDOTR",
 163      2E52 
 164 14de 0000 0000 	    .word TOR, DDOTP, ROTU, OVER, SPACES, TYPE, ENDS
 164      0000 0000 
 164      0000 0000 
 164      0000 
 165               	
 166               	;**********************************************************************
 167               	
 163               	
 164               	;----------------------------------------------------------------------
 165               	.p2align 1, 0x00
 166               	#include "interpreter.S"
   1               	 
   2               	/* 
   3               	 *  DISCLAIMER" 
   4               	 * 
   5               	 *  Copyright © 2020, Alvaro Gomes Sobral Barcellos, 
   6               	 * 
   7               	 *  Permission is hereby granted, free of charge, to any person obtaining 
   8               	 *  a copy of this software and associated documentation files (the 
   9               	 *  "Software"), to deal in the Software without restriction, including 
  10               	 *  without limitation the rights to use, copy, modify, merge, publish, 
  11               	 *  distribute, sublicense, and/or sell copies of the Software, and to 
  12               	 *  permit persons to whom the Software is furnished to do so, subject to 
  13               	 *  the following conditions" 
  14               	 * 
  15               	 *  The above copyright notice and this permission notice shall be 
  16               	 *  included in all copies or substantial portions of the Software. 
  17               	 * 
  18               	 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, 
  19               	 *  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF 
  20               	 *  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
  21               	 *  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE 
  22               	 *  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
  23               	 *  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION 
  24               	 * 
  25               	 */ 
  26               	 
  27               	;---------------------------------------------------------------------- 
  28               	; 
  29               	; minimal interpreter, aka sector forth 
  30               	; inside routines, not for user 
  31               	; 
  32               	;---------------------------------------------------------------------- 
  33               	 
  34               	.section .text
  35               	
  36               	;---------------------------------------------------------------------- 
  37               	;
  38               	; these (words) only works in sram
  39               	;
  40               	;---------------------------------------------------------------------- 
  41               	; 
  42               	; ok ( a1 c --- a2 | 0 ) internal 
  43               	;   skips chars in address while not equal to c or 0x0 
  44               	;   not standart, 0x0 ends buffer, works only in sram 
  45               	; 
  46 14ec 0000 0628 	HEADER "(skip)", "skipf", F_LEAP 
  46      736B 6970 
  46      2920 
  47 14f6 0000      	    NOOP 
  48 14f8 9927      	    clr tos_high 
  49 14fa F991 E991 	    pspull zpm_low, zpm_high 
  50               	1: 
  51 14fe 6081      	    ld nos_low, Z 
  52               	    ; if \0 
  53 1500 9617      	    cp tos_high, nos_low 
  54 1502 01F0      	    breq 2f 
  55               	    ; if c 
  56 1504 8617      	    cp tos_low, nos_low 
  57 1506 01F0      	    breq 3f 
  58 1508 3196      	    adiw zpm_low, 1 
  59 150a 00C0      	    rjmp 1b 
  60               	2: 
  61 150c EE27      	    clr zpm_low 
  62 150e FF27      	    clr zpm_high 
  63               	3: 
  64 1510 CF01      	    movw tos_low, zpm_low 
  65 1512 0C94 0000 	    POON 
  66               	 
  67               	;---------------------------------------------------------------------- 
  68               	; 
  69               	; ok ( a1 c --- a2 | 0 ) internal 
  70               	;   scan chars in address while equal to c or 0x0 
  71               	;   not standart, 0x0 ends buffer 
  72               	; 
  73 1516 0000 0628 	HEADER "(scan)", "scanf", F_LEAP
  73      7363 616E 
  73      2920 
  74 1520 0000      	    NOOP 
  75 1522 9927      	    clr tos_high 
  76 1524 F991 E991 	    pspull zpm_low, zpm_high 
  77               	1: 
  78 1528 6081      	    ld nos_low, Z 
  79               	    ; if \0 
  80 152a 9617      	    cp tos_high, nos_low 
  81 152c 01F0      	    breq 2f 
  82               	    ; if c 
  83 152e 8617      	    cp tos_low, nos_low 
  84 1530 01F4      	    brne 3f 
  85 1532 3196      	    adiw zpm_low, 1 
  86 1534 00C0      	    rjmp 1b 
  87               	2: 
  88 1536 EE27      	    clr zpm_low 
  89 1538 FF27      	    clr zpm_high 
  90               	3: 
  91 153a CF01      	    movw tos_low, zpm_low 
  92 153c 0C94 0000 	    POON 
  93               	 
  94               	;---------------------------------------------------------------------- 
  95               	; 
  96               	; ok ( a1 a2 u --- flag ) internal 
  97               	;   compare u chars from a1 to a2, 
  98               	;   not standart, max 255, no check for overlaps, works only in sram 
  99               	; 
 100 1540 0000 0628 	HEADER "(same)", "samef", F_LEAP 
 100      7361 6D65 
 100      2920 
 101 154a 0000      	    NOOP 
 102 154c 9927      	    clr tos_high 
 103 154e 7991 6991 	    pspull nos_low, nos_high 
 104 1552 F991 E991 	    pspull zpm_low, zpm_high 
 105               	 
 106 1556 CE93 DE93 	    rspush psp_low, psp_high 
 107 155a EB01      	    movw psp_low, nos_low 
 108               	10: 
 109 155c 882B      	    or tos_low, tos_low 
 110 155e 01F0      	    breq 20f 
 111 1560 8A95      	    dec tos_low 
 112               	 
 113 1562 4191      	    ld wrk_low, Z+ 
 114 1564 5991      	    ld wrk_high, Y+ 
 115 1566 4517      	    cp wrk_low, wrk_high 
 116 1568 01F0      	    breq 10b 
 117               	 
 118 156a 8827      	    clr tos_low 
 119 156c 00C0      	    rjmp 30f 
 120               	20: 
 121 156e 8FEF      	    ser tos_low 
 122 1570 9FEF      	    ser tos_high 
 123               	30: 
 124 1572 0C94 0000 	    POON 
 125               	 
 126               	;---------------------------------------------------------------------- 
 127               	; 
 128               	; ok ( a1 a2 u --- a3 ) internal 
 129               	;   copy u chars from a1 into a2, forward copy, a3 = a1+u+1 
 130               	;   not standart, max 255, no check for overlaps, works only in sram 
 131               	; 
 132 1576 0000 0628 	HEADER "(copy)", "copyf", F_LEAP 
 132      636F 7079 
 132      2920 
 133 1580 0000      	    NOOP 
 134 1582 9927      	    clr tos_high 
 135 1584 7991 6991 	    pspull nos_low, nos_high 
 136 1588 F991 E991 	    pspull zpm_low, zpm_high 
 137               	 
 138 158c CE93 DE93 	    rspush psp_low, psp_high 
 139 1590 EB01      	    movw psp_low, nos_low 
 140               	10: 
 141 1592 8817      	    cp tos_low, tos_low 
 142 1594 01F0      	    brbs BIT_ZERO, 20f 
 143               	 
 144 1596 6191      	    ld nos_low, Z+ 
 145 1598 6993      	    st Y+, nos_low 
 146 159a 8A95      	    dec tos_low 
 147 159c 00C0      	    rjmp 10b 
 148               	20: 
 149 159e DD91 CD91 	    rspull psp_low, psp_high 
 150 15a2 CF01      	    movw tos_low, zpm_low 
 151 15a4 0C94 0000 	    POON 
 152               	 
 153               	;---------------------------------------------------------------------- 
 154               	; 
 155               	; ok ( a u --- u ) 
 156               	; 
 157               	;   refills address till u chars read, u < 256 
 158               	;   not standart: 
 159               	;   always read from USART 
 160               	;   only \n \r \b, all other control turns into space 
 161               	;   appends a bl at init and a bl at end 
 162               	; 
 163 15a8 0000 0828 	HEADER "(refill)", "refillf", F_LEAP 
 163      7265 6669 
 163      6C6C 2920 
 164 15b4 0000      	    NOOP 
 165               	10: 
 166               	    ; get buffer pointer 
 167 15b6 F991 E991 	    pspull zpm_low, zpm_high 
 168               	 
 169               	    ; keep a spc at start, so every word starts with spc, 
 170               	    ; used later to make a counted string 
 171               	 
 172               	    ; save for BL at end 
 173 15ba 8A95      	    dec tos_low 
 174               	 
 175               	    ; save for BL at init 
 176 15bc 8A95      	    dec tos_low 
 177               	 
 178               	    ; place a BL at init 
 179 15be 40E2      	    ldi wrk_low, 32 
 180 15c0 4193      	    srsave wrk_low 
 181               	 
 182               	    ; clear count 
 183 15c2 9927      	    clr tos_high 
 184               	 
 185               	    ; clear last char 
 186 15c4 5527      	    clr wrk_high 
 187               	 
 188               	;   loop counts from 0 to u 
 189               	20: 
 190               	    ; end of buffer ? 
 191 15c6 8917      	    cp tos_low, tos_high 
 192 15c8 01F0      	    brbs BIT_ZERO, 70f 
 193               	 
 194               	;   getch 
 195               	30: 
 196               	1: 
 197               	    ; waits to receive 
 198 15ca 5F9B      	    sbis 0xb, 7 
 199 15cc 00C0      	    rjmp 1b 
 200               	 
 201               	    ; receive a char 
 202 15ce 4CB1      	    in wrk_low, 0xc 
 203               	 
 204               	    ; no 8bits 
 205 15d0 4038      	    cpi wrk_low, 128 
 206 15d2 04F4      	    brge 1b 
 207               	 
 208               	    ; need echo ? 
 209               	2: 
 210               	    ; wait to send 
 211 15d4 5D9B      	    sbis 0x0b, 5 
 212 15d6 00C0      	    rjmp 2b 
 213               	 
 214               	    ; send a char 
 215 15d8 4CB9      	    out 0x0c, wrk_low 
 216               	 
 217               	; process allowed control 
 218               	 
 219               	    ; not a control 
 220 15da 4E31      	    cpi wrk_low, 30 
 221 15dc 04F4      	    brge 60f 
 222               	 
 223               	40: 
 224               	    ; verify CR \r 
 225 15de 4D30      	    cpi wrk_low, 13 ; CR 
 226 15e0 01F0      	    breq 70f 
 227               	 
 228               	    ; verify LF \n 
 229 15e2 4A30      	    cpi wrk_low, 10 ; LF 
 230 15e4 01F0      	    breq 70f 
 231               	 
 232               	44: 
 233               	    ; verify BS \b 
 234 15e6 4830      	    cpi wrk_low, 8 ; BS 
 235 15e8 01F4      	    brne 50f 
 236               	 
 237               	    ; process BS 
 238               	    ; no char ? 
 239 15ea 9917      	    cp tos_high, tos_high 
 240 15ec 01F0      	    brbs BIT_ZERO, 30b 
 241               	 
 242               	    ; back one 
 243 15ee 9A95      	    dec tos_high 
 244 15f0 3197      	    sbiw zpm_low, 1 
 245 15f2 00C0      	    rjmp 30b 
 246               	 
 247               	50: 
 248               	    ; not allow more controls 
 249               	    ; magic to 32 
 250 15f4 40E2      	    ldi wrk_low, 32 
 251               	 
 252               	; process ASCII chars 
 253               	60: 
 254               	    ; is a spc ? 
 255 15f6 4032      	    cpi wrk_low, 32 
 256 15f8 01F4      	    brne 62f 
 257               	 
 258               	    ; highlander it ! 
 259               	    ; ( collapse spaces ) 
 260 15fa 4517      	    cp wrk_low, wrk_high 
 261 15fc 01F0      	    breq 30b 
 262               	 
 263               	62: 
 264               	.ifdef UPPERCASE 
 265               	    ; to uppercase 
 266               	    cpi wrk_low, 61 
 267               	    brge 64f 
 268               	    cpi wrk_low, 123 
 269               	    brge 64f 
 270               	    subi wrk_low, 32 
 271               	.endif 
 272               	 
 273               	64: 
 274               	    ; save char to buffer 
 275 15fe 9395      	    inc tos_high 
 276 1600 4193      	    srsave wrk_low 
 277 1602 542F      	    mov wrk_high, wrk_low 
 278 1604 00C0      	    rjmp 20b 
 279               	 
 280               	70: 
 281               	    ; push counter 
 282               	    ; place a BL at end 
 283 1606 40E2      	    ldi wrk_low, 32 
 284 1608 4193      	    srsave wrk_low 
 285               	 
 286               	    ; save counter 
 287 160a 892F      	    mov tos_low, tos_high 
 288 160c 9927      	    clr tos_high 
 289 160e 0C94 0000 	    POON 
 290               	 
 291               	 
 292               	;---------------------------------------------------------------------- 
 293               	; 
 294               	; ok ( a c --- a u | 0 ) 
 295               	;    find a word delimited by c 
 296               	;    returns address and u lenght or zero if no c or \0 
 297               	;    max lenght is 255 bytes 
 298               	; 
 299 1612 0000 0628 	HEADER "(word)", "wordf", F_LEAP
 299      776F 7264 
 299      2920 
 300 161c 0000      	    NOOP 
 301               	    ; start at 
 302 161e F991 E991 	    pspull zpm_low, zpm_high 
 303               	    ; for \0 check 
 304 1622 9927      	    clr tos_high 
 305 1624 00C0      	    rjmp _wsto 
 306               	 
 307               	;---------------------------------------------------------------------- 
 308               	; 
 309               	; ok ( a c --- a u | 0 ) 
 310               	;    find a for c 
 311               	;    returns address and u lenght or zero if no c or \0 
 312               	;    max lenght is 255 bytes 
 313               	; 
 314 1626 0000 0728 	HEADER "(parse)", "parsef", F_LEAP
 314      7061 7273 
 314      6529 
 315 1630 0000      	    NOOP 
 316               	    ; start at 
 317 1632 F991 E991 	    pspull zpm_low, zpm_high 
 318               	    ; for \0 check 
 319 1636 9927      	    clr tos_high 
 320 1638 00C0      	    rjmp _tows; 
 321               	
 322               	;---------------------------------------------------------------------- 
 323               	; 
 324               	;   pass trhu 
 325               	; 
 326               	_wsto: 
 327               	1: 
 328               	    ; skips while equal delimiter 
 329 163a 6081      	    ld nos_low, Z 
 330               	    ; if \0 
 331 163c 9617      	    cp tos_high, nos_low 
 332 163e 01F0      	    breq 10f 
 333 1640 8617      	    cp tos_low, nos_low 
 334 1642 01F4      	    brne 2f 
 335 1644 3196      	    adiw zpm_low, 1 
 336 1646 00C0      	    rjmp 1b 
 337               	 
 338               	_tows: 
 339               	2: 
 340               	    ; keep address 
 341 1648 AF01      	    movw wrk_low, zpm_low 
 342               	 
 343               	3: 
 344               	    ; scans while not equal delimiter 
 345 164a 6081      	    ld nos_low, Z 
 346               	    ; if \0 
 347 164c 9617      	    cp tos_high, nos_low 
 348 164e 01F0      	    breq 10f 
 349 1650 8617      	    cp tos_low, nos_low 
 350 1652 01F0      	    breq 4f 
 351 1654 3196      	    adiw zpm_low, 1 
 352 1656 00C0      	    rjmp 3b 
 353               	 
 354               	_wsat: 
 355               	4: 
 356               	    ; found 
 357 1658 E41B      	    sub zpm_low, wrk_low 
 358 165a F50B      	    sbc zpm_high, wrk_high 
 359 165c 4A93 5A93 	    pspush wrk_low, wrk_high 
 360 1660 CF01      	    movw tos_low, zpm_low 
 361 1662 00C0      	    rjmp 20f 
 362               	15: 
 363               	    ; end of buffer 
 364 1664 8827      	    clr tos_low 
 365 1666 9927      	    clr tos_high 
 366               	20: 
 367 1668 0C94 0000 	    POON 
 368               	 
 369               	;---------------------------------------------------------------------- 
 370               	;   
 371               	;   verify if a value is a valid char in actual BASE
 372               	;   return FALSE or TRUE
 373               	;   eg. base 16, 0-9~A-F
 374               	;
 375 166c 0000 0728 	HEADER "(digit)", "digitf", F_LEAP
 375      6469 6769 
 375      7429 
 376 1676 0000      	    NOOP 
 377               	    ; convert from ASCII
 378 1678 8053      	    subi tos_low, '0'
 379               	    ; check for < 0
 380 167a 8030      	    cpi tos_low, 0
 381 167c 04F0      	    brlt 2f
 382               	    ; check for < 9
 383 167e 8930      	    cpi tos_low, 9
 384 1680 04F0      	    brlt 1f
 385               	    ; check for < A
 386 1682 8131      	    cpi tos_low, 17
 387 1684 04F0      	    brlt 2f
 388               	    ; convert 'A'
 389 1686 8750      	    subi tos_low, 7
 390               	    ; get actual base 
 391 1688 9091 0000 	    lds tos_high, BASE+0 
 392               	    ; check for < BASE
 393 168c 9817      	    cp tos_high, tos_low
 394 168e 04F4      	    brge 2f
 395               	    ; return true
 396 1690 9FEF      	1:  ser tos_high
 397 1692 8FEF      	    ser tos_low
 398               	    ; return false
 399 1694 00C0      	    rjmp 3f
 400 1696 9927      	2:  clr tos_high
 401 1698 8827      	    clr tos_low
 402 169a 0C94 0000 	3:  POON
 403               	
 404               	; too far for rjmp
 405               	;1:  rjmp _iftrue
 406               	;2:  rjmp _iffalse
 407               	
 408               	;---------------------------------------------------------------------- 
 409               	; 
 410               	;   not official ! (ud1 c-addr1 u1 -- ud2 c-addr2 u2) 
 411               	; 
 412               	;    ok ( a n -- u2 true | false ) 
 413               	;    assumes address n chars 
 414               	;    f flag is (Out-of-Range, Not-a-Number, Invalid-Number,) FALSE or TRUE 
 415               	;    uses all but X, Y 
 416               	;    tos, nos, wrk, Z, _zero_, _work_, r0, r1 
 417               	; 
 418 169e 0000 0828 	HEADER "(number)", "numberf", F_LEAP
 418      6E75 6D62 
 418      6572 2920 
 419 16aa 0000      	    NOOP 
 420               	 
 421               	    ; tst for c < 1 
 422               	 
 423 16ac 9927      	    clr tos_high 
 424 16ae 9817      	    cp tos_high, tos_low 
 425 16b0 04F0      	    brlt 10f 
 426               	 
 427               	    ; not valid size c < 1 
 428 16b2 8A93 9A93 	    pspush tos_low, tos_high 
 429 16b6 00C0      	    rjmp 70f 
 430               	 
 431               	10: 
 432               	    ; pull address from 
 433 16b8 F991 E991 	    pspull zpm_low, zpm_high 
 434               	 
 435               	    ; keep counter 
 436 16bc BC01      	    movw nos_low, tos_low 
 437               	 
 438               	    ; clear result 
 439 16be 8827      	    clr tos_low 
 440 16c0 9927      	    clr tos_high 
 441               	 
 442               	    ; get actual base 
 443 16c2 7090 0000 	    lds _work_, BASE+0 
 444               	 
 445               	20: 
 446               	    ; test end of loop 
 447 16c6 6717      	    cp nos_low, nos_high 
 448 16c8 01F4      	    brne 30f 
 449 16ca 00C0      	    rjmp 80f 
 450               	 
 451               	30: 
 452               	    ; load a char 
 453 16cc 4191      	    srload wrk_low 
 454               	 
 455               	    ; allow first char change base 
 456 16ce 7723      	    tst nos_high 
 457 16d0 01F4      	    brne 40f 
 458               	 
 459               	    ; goes hexadecimal 
 460 16d2 4432      	    cpi wrk_low, '$' 
 461 16d4 01F4      	    brne 32f 
 462 16d6 40E1      	    ldi wrk_low, 16 
 463 16d8 742E      	    mov _work_, wrk_low 
 464 16da 00C0      	    rjmp 20b 
 465               	 
 466               	32: 
 467               	    ; goes decimal 
 468 16dc 4332      	    cpi wrk_low, '#' 
 469 16de 01F4      	    brne 34f 
 470 16e0 4AE0      	    ldi wrk_low, 10 
 471 16e2 742E      	    mov _work_, wrk_low 
 472 16e4 00C0      	    rjmp 20b 
 473               	 
 474               	34: 
 475               	    ; goes binary 
 476 16e6 4532      	    cpi wrk_low, '%' 
 477 16e8 01F4      	    brne 36f 
 478 16ea 42E0      	    ldi wrk_low, 2 
 479 16ec 742E      	    mov _work_, wrk_low 
 480 16ee 00C0      	    rjmp 20b 
 481               	 
 482               	36: 
 483               	    ; how do negative ? just two-complement at end 
 484 16f0 4D32      	    cpi wrk_low, '-' 
 485 16f2 01F4      	    brne 38f 
 486 16f4 51E0      	    ldi wrk_high, 1 
 487 16f6 7A95      	    dec nos_high 
 488 16f8 00C0      	    rjmp 20b 
 489               	 
 490               	38: 
 491               	    ; how do positive ? just no two-complement at end 
 492 16fa 4B32      	    cpi wrk_low, '+' 
 493 16fc 01F4      	    brne 40f 
 494 16fe 50E0      	    ldi wrk_high, 0 
 495 1700 7A95      	    dec nos_high 
 496 1702 00C0      	    rjmp 20b 
 497               	 
 498               	38: 
 499               	    ; no more bases, no octal, no duodecimal, no hexagesimal 
 500               	 
 501               	40: 
 502               	    ; paranoic test end 
 503               	 
 504 1704 4030      	    cpi wrk_low, 0 
 505 1706 01F0      	    breq 80f 
 506               	 
 507 1708 4032      	    cpi wrk_low, 32 
 508 170a 01F0      	    breq 80f 
 509               	 
 510               	    ; mask lowercases 
 511 170c 4136      	    cpi wrk_low, 'a' 
 512 170e 04F0      	    brlt 45f 
 513 1710 4052      	    subi wrk_low, 32 
 514               	 
 515               	45: 
 516               	    ; reduce 
 517 1712 4053      	    subi wrk_low, '0' 
 518               	 
 519               	    ; less than 0 ? 
 520 1714 4030      	    cpi wrk_low, 0 
 521 1716 04F0      	    brlt 70f 
 522               	 
 523               	    ; less than 9 ? 
 524 1718 4A30      	    cpi wrk_low, 10 
 525 171a 04F0      	    brlt 50f 
 526               	 
 527               	    ; mind the gap 0-9 ~ A-F 
 528 171c 4750      	    subi wrk_low, 7 
 529               	 
 530               	50: 
 531               	    ; over base ? 
 532 171e 4715      	    cp wrk_low, _work_ 
 533 1720 04F4      	    brge 70f 
 534               	 
 535               	; easy way 
 536               	; bases 2, 8, 10, 16 
 537               	 
 538 1722 840F      	    add tos_low, wrk_low 
 539 1724 961D      	    adc tos_high, _zero_ 
 540               	 
 541               	    ; set value 
 542 1726 0C01      	    movw R0, tos_low 
 543               	 
 544               	    ; set base 
 545 1728 4715      	    cp wrk_low, _work_ 
 546               	 
 547               	; 2 
 548               	_bin_base: 
 549 172a 000C      	    lsl R0 
 550 172c 111C      	    rol R1 
 551 172e 4230      	    cpi wrk_low, 2 
 552 1730 01F0      	    breq _next_digit 
 553               	 
 554               	    ; keep for decimal or odds 
 555 1732 C001      	    movw tos_low, R0 
 556               	 
 557               	; 4 
 558               	_nib_base: 
 559 1734 000C      	    lsl R0 
 560 1736 111C      	    rol R1 
 561               	    ; cpi wrk_low, 4 
 562               	    ; breq _next_digit 
 563               	 
 564               	; 8 
 565               	_oct_base: 
 566 1738 000C      	    lsl R0 
 567 173a 111C      	    rol R1 
 568               	    ; cpi wrk_low, 8 
 569               	    ; breq _next_digit 
 570               	 
 571               	;10 
 572               	_dec_base: 
 573 173c 4A30      	    cpi wrk_low, 10 
 574 173e 01F4      	    brne _hex_base 
 575               	 
 576 1740 080E      	    add R0, tos_low 
 577 1742 191E      	    adc R1, tos_high 
 578 1744 00C0      	    rjmp _next_digit 
 579               	 
 580               	; 16 
 581               	_hex_base: 
 582 1746 000C      	    lsl R0 
 583 1748 111C      	    rol R1 
 584 174a 4031      	    cpi wrk_low, 16 
 585 174c 01F0      	    breq _next_digit 
 586               	 
 587               	; overflow ? 
 588 174e 00F4      	    brcc _next_digit 
 589 1750 00C0      	    rjmp 70f 
 590               	 
 591               	; next digit 
 592               	_next_digit: 
 593 1752 C001      	    movw tos_low, R0 
 594               	 
 595               	60: 
 596               	    ; count digits 
 597 1754 7395      	    inc nos_high 
 598               	 
 599               	    ; next digit 
 600 1756 00C0      	    rjmp 10b 
 601               	 
 602               	70: 
 603               	    ; (Underflow, Overflow, Not_a_Number, Out_of_Range, Invalid_numeric_Argument) 
 604 1758 4427      	    clr wrk_low 
 605 175a 5527      	    clr wrk_high 
 606 175c 00C0      	    rjmp 100f 
 607               	 
 608               	80: 
 609               	    ; if positive 
 610 175e 5030      	    cpi wrk_high, 0 
 611 1760 01F0      	    breq 90f 
 612               	 
 613               	    ; 2's complement 
 614 1762 8095      	    com tos_low 
 615 1764 9095      	    com tos_high 
 616 1766 0196      	    adiw tos_low, 1 
 617               	 
 618               	    ; underflow 
 619 1768 00F0      	    brcs 70b 
 620               	 
 621               	90: 
 622               	    ; push result 
 623 176a 8A93 9A93 	    pspush tos_low, tos_high 
 624               	 
 625               	    ; made true 
 626 176e 4FEF      	    ser wrk_low 
 627 1770 5FEF      	    ser wrk_high 
 628               	 
 629               	100: 
 630               	    ; push digits 
 631 1772 CA01      	    movw tos_low, wrk_low 
 632 1774 0C94 0000 	    POON 
 633               	 
 634               	;---------------------------------------------------------------------- 
 635               	; 
 636               	; ok find a word in a vocabulary 
 637               	;   ( aw u ad -- xt f | a 0 ) 
 638               	;    ad link to dictionary 
 639               	;    aw address to word 
 640               	;    u  length 
 641               	;   f is  1 if word is immediate 
 642               	;   f is -1 if word is normal 
 643               	;   f is  0 if word not found 
 644               	;   names are 15 maximum 
 645               	; 
 646               	;   dictionary is in flash and word is in sram 
 647               	; 
 648 1778 0000 0628 	HEADER "(find)", "findf", F_LEAP
 648      6669 6E64 
 648      2920 
 649 1782 0000      	    NOOP 
 650               	 
 651               	    ; load address dictionary 
 652 1784 FC01      	    movw zpm_low, tos_low 
 653               	 
 654               	    ; load counter 
 655 1786 9991 8991 	    pspull tos_low, tos_high 
 656               	 
 657               	    ; load address word 
 658 178a 7991 6991 	    pspull nos_low, nos_high 
 659               	 
 660               	    ; save stack 
 661 178e CE93 DE93 	    rspush psp_low, psp_high 
 662               	 
 663               	    ; save address word 
 664 1792 6E93 7E93 	    rspush nos_low, nos_high 
 665               	 
 666               	    ; move address to Y ! always check in macros.S 
 667 1796 EB01      	    movw psp_low, nos_low 
 668               	 
 669               	    ; prepare loop 
 670               	 
 671               	    ; save word count 
 672 1798 982F      	    mov tos_high, tos_low 
 673               	 
 674               	    ; push aword for first loop 
 675 179a CE93 DE93 	    rspush psp_low, psp_high 
 676               	 
 677               	    ; push alist for first loop 
 678 179e EE93 FE93 	    rspush zpm_low, zpm_high 
 679               	 
 680               	10: 
 681               	    ; load link 
 682 17a2 FD91 ED91 	    rspull zpm_low, zpm_high 
 683               	 
 684               	    ; load address 
 685 17a6 EE0F FF1F 	    pmload wrk_low, wrk_high 
 685      4591 5591 
 685      F795 E795 
 686               	 
 687               	    ; if null, list ends 
 688 17b2 4517      	    cp wrk_low, wrk_high 
 689 17b4 01F0      	    brbs BIT_ZERO, 26f 
 690               	 
 691               	    ; save next link 
 692 17b6 4E93 5E93 	    rspush wrk_low, wrk_high 
 693               	 
 694               	    ; load size and first char 
 695 17ba EE0F FF1F 	    pmload nos_low, nos_high 
 695      6591 7591 
 695      F795 E795 
 696               	 
 697               	    ; save for flags 
 698 17c6 562F      	    mov wrk_high, nos_low 
 699               	 
 700               	    ; must ummask 
 701 17c8 6F70      	    andi nos_low, F_UNMASK 
 702               	 
 703               	    ; ping-pong 
 704               	    ; verify sizes 
 705 17ca 6817      	    cp nos_low, tos_low 
 706 17cc 01F4      	    brne 10b 
 707               	 
 708               	    ; points to a1 
 709 17ce 4991      	    ld wrk_low, Y+ 
 710               	 
 711               	    ; verify first char 
 712 17d0 4717      	    cp wrk_low, nos_high 
 713 17d2 01F4      	    brne 10b 
 714               	 
 715               	    ; prepare count down 
 716 17d4 892F      	    mov tos_low, tos_high 
 717               	 
 718               	14: 
 719               	    ; verify next chars 
 720 17d6 8A95      	    dec tos_low 
 721 17d8 01F0      	    brbs BIT_ZERO, 20f 
 722               	 
 723 17da EE0F FF1F 	    pmload nos_low, nos_high 
 723      6591 7591 
 723      F795 E795 
 724               	 
 725 17e6 4991      	    ld wrk_low, Y+ 
 726 17e8 4617      	    cp wrk_low, nos_low 
 727 17ea 01F4      	    brne 10b 
 728               	 
 729 17ec 8A95      	    dec tos_low 
 730 17ee 01F0      	    brbs BIT_ZERO, 20f 
 731               	 
 732 17f0 4991      	    ld wrk_low, Y+ 
 733 17f2 4717      	    cp wrk_low, nos_high 
 734 17f4 01F4      	    brne 10b 
 735               	 
 736               	    ; next chars 
 737 17f6 00C0      	    rjmp 14b 
 738               	 
 739               	20: 
 740               	    ; found 
 741               	    ; anyway zpm is ever even 
 742               	 
 743               	    ; return flags 
 744 17f8 5074      	    andi wrk_high, F_IMMEDIATE 
 745 17fa 01F4      	    brne 24f 
 746               	 
 747               	22: 
 748               	    ; immediate (1) 
 749 17fc 8827      	    clr tos_low 
 750 17fe 9927      	    clr tos_high 
 751 1800 8395      	    inc tos_low 
 752 1802 00C0      	    rjmp 30f 
 753               	24: 
 754               	    ; common (-1) 
 755 1804 8FEF      	    ser tos_low 
 756 1806 9FEF      	    ser tos_high 
 757 1808 00C0      	    rjmp 30f 
 758               	26: 
 759               	    ; not found (0) 
 760 180a 8827      	    clr tos_low 
 761 180c 8827      	    clr tos_low 
 762               	30: 
 763               	    ; drops references 
 764 180e 5D91 4D91 	    rspull wrk_low, wrk_high 
 765 1812 5D91 4D91 	    rspull wrk_low, wrk_high 
 766               	 
 767               	    ; copy wt 
 768 1816 5D91 4D91 	    rspull wrk_low, wrk_high 
 769               	 
 770 181a 8030      	    cpi tos_low, 0 
 771 181c 01F0      	    brbs BIT_ZERO, 40f 
 772               	 
 773               	    ; copy (xt) 
 774 181e AF01      	    movw wrk_low, zpm_low 
 775               	 
 776               	40: 
 777               	    ; restore psp 
 778 1820 DD91 CD91 	    rspull psp_low, psp_high 
 779               	 
 780               	    ; push result address 
 781 1824 4A93 5A93 	    pspush wrk_low, wrk_high 
 782               	 
 783               	    ; save results 
 784 1828 0C94 0000 	    POON 
 785               	 
 786               	;---------------------------------------------------------------------- 
 787               	; 
 788               	; is NULLS 
 789               	; Dr Ting 'coyote'
 790               	;
 791 182c 0000 044E 	HEADER "NULL", "NULL", 
 791      554C 4C20 
 792 1834 0000      	    .word 0x0
 793 1836 636F 796F 	    .asciz "coyote"
 793      7465 00
 794 183d 0000      	    .word ENDS 
 795               	 
 796               	;********************************************************************** 
 797               	; 
 798               	; almost figforth, http://forthfiles.net/ting/sysguidefig.pdf, pg 84 
 799               	; 
 800               	;---------------------------------------------------------------------- 
 801               	 
 802               	;----------------------------------------------------------------------
 803               	;
 804               	; ok error scopes
 805               	;
 806               	;----------------------------------------------------------------------
 807               	;
 808               	;   ok ( f n -- )
 809               	;   FALSE is 0
 810               	;   
 811 183f 0000 0006 	HEADER "?ERROR", "QERROR", 
 811      3F45 5252 
 811      4F52 20
 812 184a 0000 0000 	    .word SWAP, ZBRANCH, 2f
 812      0000 
 813 1850 0000 0000 	    .word DROP, BRANCH, 4f
 813      0000 
 814 1856 0000 0000 	2:  .word NONEN, DOT, CR, QUIT
 814      0000 0000 
 815 185e 0000      	4:  .word ENDS
 816               	
 817               	;----------------------------------------------------------------------
 818               	; not compiling
 819 1860 0000 053F 	HEADER "?COMP", "QCOMP", 
 819      434F 4D50 
 820 1868 0000 0000 	    .word STATE, AT, ZEQU, LIT, 11, QERROR, ENDS
 820      0000 0000 
 820      0B00 0000 
 820      0000 
 821               	
 822               	; not executing
 823 1876 0000 053F 	HEADER "?EXEC", "QEXEC", 
 823      4558 4543 
 824 187e 0000 0000 	    .word STATE, AT, ONEMINUS, ZEQU, LIT, 12, QERROR, ENDS
 824      0000 0000 
 824      0000 0C00 
 824      0000 0000 
 825               	
 826               	;----------------------------------------------------------------------
 827 188e 0000 043F 	HEADER "?CSP", "QCSP", 
 827      4353 5020 
 828 1896 0000 0000 	    .word PSAT, CSP, AT, MINUS, LIT, 14, QERROR, ENDS
 828      0000 0000 
 828      0000 0E00 
 828      0000 0000 
 829               	
 830               	; parameter stack underflow or overflow
 831 18a6 0000 063F 	HEADER "?STACK", "QSTACK", 
 831      5354 4143 
 831      4B20 
 832 18b0 0000 0000 	    .word PSAT, PS0, GTHAN, LIT, 1, QERROR ; underflow
 832      0000 0000 
 832      0100 0000 
 833 18bc 0000 0000 	    .word PSAT, PS0, MINUS, LIT, STACK_SIZE, MINUS, LIT, 7, QERROR ; overflow 
 833      0000 0000 
 833      2400 0000 
 833      0000 0700 
 833      0000 
 834 18ce 0000      	    .word ENDS 
 835               	
 836               	;----------------------------------------------------------------------
 837 18d0 0000 053F 	HEADER "?PAIR", "QPAIR", 
 837      5041 4952 
 838 18d8 0000 0000 	    .word MINUS, LIT, 13, QERROR, ENDS
 838      0D00 0000 
 838      0000 
 839               	
 840               	; stack not same 
 841               	; conditionals match
 842               	; 1 hook back
 843               	; 2 if else then endif
 844               	; 3 begin again until
 845               	; 4 while repeat
 846               	; 5 for next
 847               	; 6 case endcase
 848               	; 7 of endof
 849               	; 8 do loop +loop -loop leave
 850               	;
 851 18e2 0000 6448 	HEADER "HOOK", "QHOOK", F_IMMEDIATE | F_COMPILE
 851      4F4F 4B20 
 852 18ea 0000 0000 	    .word QCOMP, HOOK, LIT, 0x01, ENDS
 852      0000 0100 
 852      0000 
 853               	
 854 18f4 0000 6442 	HEADER "BACK", "QBACK", F_IMMEDIATE | F_COMPILE
 854      4143 4B20 
 855 18fc 0000 0000 	    .word QCOMP, LIT, 0x01, QPAIR, BACK, ENDS
 855      0100 0000 
 855      0000 0000 
 856               	
 857 1908 0000 6249 	HEADER "IF", "QIF", F_IMMEDIATE | F_COMPILE
 857      4620 
 858 190e 0000 0000 	    .word QCOMP, IF, LIT, 0x02, ENDS
 858      0000 0200 
 858      0000 
 859               	
 860 1918 0000 6445 	HEADER "ELSE", "QELSE", F_IMMEDIATE | F_COMPILE
 860      4C53 4520 
 861 1920 0000 0000 	    .word QCOMP, LIT, 0x02, QPAIR, LIT, 0x02, ELSE, ENDS
 861      0200 0000 
 861      0000 0200 
 861      0000 0000 
 862               	
 863 1930 0000 6545 	HEADER "ENDIF", "QENDIF", F_IMMEDIATE | F_COMPILE
 863      4E44 4946 
 864 1938 0000 0000 	    .word QCOMP, LIT, 0x02, QPAIR, ENDIF, ENDS
 864      0200 0000 
 864      0000 0000 
 865               	
 866 1944 0000 6454 	HEADER "THEN", "QTHEN", F_IMMEDIATE | F_COMPILE
 866      4845 4E20 
 867 194c 0000 0000 	    .word QCOMP, LIT, 0x02, QPAIR, ENDIF, ENDS
 867      0200 0000 
 867      0000 0000 
 868               	
 869 1958 0000 6541 	HEADER "AHEAD", "QAHEAD", F_IMMEDIATE | F_COMPILE
 869      4845 4144 
 870 1960 0000 0000 	    .word QCOMP, GO, LIT, 0x02, ENDS
 870      0000 0200 
 870      0000 
 871               	
 872 196a 0000 6341 	HEADER "AFT", "QAFT", F_IMMEDIATE | F_COMPILE
 872      4654 
 873 1970 0000 0000 	    .word QCOMP, LIT, 0x02, QPAIR, AFT, LIT, 0x02, ENDS
 873      0200 0000 
 873      0000 0000 
 873      0200 0000 
 874               	
 875 1980 0000 6542 	HEADER "BEGIN", "QBEGIN", F_IMMEDIATE | F_COMPILE
 875      4547 494E 
 876 1988 0000 0000 	    .word QCOMP, BEGIN, LIT, 0x03, ENDS
 876      0000 0300 
 876      0000 
 877               	
 878 1992 0000 6541 	HEADER "AGAIN", "QAGAIN", F_IMMEDIATE | F_COMPILE
 878      4741 494E 
 879 199a 0000 0000 	    .word QCOMP, LIT, 0x03, QPAIR, AGAIN, ENDS
 879      0300 0000 
 879      0000 0000 
 880               	
 881 19a6 0000 6555 	HEADER "UNTIL", "QUNTIL", F_IMMEDIATE | F_COMPILE
 881      4E54 494C 
 882 19ae 0000 0000 	    .word QCOMP, LIT, 0x03, QPAIR, UNTIL, ENDS
 882      0300 0000 
 882      0000 0000 
 883               	
 884 19ba 0000 6557 	HEADER "WHILE", "QWHILE", F_IMMEDIATE | F_COMPILE
 884      4849 4C45 
 885 19c2 0000 0000 	    .word QCOMP, LIT, 0x03, QPAIR, WHILE, LIT, 0x04, ENDS
 885      0300 0000 
 885      0000 0000 
 885      0400 0000 
 886               	
 887 19d2 0000 6652 	HEADER "REPEAT", "QREPEAT", F_IMMEDIATE | F_COMPILE
 887      4550 4541 
 887      5420 
 888 19dc 0000 0000 	    .word QCOMP, LIT, 0x04, QPAIR, REPEAT, ENDS
 888      0400 0000 
 888      0000 0000 
 889               	
 890 19e8 0000 6346 	HEADER "FOR", "QFOR", F_IMMEDIATE | F_COMPILE
 890      4F52 
 891 19ee 0000 0000 	    .word QCOMP, FOR, LIT, 0x05, ENDS
 891      0000 0500 
 891      0000 
 892               	
 893 19f8 0000 644E 	HEADER "NEXT", "QNEXT", F_IMMEDIATE | F_COMPILE
 893      4558 5420 
 894 1a00 0000 0000 	    .word QCOMP, LIT, 0x05, QPAIR, NEXT, ENDS
 894      0500 0000 
 894      0000 0000 
 895               	
 896 1a0c 0000 6443 	HEADER "CASE", "QCASE", F_IMMEDIATE | F_COMPILE
 896      4153 4520 
 897 1a14 0000 0000 	    .word QCOMP, CASE, LIT, 0x06, ENDS
 897      0000 0600 
 897      0000 
 898               	
 899 1a1e 0000 6745 	HEADER "ENDCASE", "QENDCASE", F_IMMEDIATE | F_COMPILE
 899      4E44 4341 
 899      5345 
 900 1a28 0000 0000 	    .word QCOMP, LIT, 0x06, QPAIR, ENDCASE, ENDS
 900      0600 0000 
 900      0000 0000 
 901               	
 902 1a34 0000 624F 	HEADER "OF", "QOF", F_IMMEDIATE | F_COMPILE
 902      4620 
 903 1a3a 0000 0000 	    .word QCOMP, LIT, 0x06, OF, QPAIR, 0x07, ENDS
 903      0600 0000 
 903      0000 0700 
 903      0000 
 904               	
 905 1a48 0000 6545 	HEADER "ENDOF", "QENDOF", F_IMMEDIATE | F_COMPILE
 905      4E44 4F46 
 906 1a50 0000 0000 	    .word QCOMP, LIT, 0x07, QPAIR, ENDOF, LIT, 0x06, ENDS
 906      0700 0000 
 906      0000 0000 
 906      0600 0000 
 907               	
 908 1a60 0000 6244 	HEADER "DO", "QDO", F_IMMEDIATE | F_COMPILE
 908      4F20 
 909 1a66 0000 0000 	    .word QCOMP, DO, LIT, 0x08, ENDS
 909      0000 0800 
 909      0000 
 910               	
 911 1a70 0000 644C 	HEADER "LOOP", "QLOOP", F_IMMEDIATE | F_COMPILE
 911      4F4F 5020 
 912 1a78 0000 0000 	    .word QCOMP, LIT, 0x08, QPAIR, LOOP, ENDS
 912      0800 0000 
 912      0000 0000 
 913               	
 914 1a84 0000 652B 	HEADER "+LOOP", "QPLOOP", F_IMMEDIATE | F_COMPILE
 914      4C4F 4F50 
 915 1a8c 0000 0000 	    .word QCOMP, LIT, 0x08, QPAIR, PLOOP, ENDS
 915      0800 0000 
 915      0000 0000 
 916               	
 917 1a98 0000 654C 	HEADER "LEAVE", "QLEAVE", F_IMMEDIATE | F_COMPILE
 917      4541 5645 
 918 1aa0 0000 0000 	    .word QCOMP, LIT, 0x08, QPAIR, LEAVE, LIT, 0x08, ENDS
 918      0800 0000 
 918      0000 0000 
 918      0800 0000 
 919               	
 920 1ab0 0000 6655 	HEADER "UNLOOP", "QUNLOOP", F_IMMEDIATE | F_COMPILE
 920      4E4C 4F4F 
 920      5020 
 921 1aba 0000 0000 	    .word QCOMP, LIT, 0x08, QPAIR, UNLOOP, LIT, 0x08, ENDS
 921      0800 0000 
 921      0000 0000 
 921      0800 0000 
 922               	
 923               	
 924               	;********************************************************************** 
 925               	; 
 926               	; almost forth94 
 927               	; 
 928               	;---------------------------------------------------------------------- 
 929               	 
 930               	;----------------------------------------------------------------------
 931               	;
 932               	; ok make a value ( w -- )
 933               	; header|lit|value|ends
 934               	; zzzz
 935 1aca 0000 0556 	HEADER "VALUE", "VALUE", 
 935      414C 5545 
 936 1ad2 0000 0000 	    .word CREATE, DROP, LITERAL, ENDS
 936      0000 0000 
 937               	
 938               	;----------------------------------------------------------------------
 939               	;
 940               	; ok make a to value 
 941               	; change value 
 942 1ada 0000 4254 	HEADER "TO", "TOVALUE", F_IMMEDIATE
 942      4F20 
 943 1ae0 0000 0000 	    .word FIND, CELLPLUS, TO, ENDS
 943      0000 0000 
 944               	
 945               	;----------------------------------------------------------------------
 946               	;
 947               	; ok make a defer
 948               	; defaults to UNDEF
 949               	; 
 950 1ae8 0000 0544 	HEADER "DEFER", "DEFER", 
 950      4546 4552 
 951 1af0 0000 0000 	    .word CREATE, LIT, UNDEF, LIT, BRANCH, COMMA, COMMA, ENDS
 951      0000 0000 
 951      0000 0000 
 951      0000 0000 
 952               	
 953               	;----------------------------------------------------------------------
 954               	;
 955               	; ok make a is 
 956               	;
 957 1b00 0000 4249 	HEADER "IS", "ISDEFER", F_IMMEDIATE
 957      5320 
 958 1b06 0000 0000 	    .word FIND, CELLPLUS, SWAP, TO, ENDS
 958      0000 0000 
 958      0000 
 959               	
 960               	;---------------------------------------------------------------------- 
 961               	; 
 962               	; ok SLASHMOVE (a1 a2 u -- ) 
 963               	;   moves CELLS ! backwards
 964 1b10 0000 0653 	HEADER "SSMOVE", "SSMOVE", 
 964      534D 4F56 
 964      4520 
 965 1b1a 0000 0000 		.word ZDUP, ZBRANCH, 80f
 965      0000 
 966 1b20 0000 0000 		.word DUP, TOR, DUP, OVER, PLUS					
 966      0000 0000 
 966      0000 
 967 1b2a 0000 0000 		.word TOR, PLUS, RTO, RTO
 967      0000 0000 
 968 1b32 0000 0000 	1:  .word ZDUP, ZBRANCH, 80f
 968      0000 
 969 1b38 0000 0000 	    .word ONEMINUS, TOR
 970 1b3c 0000 0000 	    .word OVER, AT 
 971               	    
 972               	    ; escaped controls allowed
 973               	
 974 1b40 0000 0000 	    .word DUP, LIT, '\', EQUAL, ZBRANCH, 60f
 974      2700 0000 
 974      0000 0000 
 975 1b4c 0000 0000 	10:    .word DUP, LIT, 'a', EQUAL, ZBRANCH,  12  ; BEL bell
 975      6100 0000 
 975      0000 0C00 
 976 1b58 0000 0000 	    .word DROP, LIT, 7, BRANCH, 60f
 976      0700 0000 
 976      0000 
 977 1b62 0000 0000 	12:    .word DUP, LIT, 'b', EQUAL, ZBRANCH,  14  ; BS backspace
 977      6200 0000 
 977      0000 0E00 
 978 1b6e 0000 0000 	    .word DROP, LIT, 8, BRANCH, 60f
 978      0800 0000 
 978      0000 
 979 1b78 0000 0000 	14:    .word DUP, LIT, 'e', EQUAL, ZBRANCH,  16  ; ESC escape
 979      6500 0000 
 979      0000 1000 
 980 1b84 0000 0000 	    .word DROP, LIT, 27, BRANCH, 60f
 980      1B00 0000 
 980      0000 
 981 1b8e 0000 0000 	16:    .word DUP, LIT, 'f', EQUAL, ZBRANCH,  18  ; FF form feed
 981      6600 0000 
 981      0000 1200 
 982 1b9a 0000 0000 	    .word DROP, LIT, 12, BRANCH, 60f
 982      0C00 0000 
 982      0000 
 983 1ba4 0000 0000 	18:    .word DUP, LIT, 'l', EQUAL, ZBRANCH,  20  ; LF line feed
 983      6C00 0000 
 983      0000 1400 
 984 1bb0 0000 0000 	    .word DROP, LIT, 10, BRANCH, 60f
 984      0A00 0000 
 984      0000 
 985 1bba 0000 0000 	20:    .word DUP, LIT, 'n', EQUAL, ZBRANCH,  22  ; NL new line 
 985      6E00 0000 
 985      0000 1600 
 986 1bc6 0000 0000 	    .word DROP, LIT, 10, BRANCH, 60f
 986      0A00 0000 
 986      0000 
 987 1bd0 0000 0000 	22:    .word DUP, LIT, 'q', EQUAL, ZBRANCH,  24  ; double quote
 987      7100 0000 
 987      0000 1800 
 988 1bdc 0000 0000 	    .word DROP, LIT, 34, BRANCH, 60f
 988      2200 0000 
 988      0000 
 989 1be6 0000 0000 	24:    .word DUP, LIT, 'r', EQUAL, ZBRANCH,  26  ; CR carriage return
 989      7200 0000 
 989      0000 1A00 
 990 1bf2 0000 0000 	    .word DROP, LIT, 13, BRANCH, 60f
 990      0D00 0000 
 990      0000 
 991 1bfc 0000 0000 	26:    .word DUP, LIT, 't', EQUAL, ZBRANCH,  28  ; HT horizontal tab
 991      7400 0000 
 991      0000 1C00 
 992 1c08 0000 0000 	    .word DROP, LIT, 9, BRANCH, 60f
 992      0900 0000 
 992      0000 
 993 1c12 0000 0000 	28:    .word DUP, LIT, 'v', EQUAL, ZBRANCH,  30  ; VT vertical tab
 993      7600 0000 
 993      0000 1E00 
 994 1c1e 0000 0000 	    .word DROP, LIT, 11, BRANCH, 60f
 994      0B00 0000 
 994      0000 
 995 1c28 0000 0000 	30:    .word DUP, LIT, 'z', EQUAL, ZBRANCH,  32  ; NUL no char 0x0
 995      7A00 0000 
 995      0000 2000 
 996 1c34 0000 0000 	    .word DROP, LIT, 0, BRANCH, 60f
 996      0000 0000 
 996      0000 
 997 1c3e 0000 0000 	32:    .word DUP, LIT, '\"', EQUAL, ZBRANCH, 34  ; double quote
 997      2200 0000 
 997      0000 2200 
 998 1c4a 0000 0000 	    .word DROP, LIT, 34, BRANCH, 60f
 998      2200 0000 
 998      0000 
 999 1c54 0000 0000 	34:    .word DUP, LIT, '\\', EQUAL, ZBRANCH,  36  ; backslash
 999      5C00 0000 
 999      0000 2400 
 1000 1c60 0000 0000 	    .word DROP, LIT, 92, BRANCH, 60f
 1000      5C00 0000 
 1000      0000 
 1001               	
 1002               	     ; dual chars zzzz
 1003               	
 1004 1c6a 0000 0000 	36:    .word DUP, LIT, 'x', EQUAL, ZBRANCH,  38  ; hexdigit hexdigit
 1004      7800 0000 
 1004      0000 2600 
 1005 1c76 0000 0000 	    .word DROP, LIT, 10, BRANCH, 60f
 1005      0A00 0000 
 1005      0000 
 1006 1c80 0000 0000 	38:    .word DUP, LIT, 'm', EQUAL, ZBRANCH,  40  ; pair cr/lf  
 1006      6D00 0000 
 1006      0000 2800 
 1007 1c8c 0000 0000 	    .word DROP, LIT, 10, BRANCH, 60f
 1007      0A00 0000 
 1007      0000 
 1008               	    ; else clear to space
 1009               	40: 
 1010 1c96 0000 0000 	    .word DROP, LIT, 32
 1010      2000 
 1011               	
 1012 1c9c 0000 0000 	60: .word OVER, TO
 1013 1ca0 0000 0000 	    .word ONEMINUS, SWAP, ONEMINUS, SWAP
 1013      0000 0000 
 1014 1ca8 0000 0000 	    .word BRANCH, 1b
 1015 1cac 0000 0000 	80: .word DROP, DROP, ENDS 
 1015      0000 
 1016               	 
 1017               	;---------------------------------------------------------------------- 
 1018               	; 
 1019               	; ok MOVE (a1 a2 u -- ) 
 1020               	;   moves CELLS ! backwards
 1021 1cb2 0000 044D 	HEADER "MOVE", "MOVE", 
 1021      4F56 4520 
 1022 1cba 0000 0000 		.word ZDUP, ZBRANCH, 2f
 1022      0000 
 1023 1cc0 0000 0000 		.word DUP, TOR, DUP, OVER, PLUS					
 1023      0000 0000 
 1023      0000 
 1024 1cca 0000 0000 		.word TOR, PLUS, RTO, RTO
 1024      0000 0000 
 1025 1cd2 0000 0000 	1:  .word ZDUP, ZBRANCH, 2f
 1025      0000 
 1026 1cd8 0000 0000 	    .word ONEMINUS, TOR
 1027 1cdc 0000 0000 	    .word OVER, AT, OVER, TO
 1027      0000 0000 
 1028 1ce4 0000 0000 	    .word ONEMINUS, SWAP, ONEMINUS, SWAP
 1028      0000 0000 
 1029 1cec 0000 0000 	    .word BRANCH, 1b
 1030 1cf0 0000 0000 	2:  .word DROP, DROP, ENDS 
 1030      0000 
 1031               	 
 1032               	;---------------------------------------------------------------------- 
 1033               	; 
 1034               	; ok MOVE (a1 a2 u -- ) 
 1035               	;   moves CHARS ! and align from backwards
 1036 1cf6 0000 0543 	HEADER "CMOVE", "CMOVE", 
 1036      4D4F 5645 
 1037 1cfe 0000 0000 		.word ZDUP, ZBRANCH, 2f
 1037      0000 
 1038 1d04 0000 0000 		.word SHR, ONE, PLUS, MOVE, ENDS					
 1038      0000 0000 
 1038      0000 
 1039 1d0e 0000 0000 	2:  .word DROP, DROP, ENDS 
 1039      0000 
 1040               	 
 1041               	;---------------------------------------------------------------------- 
 1042               	; 
 1043               	; ok FILL (a u c -- ) 
 1044               	; fills CHARS
 1045 1d14 0000 0446 	HEADER "FILL", "FILL", 
 1045      494C 4C20 
 1046 1d1c 0000 0000 		.word SWAP, ZDUP, ZBRANCH, 2f
 1046      0000 0000 
 1047 1d24 0000 0000 	    .word TOR, SWAP
 1048 1d28 0000 0000 	1:  .word RTO, ZDUP, ZBRANCH, 2f
 1048      0000 0000 
 1049 1d30 0000 0000 	    .word ONEMINUS, TOR
 1050 1d34 0000 0000 	    .word OVER, OVER, CTO, ONEPLUS 
 1050      0000 0000 
 1051 1d3c 0000 0000 	    .word BRANCH, 1b 
 1052 1d40 0000 0000 	2:  .word DROP, DROP, ENDS 
 1052      0000 
 1053               	 
 1054               	;---------------------------------------------------------------------- 
 1055               	; 
 1056               	; is \] to compile 
 1057               	; 
 1058 1d46 0000 015D 	HEADER "]", "RBRAC", 
 1059 1d4a 0000 0000 	    .word ONE, STATE, TO, ENDS 
 1059      0000 0000 
 1060               	 
 1061               	;---------------------------------------------------------------------- 
 1062               	; 
 1063               	; is \[ to interpret 
 1064               	; 
 1065 1d52 0000 415B 	HEADER "[", "LBRAC", F_IMMEDIATE 
 1066 1d56 0000 0000 	    .word ZERO, STATE, TO, ENDS 
 1066      0000 0000 
 1067               	 
 1068               	;---------------------------------------------------------------------- 
 1069               	; 
 1070               	; is TOGGLE ( a f -- ) 
 1071               	; 
 1072 1d5e 0000 0654 	HEADER "TOGGLE", "TOGGLE", 
 1072      4F47 474C 
 1072      4520 
 1073 1d68 0000 0000 	    .word OVER, AT, XOR, SWAP, TO, ENDS 
 1073      0000 0000 
 1073      0000 0000 
 1074               	 
 1075               	;---------------------------------------------------------------------- 
 1076               	; 
 1077               	; is >NFA ( a f -- ) 
 1078               	; from link to c_name 
 1079               	; 
 1080 1d74 0000 043E 	HEADER ">NFA", "TONFA", 
 1080      4E46 4120 
 1081 1d7c 0000 0000 	    .word CELL, PLUS, ENDS 
 1081      0000 
 1082               	 
 1083               	;---------------------------------------------------------------------- 
 1084               	; 
 1085               	; is >CFA ( a f -- ) 
 1086               	; from link to code 
 1087 1d82 0000 043E 	HEADER ">CFA", "TOCFA", 
 1087      4346 4120 
 1088 1d8a 0000 0000 	    .word TONFA, DUP, AT, F_UNMASK, AND, PLUS, ALIGN, ENDS 
 1088      0000 0F00 
 1088      0000 0000 
 1088      0000 0000 
 1089               	 
 1090               	;---------------------------------------------------------------------- 
 1091               	; 
 1092               	; is HIDDEN 
 1093               	; 
 1094 1d9a 0000 0648 	HEADER "HIDDEN", "HIDDEN", 
 1094      4944 4445 
 1094      4E20 
 1095 1da4 0000 0000 	    .word LATEST, TONFA, F_HIDDEN, TOGGLE, ENDS 
 1095      1000 0000 
 1095      0000 
 1096               	 
 1097               	;---------------------------------------------------------------------- 
 1098               	; 
 1099               	; is IMMEDIATE 
 1100               	; 
 1101 1dae 0000 0949 	HEADER "IMMEDIATE", "IMMEDIATE", 
 1101      4D4D 4544 
 1101      4941 5445 
 1102 1dba 0000 0000 	    .word LATEST, TONFA, F_IMMEDIATE, TOGGLE, ENDS 
 1102      4000 0000 
 1102      0000 
 1103               	 
 1104               	;---------------------------------------------------------------------- 
 1105               	; 
 1106               	; is COMP_ONLY 
 1107               	; 
 1108 1dc4 0000 0C43 	HEADER "COMPILE_ONLY", "COMPILE_ONLY", 
 1108      4F4D 5049 
 1108      4C45 5F4F 
 1108      4E4C 5920 
 1109 1dd4 0000 0000 	    .word LATEST, TONFA, F_COMPILE, TOGGLE, ENDS 
 1109      2000 0000 
 1109      0000 
 1110               	 
 1111               	;---------------------------------------------------------------------- 
 1112               	; 
 1113               	; is HANDLER 
 1114               	; 
 1115 1dde 0000 0748 	HEADER "HANDLER", "HANDLER", 
 1115      414E 444C 
 1115      4552 
 1116 1de8 0000 0000 	    .word LIT, HAND, ENDS 
 1116      0000 
 1117               	 
 1118               	;---------------------------------------------------------------------- 
 1119               	; 
 1120               	; is CATCH 
 1121               	; 
 1122 1dee 0000 0543 	HEADER "CATCH", "CATCH", 
 1122      4154 4348 
 1123 1df6 0000 0000 	    .word PSAT, TOR, HANDLER, AT, TOR, RSAT, HANDLER, TO 
 1123      0000 0000 
 1123      0000 0000 
 1123      0000 0000 
 1124 1e06 0000 0000 	    .word EXEC, RTO, HANDLER, TO, RTO, DROP, ZERO
 1124      0000 0000 
 1124      0000 0000 
 1124      0000 
 1125 1e14 0000      	    .word ENDS 
 1126               	 
 1127               	;---------------------------------------------------------------------- 
 1128               	; 
 1129               	; is THROW 
 1130               	; 
 1131 1e16 0000 0554 	HEADER "THROW", "THROW", 
 1131      4852 4F57 
 1132 1e1e 0000 0000 	    .word ZDUP, ZBRANCH, 1f 
 1132      0000 
 1133 1e24 0000 0000 	    .word HANDLER, AT, RSTO, RTO, HANDLER, TO 
 1133      0000 0000 
 1133      0000 0000 
 1134 1e30 0000 0000 	    .word RTO, SWAP, TOR, PSTO, DROP, RTO 
 1134      0000 0000 
 1134      0000 0000 
 1135 1e3c 0000      	1:  .word ENDS 
 1136               	 
 1137               	;---------------------------------------------------------------------- 
 1138               	; 
 1139               	; is ABORT 
 1140               	; 
 1141 1e3e 0000 0541 	HEADER "ABORT", "ABORT" 
 1141      424F 5254 
 1142 1e46 0000 FFFF 	    .word LIT, -1, THROW, ENDS 
 1142      0000 0000 
 1143               	 
 1144               	;---------------------------------------------------------------------- 
 1145               	; 
 1146               	; is ACCEPT is a refill with edit capabilities 
 1147               	; 
 1148 1e4e 0000 0641 	HEADER "ACCEPT", "ACCEPT", 
 1148      4343 4550 
 1148      5420 
 1149 1e58 0000 0000 	    .word ZZZZ, ENDS 
 1150               	 
 1151               	;---------------------------------------------------------------------- 
 1152               	; 
 1153               	; is 
 1154               	; 
 1155 1e5c 0000 054F 	HEADER "OVERT", "OVERT", 
 1155      5645 5254 
 1156               	    ;.word LATEST, AT, CURRENT, AT, TO, ENDS 
 1157 1e64 0000 0000 	    .word ZZZZ, ENDS 
 1158               	 
 1159               	;---------------------------------------------------------------------- 
 1160               	; 
 1161               	; is COLON 
 1162               	; 
 1163 1e68 0000 413A 	HEADER ":", "COLON", F_IMMEDIATE 
 1164 1e6c 0000 0000 	    .word CREATE, RBRAC, ENDS 
 1164      0000 
 1165               	 
 1166               	;---------------------------------------------------------------------- 
 1167               	; 
 1168               	; is SEMIS
 1169               	; 
 1170 1e72 0000 013B 	HEADER ";", "SEMIS", 
 1171 1e76 0000 0000 	    .word EXIT, LBRAC, OVERT, ENDS 
 1171      0000 0000 
 1172               	 
 1173               	;---------------------------------------------------------------------- 
 1174               	; 
 1175               	; is SOURCE 
 1176               	;   place terminal buffer address and length in stack 
 1177               	;   no standart: also place a \0 at end :) 
 1178               	; 
 1179 1e7e 0000 0653 	HEADER "SOURCE", "SOURCE", 
 1179      4F55 5243 
 1179      4520 
 1180 1e88 0000 0000 	    .word LIT, TIB0, LIT, TIB_SIZE 
 1180      0000 4800 
 1181 1e90 0000 0000 	    .word OVER, OVER, PLUS, LIT, ZERO, SWAP, TO, ONE, MINUS 
 1181      0000 0000 
 1181      0000 0000 
 1181      0000 0000 
 1181      0000 
 1182 1ea2 0000      	    .word ENDS 
 1183               	 
 1184               	;---------------------------------------------------------------------- 
 1185               	; 
 1186               	; is SOURCE+ 
 1187               	; 
 1188 1ea4 0000 0753 	HEADER "SOURCE+", "SOURCEPLUS", 
 1188      4F55 5243 
 1188      452B 
 1189 1eae 0000 0000 	    .word SOURCE, DROP, TOIN, PLUS, ENDS 
 1189      0000 0000 
 1189      0000 
 1190               	 
 1191               	;---------------------------------------------------------------------- 
 1192               	; 
 1193               	; is  REFILL ( -- a n ), toin = 0 
 1194               	; 
 1195 1eb8 0000 0652 	HEADER "REFILL", "REFILL", 
 1195      4546 494C 
 1195      4C20 
 1196 1ec2 0000 0000 	    .word SOURCE, refillf, ZERO, TOIN, TO, ENDS 
 1196      0000 0000 
 1196      0000 0000 
 1197               	 
 1198               	;---------------------------------------------------------------------- 
 1199               	; 
 1200               	; is PARSE ( "<chars>ccc" c -- a n ) 
 1201               	;   no counted-string 
 1202               	; 
 1203 1ece 0000 0550 	HEADER "PARSE", "PARSE" 
 1203      4152 5345 
 1204 1ed6 0000 0000 	    .word SOURCEPLUS, SWAP 
 1205 1eda 0000 0000 	    .word parsef, ZDUP, ZBRANCH, 2f 
 1205      0000 0000 
 1206 1ee2 0000 0000 	    .word DUP, TOIN, PLUSTO, ENDS 
 1206      0000 0000 
 1207 1eea 0000 0000 	2:  .word REFILL, BRANCH, PARSE ; perfect loop 
 1207      0000 
 1208               	 
 1209               	;---------------------------------------------------------------------- 
 1210               	; 
 1211               	; is \ also comments
 1212               	; 
 1213 1ef0 0000 415C 	HEADER "\\", "BACKSLASH", F_IMMEDIATE 
 1214 1ef4 0000 4800 	    .word LIT, TIB_SIZE, TOIN, TO, ENDS 
 1214      0000 0000 
 1214      0000 
 1215               	
 1216               	;---------------------------------------------------------------------- 
 1217               	; 
 1218               	; is PAREN ( "<chars>ccc" c -- ) also comments
 1219               	; 
 1220 1efe 0000 4128 	HEADER "(", "PAREN", F_IMMEDIATE 
 1221 1f02 0000 2900 	    .word LIT, ')', PARSE, DROP, DROP, ENDS 
 1221      0000 0000 
 1221      0000 0000 
 1222               	
 1223               	;---------------------------------------------------------------------- 
 1224               	; 
 1225               	; is DOTPAREN .( "<chars>ccc" c -- a n ) also types
 1226               	;   not standart, no multi-task support
 1227               	;
 1228 1f0e 0000 022E 	HEADER ".(", "DOTPAREN" 
 1228      2820 
 1229 1f14 0000 2900 	    .word LIT, ')', PARSE, ENDS ;
 1229      0000 0000 
 1230               	
 1231               	;---------------------------------------------------------------------- 
 1232               	; 
 1233               	; is S BACK SLASH QUOTE S\" ( -- )
 1234               	;   not standart, 
 1235               	; zzzz
 1236 1f1c 0000 0353 	HEADER "S\\\"", "SBSQUOTE" 
 1236      5C22 
 1237 1f22 0000 0000 	    .word RTO, DUP, COUNT, TYPE
 1237      0000 0000 
 1238 1f2a 0000 0000 	    .word DUP, AT, ONE, PLUS, PLUS 
 1238      0000 0000 
 1238      0000 
 1239 1f34 0000 0000 	    .word CELL, PLUS, ALIGNED, TOR, ENDS
 1239      0000 0000 
 1239      0000 
 1240               	
 1241               	;---------------------------------------------------------------------- 
 1242               	; 
 1243               	; is SQUOTE S\" ( -- )
 1244               	;   not standart, 
 1245               	; zzzz
 1246 1f3e 0000 0253 	HEADER "S\"", "SQUOTE" 
 1246      2220 
 1247 1f44 0000 0000 	    .word RTO, DUP, COUNT, TYPE
 1247      0000 0000 
 1248 1f4c 0000 0000 	    .word DUP, AT, ONE, PLUS, PLUS 
 1248      0000 0000 
 1248      0000 
 1249 1f56 0000 0000 	    .word CELL, PLUS, ALIGNED, TOR, ENDS
 1249      0000 0000 
 1249      0000 
 1250               	
 1251               	;---------------------------------------------------------------------- 
 1252               	; 
 1253               	; is DOTQUOTE .\" ( "<chars>ccc" c -- a n )
 1254               	;   not standart, 
 1255               	;   parse returns chars
 1256               	;   bad things if no ending "
 1257               	;
 1258 1f60 0000 422E 	HEADER ".\"", "DOTQUOTE", F_IMMEDIATE 
 1258      2220 
 1259 1f66 0000 2200 	    .word LIT, 0x22, PARSE
 1259      0000 
 1260 1f6c 0000 0000 	    .word STATE, AT, ZBRANCH, 4f
 1260      0000 0000 
 1261 1f74 0000 0000 	    .word COMP, SQUOTE, DUP, CCOMMA
 1261      0000 0000 
 1262 1f7c 0000 0000 	    .word HERE, OVER, ALLOT, ALIGN
 1262      0000 0000 
 1263 1f84 0000 0000 	    .word SWAP, CMOVE, BRANCH, 6f  
 1263      0000 0000 
 1264 1f8c 0000      	4:  .word TYPE 
 1265 1f8e 0000      	6:  .word ENDS 
 1266               	
 1267               	;---------------------------------------------------------------------- 
 1268               	; 
 1269               	; is  PARSE-NAME ( "ccc<chars>ccc" c -- a n ), toin = 0 
 1270               	;   no counted-string 
 1271               	; 
 1272 1f90 0000 0A50 	HEADER "PARSE-NAME", "PARSEN", 
 1272      4152 5345 
 1272      2D4E 414D 
 1272      4520 
 1273 1f9e 0000 0000 	    .word SOURCEPLUS, SWAP 
 1274 1fa2 0000 0000 	    .word wordf, ZDUP, ZBRANCH, 2f 
 1274      0000 0000 
 1275 1faa 0000 0000 	    .word DUP, TOIN, PLUSTO, ENDS 
 1275      0000 0000 
 1276 1fb2 0000 0000 	2:  .word REFILL, BRANCH, PARSEN  ; perfect loop 
 1276      0000 
 1277               	 
 1278               	;---------------------------------------------------------------------- 
 1279               	; 
 1280               	; is FIND-NAME ( a n -- a 0 | xt -1 | xt 1 ) 
 1281               	;   no counted-string 
 1282               	;   no vocabularies 
 1283               	; 
 1284 1fb8 0000 0946 	HEADER "FIND-NAME", "FINDN", 
 1284      494E 442D 
 1284      4E41 4D45 
 1285 1fc4 0000 0000 	    .word LATEST, AT, findf, ENDS 
 1285      0000 0000 
 1286               	 
 1287               	;---------------------------------------------------------------------- 
 1288               	; 
 1289               	; is FIND ( "ccc<chars>ccc" -- a 0 | xt -1 | xt 1 ) 
 1290               	; 
 1291 1fcc 0000 0446 	HEADER "FIND", "FIND", 
 1291      494E 4420 
 1292 1fd4 0000 0000 	    .word PARSEN, FINDN
 1293 1fd8 0000 0000 	    .word ZBRANCH, ABORT 
 1294 1fdc 0000 0000 	    .word DROP, ENDS 
 1295               	 
 1296               	;---------------------------------------------------------------------- 
 1297               	; 
 1298               	; is  CHAR ( "ccc<chars>ccc" -- n)  
 1299               	; 
 1300 1fe0 0000 0443 	HEADER "CHAR", "CHAR", 
 1300      4841 5220 
 1301 1fe8 0000 0000 	    .word PARSEN, DROP, AT, ENDS 
 1301      0000 0000 
 1302               	 
 1303               	;---------------------------------------------------------------------- 
 1304               	; 
 1305               	; is  NONAME ( "" ), toin = 0 
 1306               	; 
 1307 1ff0 0000 073A 	HEADER ":NONAME", "NONAME", 
 1307      4E4F 4E41 
 1307      4D45 
 1308 1ffa 0000 0000 	    .word ZERO, ZERO, CREATE, RBRAC, ENDS 
 1308      0000 0000 
 1308      0000 
 1309               	 
 1310               	;---------------------------------------------------------------------- 
 1311               	; 
 1312               	; is CREATE ( "ccc<str>ccc" -- xt ) 
 1313               	; parse next word and compile a header 
 1314               	; 
 1315 2004 0000 0643 	HEADER "CREATE", "CREATE", 
 1315      5245 4154 
 1315      4520 
 1316 200e 0000 0000 	    .word PARSEN, LIT, UH0 
 1316      0000 
 1317 2014 0000 0000 	    .word DUP, LATEST, AT, SWAP, TO, CELLPLUS 
 1317      0000 0000 
 1317      0000 0000 
 1318 2020 0000 0000 	    .word OVER, OVER, TO, ONEPLUS, SWAP, DUP 
 1318      0000 0000 
 1318      0000 0000 
 1319 202c 0000 0000 	    .word TOR, copyf, RTO 
 1319      0000 
 1320 2032 0000 0000 	    .word DUP, ONE, AND, ZEQU, ZBRANCH, 2f 
 1320      0000 0000 
 1320      0000 0000 
 1321 203e 0000 0000 	    .word DUP, BL, SWAP, TO, ONE, PLUS 
 1321      0000 0000 
 1321      0000 0000 
 1322 204a 0000      	2:  .word ENDS 
 1323               	 
 1324               	;---------------------------------------------------------------------- 
 1325               	;
 1326               	; is DOES ( xt -- ) 
 1327               	; zzzz ???? 
 1328 204c 0000 0444 	HEADER "DOES", "DOES", 
 1328      4F45 5320 
 1329 2054 0000 0000 	    .word LIT, BRANCH, COMMA, HERE, COMMA, ENDS 
 1329      0000 0000 
 1329      0000 0000 
 1330               	
 1331               	;---------------------------------------------------------------------- 
 1332               	; 
 1333               	; is DOES> ( xt -- ) 
 1334               	; 
 1335 2060 0000 4544 	HEADER "DOES>", "DOESTO", F_IMMEDIATE 
 1335      4F45 533E 
 1336 2068 0000 0000 	    .word LIT, BRANCH, COMMA, HERE, COMMA, ENDS 
 1336      0000 0000 
 1336      0000 0000 
 1337               	
 1338               	;---------------------------------------------------------------------- 
 1339               	; 
 1340               	; is CONSTANT ( "ccc<caddr>ccc" w -- ) 
 1341               	; constants go to eeprom
 1342               	; EP points next word free
 1343               	; 
 1344               	; std: : variable create 0 , ;
 1345               	; zzzz
 1346 2074 0000 0843 	 HEADER "CONSTANT", "CONSTANT", 
 1346      4F4E 5354 
 1346      414E 5420 
 1347 2080 0000 0000 	    .word CREATE, EPP, AT
 1347      0000 
 1348 2086 0000 0000 	    .word DUP, TOR, ETO, RTO
 1348      0000 0000 
 1349 208e 0000 0000 	    .word DUP, CELL, PLUS, EPP, TO
 1349      0000 0000 
 1349      0000 
 1350 2098 0000 0000 	    .word COMMA, DOESTO, ENDS 
 1350      0000 
 1351               	    
 1352               	;---------------------------------------------------------------------- 
 1353               	; 
 1354               	; is VARIABLE ( "ccc<caddr>ccc"  -- ) 
 1355               	; variables go to high adress sram
 1356               	; UP maps next word free
 1357               	;
 1358               	; std: : constant create , does> @ ;
 1359               	; zzzz
 1360 209e 0000 0856 	HEADER "VARIABLE", "VARIABLE", 
 1360      4152 4941 
 1360      424C 4520 
 1361 20aa 0000 0000 	    .word CREATE, UPP, AT
 1361      0000 
 1362 20b0 0000 0000 	    .word DUP, TOR, TO, RTO
 1362      0000 0000 
 1363 20b8 0000 0000 	    .word DUP, CELL, MINUS, UPP, TO
 1363      0000 0000 
 1363      0000 
 1364 20c2 0000 0000 	    .word COMMA, DOESTO, ENDS 
 1364      0000 
 1365               	    
 1366               	;---------------------------------------------------------------------- 
 1367               	; 
 1368               	; is TICK ( "ccc<caddr>ccc" -- xt | 0 ) 
 1369               	; 
 1370 20c8 0000 0127 	HEADER "'", "TICK", 
 1371 20cc 0000 0000 	    .word FINDN, DUP, ZEQU, ZBRANCH, 2f 
 1371      0000 0000 
 1371      0000 
 1372 20d6 0000      	    .word SWAP 
 1373 20d8 0000 0000 	2:  .word DROP, ENDS 
 1374               	 
 1375               	;---------------------------------------------------------------------- 
 1376               	; 
 1377               	; ok unconditional compile next word 
 1378               	;   no check if 0x0 zzzz 
 1379               	; 
 1380 20dc 0000 4850 	HEADER "POSTPONE", "POSTPONE", F_IMMEDIATE, 
 1380      4F53 5450 
 1380      4F4E 4520 
 1381 20e8 0000 0000 	    .word TICK, COMMA, ENDS 
 1381      0000 
 1382               	 
 1383               	;----------------------------------------------------------------------
 1384               	;
 1385               	; ok compile real
 1386               	;
 1387 20ee 0000 4743 	HEADER "COMPILE", "COMPILE", F_IMMEDIATE
 1387      4F4D 5049 
 1387      4C45 
 1388 20f8 0000 0000 	    .word DOVAR, AT, COMMA, ENDS
 1388      0000 0000 
 1389               	
 1390               	;---------------------------------------------------------------------- 
 1391               	; 
 1392               	; is  NUMBN ( a n -- w true | a n false ) 
 1393               	; 
 1394 2100 0000 054E 	HEADER "NUMBN", "NUMBN", 
 1394      554D 424E 
 1395 2108 0000 0000 	    .word OVER, OVER, numberf, ZBRANCH, 2f 
 1395      0000 0000 
 1395      0000 
 1396 2112 0000 0000 	    .word TOR, DROP, DROP, RTO, FTRUE, BRANCH, 4f 
 1396      0000 0000 
 1396      0000 0000 
 1396      0000 
 1397 2120 0000      	2:  .word FFALSE 
 1398 2122 0000      	4:  .word ENDS 
 1399               	 
 1400               	;---------------------------------------------------------------------- 
 1401               	; 
 1402               	; is  NONEN ( a n -- ) 
 1403               	; 
 1404 2124 0000 054E 	HEADER "NONEN", "NONEN", 
 1404      4F4E 454E 
 1405 212c 0000 0000 	    .word CR, TYPE, LIT, question, LIT, 4, TYPE, ENDS 
 1405      0000 0000 
 1405      0000 0400 
 1405      0000 0000 
 1406               	
 1407               	;---------------------------------------------------------------------- 
 1408               	; 
 1409               	; is 
 1410               	; 
 1411 213c 0000 0445 	HEADER "EVAL", "EVAL", 
 1411      5641 4C20 
 1412 2144 0000      	    .word PARSEN
 1413               	100:
 1414               	    ; is a word 
 1415 2146 0000 0000 	    .word FINDN, ZBRANCH, 200f
 1415      0000 
 1416               	    ; is -1 normal 1 immediate 
 1417 214c 0000 0000 	    .word ONEMINUS, ZEQU, ZBRANCH, 120f 
 1417      0000 0000 
 1418 2154 0000 0000 	    .word STATE, AT, ZBRANCH, 120f
 1418      0000 0000 
 1419               	110:
 1420 215c 0000 0000 	    .word COMMA, BRANCH, EVAL 
 1420      0000 
 1421               	120:
 1422 2162 0000 0000 	    .word EXEC, BRANCH, EVAL 
 1422      0000 
 1423               	    
 1424               	    ; is a number ? 
 1425 2168 0000 0000 	200: .word NUMBN, ZBRANCH, 300f 
 1425      0000 
 1426 216e 0000 0000 	    .word STATE, AT, ZBRANCH, EVAL 
 1426      0000 0000 
 1427 2176 0000 0000 	    .word LIT, LIT, COMMA, COMMA
 1427      0000 0000 
 1428 217e 0000 0000 	    .word BRANCH, EVAL 
 1429               	300: 
 1430               	    ; not okey
 1431 2182 0000 0000 	    .word NONEN, BRANCH, EVAL 
 1431      0000 
 1432               	 400:
 1433 2188 0000      	    .word ENDS
 1434               	;---------------------------------------------------------------------- 
 1435               	; 
 1436               	; is 
 1437               	; 
 1438 218a 0000 0451 	HEADER "QUIT", "QUIT", 
 1438      5549 5420 
 1439               	1: 
 1440 2192 0000      	    .word LBRAC 
 1441 2194 0000 0000 	    .word RS0, RSTO 
 1442 2198 0000      	    .word REFILL 
 1443               	2: 
 1444 219a 0000 0000 	    .word EVAL, CATCH 
 1445 219e 0000 0000 	    .word DUP, LIT, 0, EQUAL, ZBRANCH, 3f 
 1445      0000 0000 
 1445      0000 0000 
 1446 21aa 0000 0000 	    .word STATE, AT, ZEQU, ZBRANCH, 5f 
 1446      0000 0000 
 1446      0000 
 1447 21b4 0000 0000 	    .word LIT, prompt, LIT, 4, TYPE, BRANCH, 5f 
 1447      0000 0400 
 1447      0000 0000 
 1447      0000 
 1448 21c2 0000 0000 	    .word CR, BRANCH, 2b 
 1448      0000 
 1449               	3: 
 1450 21c8 0000 0000 	    .word DUP, LIT, -1, EQUAL, ZBRANCH, 4f 
 1450      FFFF 0000 
 1450      0000 0000 
 1451 21d4 0000 0000 	    .word LIT, abort, LIT, 8, TYPE, BRANCH, 5f 
 1451      0000 0800 
 1451      0000 0000 
 1451      0000 
 1452               	4: 
 1453 21e2 0000 0000 	    .word DUP, LIT, -2, EQUAL, ZBRANCH, 5f 
 1453      FEFF 0000 
 1453      0000 0000 
 1454 21ee 0000 0000 	    .word LIT, exception, LIT, 12, TYPE, DOT, BRANCH, 5f 
 1454      0000 0C00 
 1454      0000 0000 
 1454      0000 0000 
 1455               	5: 
 1456 21fe 0000 0000 	    .word CR, BRANCH, 2b 
 1456      0000 
 1457 2204 0000      	    .word ENDS 
 1458               	 
 1459               	;---------------------------------------------------------------------- 
 1460               	; 
 1461               	; 
 1462               	...
 167               	
 168               	;----------------------------------------------------------------------
 169               	;
 170               	; is ZZZZ, hook for incompleteness 
 171               	;
 172 2206 0000 0555 	HEADER "UNDEF", "UNDEF",
 172      4E44 4546 
 173               	ZZZZ:
 174 220e 0000 0000 	    .word LIT, undefined, LIT, 12, TYPE, CR, ENDS 
 174      0000 0C00 
 174      0000 0000 
 174      0000 
 175               	 
 176               	;----------------------------------------------------------------------
 177               	.p2align 1, 0x00
 178               	.equ free_flash, .
 179               	
 180               	;********************************************************************** 
 181               	
 182               	;----------------------------------------------------------------------
DEFINED SYMBOLS
              main.S:36     *ABS*:000000000000000c version
              main.S:172    .text:0000000000002206 _link_
            macros.S:125    *ABS*:0000000000000138 _last_
            macros.S:245    *ABS*:0000000000000048 TIB_SIZE
            macros.S:249    *ABS*:0000000000000048 PAD_SIZE
            macros.S:253    *ABS*:0000000000000024 HDS_SIZE
            macros.S:257    *ABS*:0000000000000024 STACK_SIZE
            macros.S:261    *ABS*:0000000000000002 CELL_SIZE
            macros.S:265    *ABS*:000000000000000f WORD_SIZE
            macros.S:269    *ABS*:0000000000000010 BASE_DEFAULT
            macros.S:296    *ABS*:0000000000000080 F_RESERVED
            macros.S:297    *ABS*:0000000000000040 F_IMMEDIATE
            macros.S:298    *ABS*:0000000000000020 F_COMPILE
            macros.S:299    *ABS*:0000000000000010 F_HIDDEN
            macros.S:301    *ABS*:00000000000000f0 F_TOMASK
            macros.S:302    *ABS*:000000000000000f F_UNMASK
            macros.S:305    *ABS*:0000000000000000 F_LEAP
            macros.S:306    *ABS*:0000000000000000 F_CORE
            macros.S:312    *ABS*:0000000000000000 NO_ERROR
            macros.S:313    *ABS*:fffffffffffffff7 INVALID_MEMORY
            macros.S:314    *ABS*:fffffffffffffff5 OUT_OF_RANGE
            macros.S:315    *ABS*:fffffffffffffff3 INVALID_WORD
            macros.S:316    *ABS*:ffffffffffffffec TO_READ_ONLY
            macros.S:317    *ABS*:ffffffffffffffe8 NOT_A_NUMBER
            macros.S:332    *ABS*:000000000000000d CR_
            macros.S:333    *ABS*:000000000000000a LF_
            macros.S:334    *ABS*:0000000000000008 BS_
            macros.S:335    *ABS*:0000000000000020 BL_
            macros.S:341    *ABS*:0000000000000000 BIT_CARRY
            macros.S:343    *ABS*:0000000000000001 BIT_ZERO
            macros.S:345    *ABS*:0000000000000002 BIT_NEG
            macros.S:373    *ABS*:0000000000000080 SPM_SIZE
            macros.S:375    *ABS*:0000000000000100 SRAM_START
            macros.S:377    *ABS*:00000000000008ff SRAM_END
            macros.S:379    *ABS*:0000000000000000 FLASH_RWW
            macros.S:381    *ABS*:0000000000003e00 FLASH_NRWW
            macros.S:383    *ABS*:0000000000003fff FLASH_END
            macros.S:385    *ABS*:00000000000003ff E2P_END
            macros.S:391    *ABS*:0000000000000004 E2P_PAGESIZE
            macros.S:393    *ABS*:0000000000000000 E2P_START
            macros.S:397    *ABS*:000000000000001e SIGNATURE_000
            macros.S:398    *ABS*:0000000000000095 SIGNATURE_001
            macros.S:401    *ABS*:000000000000000f SIGNATURE_002
            macros.S:403    *ABS*:000000000000000f SIGNATURE_003
            macros.S:405    *ABS*:0000000000000016 SIGNATURE_004
              bios.S:266    .text:0000000000000086 HALT
            macros.S:410    *ABS*:0000000000000001 IDLE
            macros.S:411    *ABS*:0000000000000002 BUSY
            macros.S:412    *ABS*:0000000000000003 WAIT
            macros.S:414    *ABS*:0000000000000004 GIVE
            macros.S:415    *ABS*:0000000000000008 TAKE
              main.S:47     .eeprom:0000000000000000 e_void
              main.S:48     .eeprom:0000000000000002 e_live
              main.S:49     .eeprom:0000000000000004 e_turn
              main.S:50     .eeprom:0000000000000006 e_rest
              main.S:51     .eeprom:0000000000000008 e_last
              main.S:52     .eeprom:000000000000000a e_dp
              main.S:53     .eeprom:000000000000000c e_up
              main.S:54     .eeprom:000000000000000e e_ep
              main.S:56     .eeprom:0000000000000010 EP0
              main.S:64     data:0000000000000100 TIB0
              main.S:68     data:0000000000000148 SPZ
              main.S:69     data:000000000000016c SP0
              main.S:70     data:000000000000016c PSZ
              main.S:71     data:0000000000000190 PS0
              main.S:72     data:0000000000000190 RSZ
              main.S:73     data:00000000000001b4 RS0
              main.S:77     data:00000000000001b4 VOID
              main.S:78     data:00000000000001b6 LIVE
              main.S:80     data:00000000000001b8 TURN
              main.S:81     data:00000000000001ba REST
              main.S:83     data:00000000000001bc LAST
              main.S:84     data:00000000000001be VDP
              main.S:86     data:00000000000001c0 VUP
              main.S:87     data:00000000000001c2 VEP
              main.S:91     data:00000000000001c4 VHP
              main.S:92     data:00000000000001c6 SEED
              main.S:94     data:00000000000001c8 STAT
              main.S:95     data:00000000000001ca RADX
              main.S:97     data:00000000000001cc TOIN
              main.S:98     data:00000000000001ce SPAN
              main.S:100    data:00000000000001d0 SCRS
              main.S:101    data:00000000000001d2 BLKS
              main.S:103    data:00000000000001d4 HAND
              main.S:104    data:00000000000001d6 CSPP
              main.S:106    data:00000000000001d8 CURR
              main.S:107    data:00000000000001da CTXT
              main.S:109    data:00000000000001dc HLD
              main.S:110    data:00000000000001de HLDS
              main.S:112    data:00000000000001e0 WARN
              main.S:113    data:00000000000001e2 ERRN
              main.S:115    data:00000000000001e4 TMP0
              main.S:116    data:00000000000001e6 TMP1
              main.S:117    data:00000000000001e8 TMP2
              main.S:118    data:00000000000001ea TMP3
              main.S:121    data:00000000000001ec UH0
              main.S:123    *ABS*:00000000000008ff US0
              bios.S:37     *ABS*:000000000000003f __SREG__
              bios.S:38     *ABS*:000000000000003e __SP_H__
              bios.S:39     *ABS*:000000000000003d __SP_L__
              bios.S:42     *ABS*:0000000000000009 UBRRL
              bios.S:43     *ABS*:0000000000000020 UCSRC
              bios.S:44     *ABS*:000000000000000a UCSRB
              bios.S:45     *ABS*:000000000000000b UCSRA
              bios.S:48     *ABS*:0000000000000021 WDTCR
              bios.S:51     *ABS*:0000000000000032 TCNT0
              bios.S:52     *ABS*:0000000000000033 TCCR0
              bios.S:53     *ABS*:0000000000000039 TIMSK
              bios.S:56     *ABS*:0000000000000037 SPMCR
              bios.S:59     *ABS*:0000000000000007 SPMIE
              bios.S:60     *ABS*:0000000000000006 RWWSB
              bios.S:62     *ABS*:0000000000000004 RWWSRE
              bios.S:63     *ABS*:0000000000000003 BLBSET
              bios.S:64     *ABS*:0000000000000002 PGWRT
              bios.S:65     *ABS*:0000000000000001 PGERS
              bios.S:66     *ABS*:0000000000000000 SPMEN
              bios.S:73     *ABS*:000000000000001f EEARH
              bios.S:74     *ABS*:000000000000001e EEARL
              bios.S:75     *ABS*:000000000000001d EEDR
              bios.S:76     *ABS*:000000000000001c EECR
              bios.S:77     *ABS*:0000000000000001 EEWE
              bios.S:78     *ABS*:0000000000000002 EEMWE
              bios.S:79     *ABS*:0000000000000000 EERE
              bios.S:83     *ABS*:0000000000000035 MCUCR
              bios.S:100    .text:0000000000000000 boot
              bios.S:126    .text:0000000000000026 RESET
              bios.S:241    .text:0000000000000070 TIM0_OVF
              bios.S:163    *ABS*:000000000000008f OFFSETCNT
              bios.S:165    .text:0000000000000036 TIMER0_SET
              bios.S:187    .text:000000000000004c WATCHDOG_SET
              bios.S:198    .text:0000000000000054 USART_SET
              bios.S:214    .text:000000000000006c GOOD
              bios.S:250    .text:000000000000007a TIM0_ADJ
          messages.S:28     .text:0000000000000092 disclaimer
          messages.S:35     .text:000000000000016d prompt
          messages.S:39     .text:0000000000000172 question
          messages.S:43     .text:0000000000000177 undefined
          messages.S:47     .text:0000000000000184 exception
          messages.S:51     .text:0000000000000191 abort
          messages.S:54     .text:000000000000019b roullete
       forth-leafs.S:88     .text:00000000000001e6 __forth__
       forth-leafs.S:97     .text:00000000000001e6 is_ENDS
       forth-leafs.S:97     .text:00000000000001ee ENDS
       forth-leafs.S:102    .text:00000000000001f0 _unnest
       forth-leafs.S:107    .text:00000000000001f4 _next
       forth-leafs.S:111    .text:0000000000000200 _void
       forth-leafs.S:123    .text:000000000000020e _jump
       forth-leafs.S:117    .text:0000000000000206 _nest
       forth-leafs.S:127    .text:0000000000000210 _link
       forth-leafs.S:139    .text:0000000000000212 is_KEY
       forth-leafs.S:139    .text:0000000000000218 KEY
       forth-leafs.S:155    .text:000000000000022a is_QKEY
       forth-leafs.S:155    .text:0000000000000232 QKEY
       forth-leafs.S:343    .text:0000000000000308 _iffalse
       forth-leafs.S:331    .text:00000000000002f2 _iftrue
       forth-leafs.S:167    .text:000000000000023a is_EMIT
       forth-leafs.S:167    .text:0000000000000242 EMIT
       forth-leafs.S:182    .text:0000000000000252 is_QEMIT
       forth-leafs.S:182    .text:000000000000025a QEMIT
       forth-leafs.S:194    .text:0000000000000262 is_ECTO
       forth-leafs.S:194    .text:0000000000000268 ECTO
       forth-leafs.S:198    .text:000000000000026e _ee_write
       forth-leafs.S:229    .text:0000000000000288 is_ECAT
       forth-leafs.S:229    .text:000000000000028e ECAT
       forth-leafs.S:233    .text:0000000000000294 _ee_read
       forth-leafs.S:255    .text:00000000000002a6 is_PCAT
       forth-leafs.S:255    .text:00000000000002ac PCAT
       forth-leafs.S:257    .text:00000000000002ae _peek
       forth-leafs.S:269    .text:00000000000002b8 is_PCTO
       forth-leafs.S:269    .text:00000000000002be PCTO
       forth-leafs.S:271    .text:00000000000002c0 _poke
       forth-leafs.S:282    .text:00000000000002cc is_MILLIS
       forth-leafs.S:282    .text:00000000000002d6 MILLIS
       forth-leafs.S:328    .text:00000000000002e4 is_FTRUE
       forth-leafs.S:328    .text:00000000000002ec FTRUE
       forth-leafs.S:340    .text:00000000000002fa is_FFALSE
       forth-leafs.S:340    .text:0000000000000302 FFALSE
       forth-leafs.S:352    .text:0000000000000310 is_ZEQU
       forth-leafs.S:352    .text:0000000000000316 ZEQU
       forth-leafs.S:363    .text:0000000000000322 is_ZLTH
       forth-leafs.S:363    .text:0000000000000328 ZLTH
       forth-leafs.S:377    .text:0000000000000334 is_UMLESS
       forth-leafs.S:377    .text:000000000000033a UMLESS
       forth-leafs.S:395    .text:0000000000000350 is_UMPLUS
       forth-leafs.S:395    .text:0000000000000356 UMPLUS
       forth-leafs.S:417    .text:0000000000000372 is_TO
       forth-leafs.S:417    .text:0000000000000376 TO
       forth-leafs.S:431    .text:000000000000038a is_AT
       forth-leafs.S:431    .text:000000000000038e AT
       forth-leafs.S:444    .text:000000000000039a is_ATAT
       forth-leafs.S:444    .text:00000000000003a0 ATAT
       forth-leafs.S:467    .text:00000000000003b4 is_TOR
       forth-leafs.S:467    .text:00000000000003ba TOR
       forth-leafs.S:480    .text:00000000000003d0 is_RTO
       forth-leafs.S:480    .text:00000000000003d6 RTO
       forth-leafs.S:493    .text:00000000000003ec is_RAT
       forth-leafs.S:493    .text:00000000000003f2 RAT
       forth-leafs.S:506    .text:000000000000040c is_RSTO
       forth-leafs.S:506    .text:0000000000000412 RSTO
       forth-leafs.S:516    .text:000000000000041e is_PSTO
       forth-leafs.S:516    .text:0000000000000424 PSTO
       forth-leafs.S:527    .text:0000000000000430 is_RSAT
       forth-leafs.S:527    .text:0000000000000436 RSAT
       forth-leafs.S:538    .text:0000000000000442 is_PSAT
       forth-leafs.S:538    .text:0000000000000448 PSAT
       forth-leafs.S:549    .text:0000000000000454 is_DROP
       forth-leafs.S:549    .text:000000000000045c DROP
       forth-leafs.S:551    .text:000000000000045e PULL
       forth-leafs.S:559    .text:0000000000000466 is_DUP
       forth-leafs.S:559    .text:000000000000046c DUP
       forth-leafs.S:561    .text:000000000000046e PUSH
       forth-leafs.S:569    .text:0000000000000476 is_SWAP
       forth-leafs.S:569    .text:000000000000047e SWAP
       forth-leafs.S:580    .text:000000000000048e is_OVER
       forth-leafs.S:580    .text:0000000000000496 OVER
       forth-leafs.S:593    .text:00000000000004aa is_ZDUP
       forth-leafs.S:593    .text:00000000000004b2 ZDUP
       forth-leafs.S:605    .text:00000000000004c0 is_LTHAN
       forth-leafs.S:605    .text:00000000000004c4 LTHAN
       forth-leafs.S:621    .text:00000000000004d8 is_PLUS
       forth-leafs.S:621    .text:00000000000004dc PLUS
       forth-leafs.S:634    .text:00000000000004ec is_MINUS
       forth-leafs.S:634    .text:00000000000004f0 MINUS
       forth-leafs.S:647    .text:0000000000000502 is_NAND
       forth-leafs.S:647    .text:000000000000050a NAND
       forth-leafs.S:660    .text:000000000000051c is_AND
       forth-leafs.S:660    .text:0000000000000522 AND
       forth-leafs.S:671    .text:0000000000000530 is_OR
       forth-leafs.S:671    .text:0000000000000536 OR
       forth-leafs.S:682    .text:0000000000000544 is_XOR
       forth-leafs.S:682    .text:000000000000054a XOR
       forth-leafs.S:693    .text:0000000000000558 is_INVERT
       forth-leafs.S:693    .text:0000000000000562 INVERT
       forth-leafs.S:695    .text:0000000000000564 _inv
       forth-leafs.S:704    .text:000000000000056c is_NEGATE
       forth-leafs.S:704    .text:0000000000000576 NEGATE
       forth-leafs.S:706    .text:0000000000000578 _neg
       forth-leafs.S:715    .text:0000000000000580 is_SHL
       forth-leafs.S:715    .text:0000000000000586 SHL
       forth-leafs.S:717    .text:0000000000000588 _shl
       forth-leafs.S:727    .text:0000000000000592 is_SHR
       forth-leafs.S:727    .text:0000000000000598 SHR
       forth-leafs.S:729    .text:000000000000059a _shr
       forth-leafs.S:739    .text:00000000000005a4 is_ENDIAN
       forth-leafs.S:739    .text:00000000000005aa ENDIAN
       forth-leafs.S:750    .text:00000000000005b6 is_BRANCH
       forth-leafs.S:750    .text:00000000000005c0 BRANCH
       forth-leafs.S:752    .text:00000000000005c2 _branch
       forth-leafs.S:763    .text:00000000000005da is_ZBRANCH
       forth-leafs.S:763    .text:00000000000005e4 ZBRANCH
       forth-leafs.S:781    .text:00000000000005fe is_LIT
       forth-leafs.S:781    .text:0000000000000604 LIT
       forth-leafs.S:795    .text:0000000000000622 is_ALIGNED
       forth-leafs.S:795    .text:000000000000062c ALIGNED
       forth-leafs.S:806    .text:0000000000000636 is_CELL
       forth-leafs.S:806    .text:000000000000063e CELL
       forth-leafs.S:818    .text:000000000000064c is_CTO
       forth-leafs.S:818    .text:0000000000000652 CTO
       forth-leafs.S:831    .text:0000000000000664 is_CAT
       forth-leafs.S:831    .text:000000000000066a CAT
       forth-leafs.S:841    .text:0000000000000676 is_ZERO
       forth-leafs.S:841    .text:000000000000067a ZERO
       forth-leafs.S:852    .text:0000000000000688 is_ONE
       forth-leafs.S:852    .text:000000000000068c ONE
       forth-leafs.S:863    .text:000000000000069a is_TWO
       forth-leafs.S:863    .text:000000000000069e TWO
       forth-twigs.S:69     .text:00000000000006ac is_ETO
       forth-twigs.S:69     .text:00000000000006b2 ETO
       forth-twigs.S:80     .text:00000000000006c6 is_EAT
       forth-twigs.S:80     .text:00000000000006cc EAT
       forth-twigs.S:95     .text:00000000000006e8 is_NIP
       forth-twigs.S:95     .text:00000000000006ee NIP
       forth-twigs.S:102    .text:00000000000006f4 is_SWIP
       forth-twigs.S:102    .text:00000000000006fc SWIP
       forth-twigs.S:116    .text:0000000000000704 is_ROTU
       forth-twigs.S:116    .text:000000000000070a ROTU
       forth-twigs.S:123    .text:0000000000000710 is_ROTD
       forth-twigs.S:123    .text:0000000000000718 ROTD
       forth-twigs.S:130    .text:000000000000071e is_TUCK
       forth-twigs.S:130    .text:0000000000000726 TUCK
       forth-twigs.S:137    .text:000000000000072c is_FLIP
       forth-twigs.S:137    .text:0000000000000734 FLIP
       forth-twigs.S:144    .text:000000000000073c is_EQUAL
       forth-twigs.S:144    .text:0000000000000740 EQUAL
       forth-twigs.S:151    .text:0000000000000746 is_NOTEQUAL
       forth-twigs.S:151    .text:000000000000074c NOTEQUAL
       forth-twigs.S:158    .text:0000000000000752 is_GTHAN
       forth-twigs.S:158    .text:0000000000000756 GTHAN
       forth-twigs.S:164    .text:000000000000075c is_ZEROGT
       forth-twigs.S:164    .text:0000000000000762 ZEROGT
       forth-twigs.S:170    .text:0000000000000768 is_ZEROLT
       forth-twigs.S:170    .text:000000000000076e ZEROLT
       forth-twigs.S:178    .text:0000000000000776 is_CELLS
       forth-twigs.S:178    .text:000000000000077e CELLS
       forth-twigs.S:185    .text:0000000000000782 is_CELLPLUS
       forth-twigs.S:185    .text:000000000000078a CELLPLUS
       forth-twigs.S:192    .text:0000000000000790 is_CELLMINUS
       forth-twigs.S:192    .text:0000000000000798 CELLMINUS
       forth-twigs.S:199    .text:000000000000079e is_ONEPLUS
       forth-twigs.S:199    .text:00000000000007a4 ONEPLUS
       forth-twigs.S:206    .text:00000000000007aa is_ONEMINUS
       forth-twigs.S:206    .text:00000000000007b0 ONEMINUS
       forth-twigs.S:213    .text:00000000000007b6 is_TWOPLUS
       forth-twigs.S:213    .text:00000000000007bc TWOPLUS
       forth-twigs.S:220    .text:00000000000007c2 is_TWOMINUS
       forth-twigs.S:220    .text:00000000000007c8 TWOMINUS
       forth-twigs.S:227    .text:00000000000007ce is_PLUSTO
       forth-twigs.S:227    .text:00000000000007d4 PLUSTO
       forth-twigs.S:234    .text:00000000000007e2 is_CHARPLUS
       forth-twigs.S:234    .text:00000000000007ea CHARPLUS
       forth-twigs.S:241    .text:00000000000007ee is_CHARMINUS
       forth-twigs.S:241    .text:00000000000007f6 CHARMINUS
       forth-twigs.S:249    .text:00000000000007fa is_CHARS
       forth-twigs.S:249    .text:0000000000000802 CHARS
       forth-twigs.S:260    .text:0000000000000804 is_TIB
       forth-twigs.S:260    .text:000000000000080a TIB
       forth-twigs.S:268    .text:0000000000000814 is_STATE
       forth-twigs.S:268    .text:000000000000081c STATE
       forth-twigs.S:275    .text:0000000000000822 is_BASE
       forth-twigs.S:275    .text:000000000000082a BASE
       forth-twigs.S:282    .text:0000000000000830 is_CSP
       forth-twigs.S:282    .text:0000000000000836 CSP
       forth-twigs.S:289    .text:000000000000083c is_EPP
       forth-twigs.S:289    .text:0000000000000842 EPP
       forth-twigs.S:296    .text:0000000000000848 is_DPP
       forth-twigs.S:296    .text:000000000000084e DPP
       forth-twigs.S:303    .text:0000000000000854 is_HPP
       forth-twigs.S:303    .text:000000000000085a HPP
       forth-twigs.S:311    .text:0000000000000860 is_UPP
       forth-twigs.S:311    .text:0000000000000866 UPP
       forth-twigs.S:319    .text:000000000000086c is_BUFF
       forth-twigs.S:319    .text:0000000000000874 BUFF
       forth-twigs.S:327    .text:000000000000087c is_PAD
       forth-twigs.S:327    .text:0000000000000882 PAD
       forth-twigs.S:349    .text:000000000000088a is_DEPTH
       forth-twigs.S:349    .text:0000000000000892 DEPTH
       forth-twigs.S:356    .text:000000000000089c is_RDEPTH
       forth-twigs.S:356    .text:00000000000008a6 RDEPTH
       forth-twigs.S:367    .text:00000000000008b0 is_CURRENT
       forth-twigs.S:367    .text:00000000000008ba CURRENT
       forth-twigs.S:371    .text:00000000000008c0 is_CONTEXT
       forth-twigs.S:371    .text:00000000000008ca CONTEXT
       forth-twigs.S:375    .text:00000000000008d0 is_DEFINITIONS
       forth-twigs.S:375    .text:00000000000008de DEFINITIONS
       forth-twigs.S:379    .text:00000000000008e8 is_LATEST
       forth-twigs.S:379    .text:00000000000008f2 LATEST
       forth-twigs.S:403    .text:00000000000008f8 is_UHERE
       forth-twigs.S:403    .text:0000000000000900 UHERE
       forth-twigs.S:410    .text:0000000000000906 is_HERE
       forth-twigs.S:410    .text:000000000000090e HERE
       forth-twigs.S:418    .text:0000000000000914 is_ALLOT
       forth-twigs.S:418    .text:000000000000091c ALLOT
       forth-twigs.S:429    .text:0000000000000934 is_ALIGN
       forth-twigs.S:429    .text:000000000000093c ALIGN
       forth-twigs.S:438    .text:0000000000000952 is_CCOMMA
       forth-twigs.S:438    .text:0000000000000958 CCOMMA
       forth-twigs.S:445    .text:0000000000000962 is_COMMA
       forth-twigs.S:445    .text:0000000000000966 COMMA
       forth-twigs.S:454    .text:0000000000000970 is_TOMMA
       forth-twigs.S:454    .text:0000000000000976 TOMMA
       forth-twigs.S:465    .text:0000000000000982 is_DOVAR
       forth-twigs.S:465    .text:000000000000098a DOVAR
       forth-twigs.S:476    .text:0000000000000994 is_DOCON
       forth-twigs.S:476    .text:000000000000099c DOCON
       forth-twigs.S:483    .text:00000000000009a4 is_LITERAL
       forth-twigs.S:483    .text:00000000000009ae LITERAL
       forth-twigs.S:490    .text:00000000000009b8 is_KTICK
       forth-twigs.S:490    .text:00000000000009be KTICK
       forth-twigs.S:498    .text:00000000000009c6 is_COMP
       forth-twigs.S:498    .text:00000000000009ce COMP
       forth-twigs.S:505    .text:00000000000009dc is_EXIT
       forth-twigs.S:505    .text:00000000000009e4 EXIT
       forth-twigs.S:512    .text:00000000000009ea is_EXEC
       forth-twigs.S:512    .text:00000000000009f4 EXEC
       forth-twigs.S:520    .text:00000000000009f8 is_TAIL
       forth-twigs.S:520    .text:0000000000000a00 TAIL
       forth-twigs.S:536    .text:0000000000000a0a is_MARKTO
       forth-twigs.S:536    .text:0000000000000a14 MARKTO
       forth-twigs.S:545    .text:0000000000000a1c is_TOMARK
       forth-twigs.S:545    .text:0000000000000a26 TOMARK
       forth-twigs.S:552    .text:0000000000000a2e is_BEGIN
       forth-twigs.S:552    .text:0000000000000a36 BEGIN
       forth-twigs.S:559    .text:0000000000000a3a is_AGAIN
       forth-twigs.S:559    .text:0000000000000a42 AGAIN
       forth-twigs.S:566    .text:0000000000000a4a is_UNTIL
       forth-twigs.S:566    .text:0000000000000a52 UNTIL
       forth-twigs.S:573    .text:0000000000000a5a is_UNLESS
       forth-twigs.S:573    .text:0000000000000a64 UNLESS
       forth-twigs.S:580    .text:0000000000000a6a is_IF
       forth-twigs.S:580    .text:0000000000000a70 IF
       forth-twigs.S:587    .text:0000000000000a78 is_GO
       forth-twigs.S:587    .text:0000000000000a7e GO
       forth-twigs.S:594    .text:0000000000000a86 is_THEN
       forth-twigs.S:594    .text:0000000000000a8e THEN
       forth-twigs.S:601    .text:0000000000000a9a ENDIF
       forth-twigs.S:601    .text:0000000000000a92 is_ENDIF
       forth-twigs.S:608    .text:0000000000000a9e is_ELSE
       forth-twigs.S:608    .text:0000000000000aa6 ELSE
       forth-twigs.S:615    .text:0000000000000aae is_WHILE
       forth-twigs.S:615    .text:0000000000000ab6 WHILE
       forth-twigs.S:622    .text:0000000000000abc is_REPEAT
       forth-twigs.S:622    .text:0000000000000ac6 REPEAT
       forth-twigs.S:630    .text:0000000000000acc is_AHEAD
       forth-twigs.S:630    .text:0000000000000ad4 AHEAD
       forth-twigs.S:637    .text:0000000000000ad8 is_AFT
       forth-twigs.S:637    .text:0000000000000ade AFT
       forth-twigs.S:644    .text:0000000000000ae8 is_HOOK
       forth-twigs.S:644    .text:0000000000000af0 HOOK
       forth-twigs.S:651    .text:0000000000000af6 is_BACK
       forth-twigs.S:651    .text:0000000000000afe BACK
       forth-twigs.S:658    .text:0000000000000b04 is_FOR
       forth-twigs.S:658    .text:0000000000000b0a FOR
       forth-twigs.S:665    .text:0000000000000b12 is_TXEN
       forth-twigs.S:665    .text:0000000000000b1a TXEN
       forth-twigs.S:675    .text:0000000000000b28 is_NEXT
       forth-twigs.S:675    .text:0000000000000b30 NEXT
       forth-twigs.S:697    .text:0000000000000b38 is_CASE
       forth-twigs.S:697    .text:0000000000000b40 CASE
       forth-twigs.S:704    .text:0000000000000b44 is_OF
       forth-twigs.S:704    .text:0000000000000b4a OF
       forth-twigs.S:711    .text:0000000000000b5e is_ENDOF
       forth-twigs.S:711    .text:0000000000000b66 ENDOF
       forth-twigs.S:718    .text:0000000000000b6c is_DEFAULT
       forth-twigs.S:718    .text:0000000000000b76 DEFAULT
       forth-twigs.S:725    .text:0000000000000b84 is_ENDCASE
       forth-twigs.S:725    .text:0000000000000b8e ENDCASE
       forth-twigs.S:733    .text:0000000000000b9c is_DOIT
       forth-twigs.S:733    .text:0000000000000ba4 DOIT
       forth-twigs.S:740    .text:0000000000000baa is_LOOPN
       forth-twigs.S:740    .text:0000000000000bb4 LOOPN
       forth-twigs.S:757    .text:0000000000000bea is_LOOPI
       forth-twigs.S:757    .text:0000000000000bf2 LOOPI
       forth-twigs.S:765    .text:0000000000000bf8 is_DO
       forth-twigs.S:765    .text:0000000000000bfe DO
       forth-twigs.S:772    .text:0000000000000c06 is_I
       forth-twigs.S:772    .text:0000000000000c0a I
       forth-twigs.S:779    .text:0000000000000c12 is_J
       forth-twigs.S:779    .text:0000000000000c16 J
       forth-twigs.S:787    .text:0000000000000c26 is_LEAVE
       forth-twigs.S:787    .text:0000000000000c2e LEAVE
       forth-twigs.S:808    .text:0000000000000c68 UNLOOP
       forth-twigs.S:794    .text:0000000000000c3e is_LOOP
       forth-twigs.S:794    .text:0000000000000c46 LOOP
       forth-twigs.S:801    .text:0000000000000c4e is_PLOOP
       forth-twigs.S:801    .text:0000000000000c56 PLOOP
       forth-twigs.S:808    .text:0000000000000c5e is_UNLOOP
       forth-twigs.S:816    .text:0000000000000c72 is_CR
       forth-twigs.S:816    .text:0000000000000c78 CR
       forth-twigs.S:823    .text:0000000000000c80 is_LF
       forth-twigs.S:823    .text:0000000000000c86 LF
       forth-twigs.S:830    .text:0000000000000c8e is_BL
       forth-twigs.S:830    .text:0000000000000c94 BL
       forth-twigs.S:837    .text:0000000000000c9c is_PACE
       forth-twigs.S:837    .text:0000000000000ca4 PACE
       forth-twigs.S:844    .text:0000000000000cac is_BELL
       forth-twigs.S:844    .text:0000000000000cb4 BELL
       forth-twigs.S:851    .text:0000000000000cbc is_SPACE
       forth-twigs.S:851    .text:0000000000000cc4 SPACE
       forth-twigs.S:858    .text:0000000000000ccc is_SPACES
       forth-twigs.S:858    .text:0000000000000cd6 SPACES
       forth-twigs.S:867    .text:0000000000000ce6 is_COUNT
       forth-twigs.S:867    .text:0000000000000cee COUNT
       forth-twigs.S:874    .text:0000000000000cfa is_TYPE
       forth-twigs.S:874    .text:0000000000000d02 TYPE
       forth-twigs.S:884    .text:0000000000000d20 is_UMMINUS
       forth-twigs.S:884    .text:0000000000000d26 UMMINUS
       forth-twigs.S:895    .text:0000000000000d2c is_ULESS
       forth-twigs.S:895    .text:0000000000000d32 ULESS
       forth-twigs.S:903    .text:0000000000000d42 is_UMORE
       forth-twigs.S:903    .text:0000000000000d48 UMORE
       forth-twigs.S:910    .text:0000000000000d58 is_UAT
       forth-twigs.S:910    .text:0000000000000d5e UAT
       forth-twigs.S:918    .text:0000000000000d64 is_UTO
       forth-twigs.S:918    .text:0000000000000d6a UTO
       forth-twigs.S:926    .text:0000000000000d70 is_USV
       forth-twigs.S:926    .text:0000000000000d76 USV
       forth-twigs.S:934    .text:0000000000000d7e is_ULD
       forth-twigs.S:934    .text:0000000000000d84 ULD
       forth-twigs.S:940    .text:0000000000000d8c is_COLDZERO
       forth-twigs.S:940    .text:0000000000000d94 COLDZERO
              main.S:173    .text:000000000000220e ZZZZ
              main.S:178    .text:000000000000221c free_flash
       forth-twigs.S:957    .text:0000000000000df0 is_EELOAD
       forth-twigs.S:957    .text:0000000000000dfa EELOAD
       forth-twigs.S:971    .text:0000000000000e6a is_EESAVE
       forth-twigs.S:971    .text:0000000000000e74 EESAVE
       forth-twigs.S:985    .text:0000000000000ef4 is_COLD
       forth-twigs.S:985    .text:0000000000000efc COLD
       forth-twigs.S:989    .text:0000000000000f0c _safe
       forth-twigs.S:1000   .text:0000000000000f48 WARM
       forth-twigs.S:1000   .text:0000000000000f40 is_WARM
       interpreter.S:1438   .text:0000000000002192 QUIT
       forth-twigs.S:1008   .text:0000000000000f52 is_BYE
       forth-twigs.S:1008   .text:0000000000000f58 BYE
           doubles.S:33     .text:0000000000000f64 is_FOUR
           doubles.S:33     .text:0000000000000f68 FOUR
           doubles.S:40     .text:0000000000000f6e is_FOURPLUS
           doubles.S:40     .text:0000000000000f74 FOURPLUS
           doubles.S:47     .text:0000000000000f7c is_FOURMINUS
           doubles.S:47     .text:0000000000000f82 FOURMINUS
           doubles.S:55     .text:0000000000000f8a is_TWOTO
           doubles.S:55     .text:0000000000000f90 TWOTO
           doubles.S:61     .text:0000000000000f9c is_TWOAT
           doubles.S:61     .text:0000000000000fa2 TWOAT
           doubles.S:68     .text:0000000000000fae is_TWOTOR
           doubles.S:68     .text:0000000000000fb4 TWOTOR
           doubles.S:75     .text:0000000000000fbc is_TWORTO
           doubles.S:75     .text:0000000000000fc2 TWORTO
           doubles.S:82     .text:0000000000000fca is_TWORAT
           doubles.S:82     .text:0000000000000fd0 TWORAT
           doubles.S:89     .text:0000000000000fe0 is_TWODROP
           doubles.S:89     .text:0000000000000fe8 TWODROP
           doubles.S:96     .text:0000000000000fee is_TWODUP
           doubles.S:96     .text:0000000000000ff6 TWODUP
           doubles.S:103    .text:0000000000000ffc is_TWOSWAP
           doubles.S:103    .text:0000000000001004 TWOSWAP
           doubles.S:110    .text:000000000000100e is_DPLUS
           doubles.S:110    .text:0000000000001014 DPLUS
           doubles.S:117    .text:0000000000001026 is_DMINUS
           doubles.S:117    .text:000000000000102c DMINUS
           doubles.S:124    .text:000000000000103e is_DNEG
           doubles.S:124    .text:0000000000001048 DNEG
           doubles.S:131    .text:0000000000001058 is_DABS
           doubles.S:131    .text:0000000000001060 DABS
              math.S:36     *ABS*:0000000000001505 djbHASH
              math.S:37     .text:000000000000106c is_HASH
              math.S:37     .text:0000000000001074 HASH
              math.S:89     .text:00000000000010a8 is_RANDOM
              math.S:89     .text:00000000000010b2 RANDOM
              math.S:110    .text:00000000000010d6 _seed
              math.S:106    .text:00000000000010c6 is_RAND
              math.S:106    .text:00000000000010ce RAND
              math.S:119    .text:00000000000010e2 is_ABS
              math.S:119    .text:00000000000010e8 ABS
              math.S:128    .text:00000000000010f4 is_MAX
              math.S:128    .text:00000000000010fa MAX
              math.S:137    .text:0000000000001108 is_MIN
              math.S:137    .text:000000000000110e MIN
              math.S:144    .text:0000000000001114 is_WITHIN
              math.S:144    .text:000000000000111e WITHIN
              math.S:155    .text:000000000000112c is_UMPASS
              math.S:155    .text:0000000000001136 UMPASS
              math.S:165    .text:000000000000114a is_UMDIVMOD
              math.S:165    .text:0000000000001154 UMDIVMOD
              math.S:182    .text:00000000000011a4 is_MDIVMOD
              math.S:182    .text:00000000000011ac MDIVMOD
              math.S:195    .text:00000000000011e2 is_DIVMOD
              math.S:195    .text:00000000000011ea DIVMOD
              math.S:202    .text:00000000000011f6 is_MOD
              math.S:202    .text:00000000000011fc MOD
              math.S:209    .text:0000000000001204 is_DIV
              math.S:209    .text:0000000000001208 DIV
              math.S:218    .text:0000000000001212 is_UMSTAR
              math.S:218    .text:0000000000001218 UMSTAR
              math.S:230    .text:000000000000123e is_STAR
              math.S:230    .text:0000000000001242 STAR
              math.S:237    .text:000000000000124a is_MSTAR
              math.S:237    .text:0000000000001250 MSTAR
              math.S:247    .text:000000000000126e is_STARDIVMOD
              math.S:247    .text:0000000000001276 STARDIVMOD
              math.S:254    .text:0000000000001282 is_STARDIV
              math.S:254    .text:0000000000001288 STARDIV
             flush.S:81     .text:0000000000001292 is_LDFLASH
             flush.S:81     .text:00000000000012a2 LDFLASH
             flush.S:123    .text:00000000000012ca is_SVFLASH
             flush.S:123    .text:00000000000012da SVFLASH
             flush.S:203    .text:000000000000131e _does_spm
          pictures.S:18     .text:0000000000001332 is_DIGIT
          pictures.S:18     .text:000000000000133a DIGIT
          pictures.S:31     .text:0000000000001380 is_LTSNUM
          pictures.S:31     .text:0000000000001386 LTSNUM
          pictures.S:38     .text:0000000000001390 is_HOLD
          pictures.S:38     .text:0000000000001398 HOLD
          pictures.S:45     .text:00000000000013a8 is_SNUM
          pictures.S:45     .text:00000000000013ac SNUM
          pictures.S:54     .text:00000000000013c6 is_SNUMS
          pictures.S:54     .text:00000000000013cc SNUMS
          pictures.S:61     .text:00000000000013da is_SIGN
          pictures.S:61     .text:00000000000013e2 SIGN
       interpreter.S:1300   .text:0000000000001fe8 CHAR
          pictures.S:69     .text:00000000000013f0 is_SNUMGT
          pictures.S:69     .text:00000000000013f6 SNUMGT
          pictures.S:79     .text:0000000000001404 is_UDOTP
          pictures.S:79     .text:000000000000140c UDOTP
          pictures.S:86     .text:0000000000001416 is_UDOT
          pictures.S:86     .text:000000000000141c UDOT
          pictures.S:93     .text:0000000000001424 is_UDOTR
          pictures.S:93     .text:000000000000142a UDOTR
          pictures.S:100    .text:0000000000001438 is_DOTP
          pictures.S:100    .text:000000000000143e DOTP
          pictures.S:107    .text:0000000000001450 is_DOT
          pictures.S:107    .text:0000000000001454 DOT
          pictures.S:114    .text:000000000000145c is_QUESTION
          pictures.S:114    .text:0000000000001460 QUESTION
          pictures.S:121    .text:0000000000001466 is_DOTR
          pictures.S:121    .text:000000000000146c DOTR
          pictures.S:128    .text:000000000000147c is_UDDOTP
          pictures.S:128    .text:0000000000001484 UDDOTP
          pictures.S:135    .text:000000000000148c is_UDDOT
          pictures.S:135    .text:0000000000001492 UDDOT
          pictures.S:142    .text:000000000000149a is_UDDOTR
          pictures.S:142    .text:00000000000014a2 UDDOTR
          pictures.S:149    .text:00000000000014b2 is_DDOTP
          pictures.S:149    .text:00000000000014ba DDOTP
          pictures.S:156    .text:00000000000014ca is_DDOT
          pictures.S:156    .text:00000000000014d0 DDOT
          pictures.S:163    .text:00000000000014d8 is_DDOTR
          pictures.S:163    .text:00000000000014de DDOTR
       interpreter.S:46     .text:00000000000014ec is_skipf
       interpreter.S:46     .text:00000000000014f6 skipf
       interpreter.S:73     .text:0000000000001516 is_scanf
       interpreter.S:73     .text:0000000000001520 scanf
       interpreter.S:100    .text:0000000000001540 is_samef
       interpreter.S:100    .text:000000000000154a samef
       interpreter.S:132    .text:0000000000001576 is_copyf
       interpreter.S:132    .text:0000000000001580 copyf
       interpreter.S:163    .text:00000000000015a8 is_refillf
       interpreter.S:163    .text:00000000000015b4 refillf
       interpreter.S:299    .text:0000000000001612 is_wordf
       interpreter.S:299    .text:000000000000161c wordf
       interpreter.S:326    .text:000000000000163a _wsto
       interpreter.S:314    .text:0000000000001626 is_parsef
       interpreter.S:314    .text:0000000000001630 parsef
       interpreter.S:338    .text:0000000000001648 _tows
       interpreter.S:354    .text:0000000000001658 _wsat
       interpreter.S:375    .text:000000000000166c is_digitf
       interpreter.S:375    .text:0000000000001676 digitf
       interpreter.S:418    .text:000000000000169e is_numberf
       interpreter.S:418    .text:00000000000016aa numberf
       interpreter.S:548    .text:000000000000172a _bin_base
       interpreter.S:592    .text:0000000000001752 _next_digit
       interpreter.S:558    .text:0000000000001734 _nib_base
       interpreter.S:565    .text:0000000000001738 _oct_base
       interpreter.S:572    .text:000000000000173c _dec_base
       interpreter.S:581    .text:0000000000001746 _hex_base
       interpreter.S:648    .text:0000000000001778 is_findf
       interpreter.S:648    .text:0000000000001782 findf
       interpreter.S:791    .text:000000000000182c is_NULL
       interpreter.S:791    .text:0000000000001834 NULL
       interpreter.S:811    .text:000000000000183f is_QERROR
       interpreter.S:811    .text:000000000000184a QERROR
       interpreter.S:1404   .text:000000000000212c NONEN
       interpreter.S:819    .text:0000000000001860 is_QCOMP
       interpreter.S:819    .text:0000000000001868 QCOMP
       interpreter.S:823    .text:0000000000001876 is_QEXEC
       interpreter.S:823    .text:000000000000187e QEXEC
       interpreter.S:827    .text:000000000000188e is_QCSP
       interpreter.S:827    .text:0000000000001896 QCSP
       interpreter.S:831    .text:00000000000018a6 is_QSTACK
       interpreter.S:831    .text:00000000000018b0 QSTACK
       interpreter.S:837    .text:00000000000018d0 is_QPAIR
       interpreter.S:837    .text:00000000000018d8 QPAIR
       interpreter.S:851    .text:00000000000018e2 is_QHOOK
       interpreter.S:851    .text:00000000000018ea QHOOK
       interpreter.S:854    .text:00000000000018f4 is_QBACK
       interpreter.S:854    .text:00000000000018fc QBACK
       interpreter.S:857    .text:0000000000001908 is_QIF
       interpreter.S:857    .text:000000000000190e QIF
       interpreter.S:860    .text:0000000000001918 is_QELSE
       interpreter.S:860    .text:0000000000001920 QELSE
       interpreter.S:863    .text:0000000000001930 is_QENDIF
       interpreter.S:863    .text:0000000000001938 QENDIF
       interpreter.S:866    .text:0000000000001944 is_QTHEN
       interpreter.S:866    .text:000000000000194c QTHEN
       interpreter.S:869    .text:0000000000001958 is_QAHEAD
       interpreter.S:869    .text:0000000000001960 QAHEAD
       interpreter.S:872    .text:000000000000196a is_QAFT
       interpreter.S:872    .text:0000000000001970 QAFT
       interpreter.S:875    .text:0000000000001980 is_QBEGIN
       interpreter.S:875    .text:0000000000001988 QBEGIN
       interpreter.S:878    .text:0000000000001992 is_QAGAIN
       interpreter.S:878    .text:000000000000199a QAGAIN
       interpreter.S:881    .text:00000000000019a6 is_QUNTIL
       interpreter.S:881    .text:00000000000019ae QUNTIL
       interpreter.S:884    .text:00000000000019ba is_QWHILE
       interpreter.S:884    .text:00000000000019c2 QWHILE
       interpreter.S:887    .text:00000000000019d2 is_QREPEAT
       interpreter.S:887    .text:00000000000019dc QREPEAT
       interpreter.S:890    .text:00000000000019e8 is_QFOR
       interpreter.S:890    .text:00000000000019ee QFOR
       interpreter.S:893    .text:00000000000019f8 is_QNEXT
       interpreter.S:893    .text:0000000000001a00 QNEXT
       interpreter.S:896    .text:0000000000001a0c is_QCASE
       interpreter.S:896    .text:0000000000001a14 QCASE
       interpreter.S:899    .text:0000000000001a1e is_QENDCASE
       interpreter.S:899    .text:0000000000001a28 QENDCASE
       interpreter.S:902    .text:0000000000001a34 is_QOF
       interpreter.S:902    .text:0000000000001a3a QOF
       interpreter.S:905    .text:0000000000001a48 is_QENDOF
       interpreter.S:905    .text:0000000000001a50 QENDOF
       interpreter.S:908    .text:0000000000001a60 is_QDO
       interpreter.S:908    .text:0000000000001a66 QDO
       interpreter.S:911    .text:0000000000001a70 is_QLOOP
       interpreter.S:911    .text:0000000000001a78 QLOOP
       interpreter.S:914    .text:0000000000001a84 is_QPLOOP
       interpreter.S:914    .text:0000000000001a8c QPLOOP
       interpreter.S:917    .text:0000000000001a98 is_QLEAVE
       interpreter.S:917    .text:0000000000001aa0 QLEAVE
       interpreter.S:920    .text:0000000000001ab0 is_QUNLOOP
       interpreter.S:920    .text:0000000000001aba QUNLOOP
       interpreter.S:935    .text:0000000000001aca is_VALUE
       interpreter.S:935    .text:0000000000001ad2 VALUE
       interpreter.S:1315   .text:000000000000200e CREATE
       interpreter.S:942    .text:0000000000001ada is_TOVALUE
       interpreter.S:942    .text:0000000000001ae0 TOVALUE
       interpreter.S:1291   .text:0000000000001fd4 FIND
       interpreter.S:950    .text:0000000000001ae8 is_DEFER
       interpreter.S:950    .text:0000000000001af0 DEFER
              main.S:172    .text:000000000000220e UNDEF
       interpreter.S:957    .text:0000000000001b00 is_ISDEFER
       interpreter.S:957    .text:0000000000001b06 ISDEFER
       interpreter.S:964    .text:0000000000001b10 is_SSMOVE
       interpreter.S:964    .text:0000000000001b1a SSMOVE
       interpreter.S:1021   .text:0000000000001cb2 is_MOVE
       interpreter.S:1021   .text:0000000000001cba MOVE
       interpreter.S:1036   .text:0000000000001cf6 is_CMOVE
       interpreter.S:1036   .text:0000000000001cfe CMOVE
       interpreter.S:1045   .text:0000000000001d14 is_FILL
       interpreter.S:1045   .text:0000000000001d1c FILL
       interpreter.S:1058   .text:0000000000001d46 is_RBRAC
       interpreter.S:1058   .text:0000000000001d4a RBRAC
       interpreter.S:1065   .text:0000000000001d52 is_LBRAC
       interpreter.S:1065   .text:0000000000001d56 LBRAC
       interpreter.S:1072   .text:0000000000001d5e is_TOGGLE
       interpreter.S:1072   .text:0000000000001d68 TOGGLE
       interpreter.S:1080   .text:0000000000001d74 is_TONFA
       interpreter.S:1080   .text:0000000000001d7c TONFA
       interpreter.S:1087   .text:0000000000001d82 is_TOCFA
       interpreter.S:1087   .text:0000000000001d8a TOCFA
       interpreter.S:1094   .text:0000000000001d9a is_HIDDEN
       interpreter.S:1094   .text:0000000000001da4 HIDDEN
       interpreter.S:1101   .text:0000000000001dae is_IMMEDIATE
       interpreter.S:1101   .text:0000000000001dba IMMEDIATE
       interpreter.S:1108   .text:0000000000001dc4 is_COMPILE_ONLY
       interpreter.S:1108   .text:0000000000001dd4 COMPILE_ONLY
       interpreter.S:1115   .text:0000000000001dde is_HANDLER
       interpreter.S:1115   .text:0000000000001de8 HANDLER
       interpreter.S:1122   .text:0000000000001dee is_CATCH
       interpreter.S:1122   .text:0000000000001df6 CATCH
       interpreter.S:1131   .text:0000000000001e16 is_THROW
       interpreter.S:1131   .text:0000000000001e1e THROW
       interpreter.S:1141   .text:0000000000001e3e is_ABORT
       interpreter.S:1141   .text:0000000000001e46 ABORT
       interpreter.S:1148   .text:0000000000001e4e is_ACCEPT
       interpreter.S:1148   .text:0000000000001e58 ACCEPT
       interpreter.S:1155   .text:0000000000001e5c is_OVERT
       interpreter.S:1155   .text:0000000000001e64 OVERT
       interpreter.S:1163   .text:0000000000001e68 is_COLON
       interpreter.S:1163   .text:0000000000001e6c COLON
       interpreter.S:1170   .text:0000000000001e72 is_SEMIS
       interpreter.S:1170   .text:0000000000001e76 SEMIS
       interpreter.S:1179   .text:0000000000001e7e is_SOURCE
       interpreter.S:1179   .text:0000000000001e88 SOURCE
       interpreter.S:1188   .text:0000000000001ea4 is_SOURCEPLUS
       interpreter.S:1188   .text:0000000000001eae SOURCEPLUS
       interpreter.S:1195   .text:0000000000001eb8 is_REFILL
       interpreter.S:1195   .text:0000000000001ec2 REFILL
       interpreter.S:1203   .text:0000000000001ece is_PARSE
       interpreter.S:1203   .text:0000000000001ed6 PARSE
       interpreter.S:1213   .text:0000000000001ef0 is_BACKSLASH
       interpreter.S:1213   .text:0000000000001ef4 BACKSLASH
       interpreter.S:1220   .text:0000000000001efe is_PAREN
       interpreter.S:1220   .text:0000000000001f02 PAREN
       interpreter.S:1228   .text:0000000000001f0e is_DOTPAREN
       interpreter.S:1228   .text:0000000000001f14 DOTPAREN
       interpreter.S:1236   .text:0000000000001f1c is_SBSQUOTE
       interpreter.S:1236   .text:0000000000001f22 SBSQUOTE
       interpreter.S:1246   .text:0000000000001f3e is_SQUOTE
       interpreter.S:1246   .text:0000000000001f44 SQUOTE
       interpreter.S:1258   .text:0000000000001f60 is_DOTQUOTE
       interpreter.S:1258   .text:0000000000001f66 DOTQUOTE
       interpreter.S:1272   .text:0000000000001f90 is_PARSEN
       interpreter.S:1272   .text:0000000000001f9e PARSEN
       interpreter.S:1284   .text:0000000000001fb8 is_FINDN
       interpreter.S:1284   .text:0000000000001fc4 FINDN
       interpreter.S:1291   .text:0000000000001fcc is_FIND
       interpreter.S:1300   .text:0000000000001fe0 is_CHAR
       interpreter.S:1307   .text:0000000000001ff0 is_NONAME
       interpreter.S:1307   .text:0000000000001ffa NONAME
       interpreter.S:1315   .text:0000000000002004 is_CREATE
       interpreter.S:1328   .text:000000000000204c is_DOES
       interpreter.S:1328   .text:0000000000002054 DOES
       interpreter.S:1335   .text:0000000000002060 is_DOESTO
       interpreter.S:1335   .text:0000000000002068 DOESTO
       interpreter.S:1346   .text:0000000000002074 is_CONSTANT
       interpreter.S:1346   .text:0000000000002080 CONSTANT
       interpreter.S:1360   .text:000000000000209e is_VARIABLE
       interpreter.S:1360   .text:00000000000020aa VARIABLE
       interpreter.S:1370   .text:00000000000020c8 is_TICK
       interpreter.S:1370   .text:00000000000020cc TICK
       interpreter.S:1380   .text:00000000000020dc is_POSTPONE
       interpreter.S:1380   .text:00000000000020e8 POSTPONE
       interpreter.S:1387   .text:00000000000020ee is_COMPILE
       interpreter.S:1387   .text:00000000000020f8 COMPILE
       interpreter.S:1394   .text:0000000000002100 is_NUMBN
       interpreter.S:1394   .text:0000000000002108 NUMBN
       interpreter.S:1404   .text:0000000000002124 is_NONEN
       interpreter.S:1411   .text:000000000000213c is_EVAL
       interpreter.S:1411   .text:0000000000002144 EVAL
       interpreter.S:1438   .text:000000000000218a is_QUIT
              main.S:172    .text:0000000000002206 is_UNDEF

NO UNDEFINED SYMBOLS
